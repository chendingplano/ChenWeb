{"version":3,"file":"index.js","sources":["../../node_modules/@wx/lib-state/dist/index.js","../src/editors.ts","../src/export/index.ts","../src/export/csv.ts","../src/export/excel.ts","../src/print.ts","../src/HistoryManager.ts","../src/package.ts","../src/sort.ts","../src/sizes.ts","../src/filters.ts","../src/DataStore.ts","../../node_modules/@wx/lib-dom/dist/index.js","../src/hotkeys.ts","../src/scroll.ts","../src/menuOptions.ts"],"sourcesContent":["// src/helpers.ts\nvar iid = (/* @__PURE__ */ new Date()).valueOf();\nvar uid = () => iid++;\nfunction tempID() {\n  return \"temp://\" + iid++;\n}\nfunction isTempID(v) {\n  return typeof v === \"string\" && v.length === 20 && parseInt(v.substr(7)) > 1e12;\n}\nfunction isSameObject(left, right) {\n  if (Object.keys(left).length !== Object.keys(right).length) return false;\n  for (const key in right) {\n    const v = left[key];\n    const nv = right[key];\n    if (!isSame(v, nv)) return false;\n  }\n  return true;\n}\nfunction isSame(v, nv) {\n  const primitiveValue = typeof v === \"number\" || typeof v === \"string\" || typeof v === \"boolean\" || v === null;\n  if (primitiveValue) return v === nv;\n  if (typeof v !== typeof nv) return false;\n  if ((v === null || nv === null) && v !== nv) return false;\n  if (v instanceof Date && nv instanceof Date && v.getTime() !== nv.getTime())\n    return false;\n  if (typeof v === \"object\") {\n    if (Array.isArray(v) && Array.isArray(nv)) {\n      if (v.length !== nv.length) return false;\n      for (let i = v.length - 1; i >= 0; i--) {\n        if (!isSame(v[i], nv[i])) return false;\n      }\n      return true;\n    } else {\n      return isSameObject(v, nv);\n    }\n  }\n  return v === nv;\n}\nfunction deepCopy(obj) {\n  if (typeof obj !== \"object\") return obj;\n  if (obj === null) return obj;\n  if (obj instanceof Date) return new Date(obj);\n  if (obj instanceof Array) return obj.map(deepCopy);\n  const out = {};\n  for (const key in obj) {\n    out[key] = deepCopy(obj[key]);\n  }\n  return out;\n}\n\n// src/DataArray.ts\nvar _DataArray = class {\n  constructor(raw) {\n    this._data = raw;\n    this._pool = /* @__PURE__ */ new Map();\n    for (let i = 0; i < raw.length; i++) {\n      const obj = raw[i];\n      this._pool.set(obj.id, obj);\n    }\n  }\n  add(raw) {\n    raw = { id: uid(), ...raw };\n    this._data.push(raw);\n    this._pool.set(raw.id, raw);\n  }\n  update(id, raw) {\n    const index = this._data.findIndex((link) => link.id == id);\n    const old = this._data[index];\n    const updated = { ...old, ...raw };\n    this._data[index] = updated;\n    this._pool.set(updated.id, updated);\n  }\n  remove(id) {\n    this._data = this._data.filter((a) => a.id != id);\n    this._pool.delete(id);\n  }\n  filter(cb) {\n    this._data = this._data.filter((x) => {\n      const check = cb(x);\n      if (!check) this._pool.delete(x.id);\n      return check;\n    });\n  }\n  byId(id) {\n    return this._pool.get(id);\n  }\n  map(cb) {\n    return this._data.map(cb);\n  }\n  forEach(cb) {\n    this._data.forEach(cb);\n  }\n};\n\n// src/DataTree.ts\nvar DataTree = class {\n  constructor(raw) {\n    const top = {\n      id: 0,\n      $level: 0,\n      data: [],\n      parent: null\n    };\n    const items = /* @__PURE__ */ new Map();\n    items.set(0, top);\n    this._pool = items;\n    if (raw && raw.length) this.parse(raw, 0);\n  }\n  parse(raw, parent) {\n    const items = this._pool;\n    for (let i = 0; i < raw.length; i++) {\n      const obj = raw[i];\n      obj.parent = obj.parent || parent;\n      obj.data = null;\n      items.set(obj.id, obj);\n    }\n    for (let i = 0; i < raw.length; i++) {\n      const obj = raw[i];\n      const temp = items.get(obj.parent);\n      if (temp) {\n        if (!temp.data) temp.data = [];\n        temp.data.push(obj);\n      }\n    }\n    const top = items.get(parent);\n    this.setLevel(top, top.$level + 1, false);\n  }\n  add(raw, index) {\n    const parent = this._pool.get(raw.parent || 0);\n    raw.$level = parent.$level + 1;\n    this._pool.set(raw.id, raw);\n    if (parent.data) {\n      if (index === -1) parent.data = [...parent.data, raw];\n      else insertElement(parent, index, raw);\n    } else parent.data = [raw];\n  }\n  addAfter(raw, after) {\n    if (!after) {\n      return this.add(raw, -1);\n    }\n    const node = this.byId(after);\n    const parent = this.byId(node.parent);\n    const index = indexById(parent, node.id) + 1;\n    raw.parent = parent.id;\n    raw.$level = parent.$level + 1;\n    this.add(raw, index);\n  }\n  remove(id) {\n    const obj = this._pool.get(id);\n    this._remove(obj);\n    const parent = this._pool.get(obj.parent);\n    parent.data = parent.data.filter((a) => a.id != id);\n    this._clearBranch(parent);\n  }\n  _remove(obj) {\n    if (obj.data) {\n      obj.data.forEach((i) => this._remove(i));\n    }\n    this._pool.delete(obj.id);\n  }\n  update(id, values) {\n    let obj = this._pool.get(id);\n    const branch = this._pool.get(obj.parent);\n    const index = indexById(branch, obj.id);\n    obj = { ...obj, ...values };\n    if (branch && index >= 0) {\n      branch.data[index] = obj;\n      branch.data = [...branch.data];\n    }\n    this._pool.set(obj.id, obj);\n  }\n  move(id, mode, target) {\n    const now = this._pool.get(id);\n    const dropChild = mode === \"child\";\n    const tobj = this._pool.get(target);\n    const tLevel = tobj.$level + (dropChild ? 1 : 0);\n    if (!now || !tobj) return;\n    const parent = this._pool.get(now.parent);\n    const newParent = dropChild ? tobj : this._pool.get(tobj.parent);\n    if (!newParent.data) newParent.data = [];\n    const index = indexById(parent, now.id);\n    deleteElement(parent, index);\n    const newIndex = dropChild ? newParent.data.length : indexById(newParent, tobj.id) + (mode === \"after\" ? 1 : 0);\n    insertElement(newParent, newIndex, now);\n    if (parent.id === newParent.id && index === newIndex) return null;\n    now.parent = newParent.id;\n    if (now.$level !== tLevel) {\n      now.$level = tLevel;\n      this.setLevel(now, tLevel + 1, true);\n    }\n    this.update(now.id, now);\n    this._clearBranch(parent);\n  }\n  _clearBranch(obj) {\n    if (obj.data && !obj.data.length) {\n      if (obj.open) delete obj.open;\n      this.update(obj.id, { data: null });\n    }\n  }\n  toArray() {\n    const out = [];\n    const kids = this._pool.get(0).data;\n    if (kids) toArray(kids, out);\n    return out;\n  }\n  byId(id) {\n    return this._pool.get(id);\n  }\n  getBranch(id) {\n    return this._pool.get(id).data;\n  }\n  forEach(cb) {\n    this._pool.forEach((value, key) => {\n      if (key !== 0) cb(value);\n    });\n  }\n  eachChild(cb, parent) {\n    const p = this.byId(parent);\n    if (!p || !p.data) return;\n    p.data.forEach((child, index) => {\n      cb(this.byId(child.id), index);\n      this.eachChild(cb, child.id);\n    });\n  }\n  setLevel(root, level, copy) {\n    if (!root.data) return;\n    root.data = root.data.map((child) => {\n      if (copy) {\n        child = { ...child };\n        this._pool.set(child.id, child);\n      }\n      child.$level = level;\n      if (child.data) this.setLevel(child, level + 1, copy);\n      return child;\n    });\n  }\n};\nfunction toArray(line, out) {\n  line.forEach((a) => {\n    out.push(a);\n    if (a.open === true) {\n      toArray(a.data, out);\n    }\n  });\n}\nfunction deleteElement(obj, index) {\n  const newData = [...obj.data];\n  newData.splice(index, 1);\n  obj.data = newData;\n}\nfunction insertElement(obj, index, item) {\n  const newData = [...obj.data];\n  newData.splice(index, 0, item);\n  obj.data = newData;\n}\nfunction indexById(parentNode, id) {\n  return parentNode?.data.findIndex(\n    (child) => child.id === id\n  );\n}\n\n// src/Store.ts\nvar STORE_SET_SILENT = 2;\nvar Store = class {\n  constructor(config) {\n    if (config) {\n      this._writable = config.writable;\n      this._async = config.async;\n    }\n    this._values = {};\n    this._state = {};\n  }\n  setState(data, mode = 0) {\n    const signals = {};\n    this._wrapProperties(\n      data,\n      this._state,\n      this._values,\n      \"\",\n      signals,\n      mode\n    );\n    return signals;\n  }\n  getState() {\n    return this._values;\n  }\n  getReactive() {\n    return this._state;\n  }\n  _wrapProperties(data, state, values, parent, signals, mode) {\n    for (const key in data) {\n      const os = state[key];\n      const ov = values[key];\n      const nv = data[key];\n      if (os) {\n        if (ov === nv && typeof nv !== \"object\") continue;\n        if (nv instanceof Date) {\n          if (ov instanceof Date && ov.getTime() === nv.getTime()) continue;\n        }\n      }\n      const fullKey = parent + (parent ? \".\" : \"\") + key;\n      if (os) {\n        if (os.__parse(nv, fullKey, signals, mode)) values[key] = nv;\n        if (mode & STORE_SET_SILENT) signals[fullKey] = os.__trigger;\n        else os.__trigger();\n      } else {\n        if (nv && nv.__reactive) {\n          state[key] = this._wrapNested(nv, nv, fullKey, signals);\n        } else {\n          state[key] = this._wrapWritable(nv);\n        }\n        values[key] = nv;\n      }\n      signals[fullKey] = signals[fullKey] || null;\n    }\n  }\n  _wrapNested(data, values, fullKey, signals) {\n    const state = this._wrapWritable(data);\n    this._wrapProperties(data, state, values, fullKey, signals, 0);\n    state.__parse = (v, fullKey2, signals2, mode) => {\n      this._wrapProperties(v, state, values, fullKey2, signals2, mode);\n      return false;\n    };\n    return state;\n  }\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  _wrapWritable(val) {\n    const ss = [];\n    const __triggerSync = function() {\n      for (let i = 0; i < ss.length; i++) {\n        ss[i](val);\n      }\n    };\n    const __trigger = () => {\n      if (ss.length) {\n        if (this._async) setTimeout(__triggerSync, 1);\n        else __triggerSync();\n      }\n    };\n    const subscribe = (fn) => {\n      ss.push(fn);\n      if (this._async) setTimeout(fn, 1, val);\n      else fn(val);\n      return () => {\n        const i = ss.indexOf(fn);\n        if (i >= 0) ss.splice(i, 1);\n      };\n    };\n    const __parse = function(v) {\n      val = v;\n      return true;\n    };\n    return {\n      subscribe,\n      __trigger,\n      __parse\n    };\n  }\n};\nfunction markReactive(t, nested) {\n  Object.defineProperty(t, \"__reactive\", {\n    value: true,\n    enumerable: false,\n    writable: false\n  });\n  if (nested === true) {\n    for (const key in t) {\n      const sub = t[key];\n      if (typeof sub === \"object\" && sub !== null) {\n        markReactive(sub, true);\n      }\n    }\n  }\n  return t;\n}\n\n// src/DataRouter.ts\nvar DataRouter = class {\n  constructor(s, r, p, b) {\n    if (typeof s === \"function\") this._setter = s;\n    else this._setter = s.setState.bind(s);\n    this._routes = r;\n    this._parsers = p;\n    this._prev = {};\n    this._triggers = /* @__PURE__ */ new Map();\n    this._sources = /* @__PURE__ */ new Map();\n    this._routes.forEach((a) => {\n      a.in.forEach((k) => {\n        const arr = this._triggers.get(k) || [];\n        arr.push(a);\n        this._triggers.set(k, arr);\n      });\n      a.out.forEach((k) => {\n        const h = this._sources.get(k) || {};\n        a.in.forEach((i) => h[i] = true);\n        this._sources.set(k, h);\n      });\n    });\n    this._routes.forEach((a) => {\n      a.length = Math.max(\n        ...a.in.map((key) => _calckSize(key, this._sources, 1))\n      );\n    });\n    this._bus = b;\n  }\n  init(cfg) {\n    const next = {};\n    for (const key in cfg) {\n      if (this._prev[key] !== cfg[key]) {\n        const parser = this._parsers[key];\n        next[key] = parser ? parser(cfg[key]) : cfg[key];\n      }\n    }\n    this._prev = this._prev ? { ...this._prev, ...cfg } : { ...cfg };\n    this.setState(next);\n    if (this._bus) this._bus.exec(\"init-state\", next);\n  }\n  setStateAsync(updates) {\n    const signals = this._setter(updates, STORE_SET_SILENT);\n    if (this._async) {\n      Object.assign(this._async.signals, signals);\n    } else {\n      this._async = {\n        signals,\n        timer: setTimeout(this._applyState.bind(this), 1)\n      };\n    }\n    return signals;\n  }\n  _applyState() {\n    const obj = this._async;\n    if (!obj) return;\n    this._async = null;\n    this._triggerUpdates(obj.signals, []);\n    for (const key in obj.signals) {\n      const h = obj.signals[key];\n      if (h) h();\n    }\n  }\n  setState(updates, ctx = []) {\n    const signals = this._setter(updates);\n    this._triggerUpdates(signals, ctx);\n    return signals;\n  }\n  _triggerUpdates(signals, ctx) {\n    const keys = Object.keys(signals);\n    const needExec = !ctx.length;\n    ctx = ctx || [];\n    for (let i = 0; i < keys.length; i++) {\n      const key = keys[i];\n      const trgs = this._triggers.get(key);\n      if (trgs) {\n        trgs.forEach((a) => {\n          if (ctx.indexOf(a) == -1) {\n            ctx.push(a);\n          }\n        });\n      }\n    }\n    if (needExec) {\n      this._execNext(ctx);\n    }\n  }\n  _execNext(ctx) {\n    while (ctx.length) {\n      ctx.sort((a, b) => a.length < b.length ? 1 : -1);\n      const next = ctx[ctx.length - 1];\n      ctx.splice(ctx.length - 1);\n      next.exec(ctx);\n    }\n  }\n};\nfunction _calckSize(key, sources, prev) {\n  const next = sources.get(key);\n  if (!next) return prev;\n  const sizes = Object.keys(next).map((a) => _calckSize(a, sources, prev + 1));\n  return Math.max(...sizes);\n}\n\n// src/EventBus.ts\nvar EventBus = class {\n  constructor() {\n    this._nextHandler = null;\n    this._handlers = {};\n    this._tag = /* @__PURE__ */ new WeakMap();\n    this.exec = this.exec.bind(this);\n  }\n  on(name, handler, config) {\n    let prev = this._handlers[name];\n    if (!prev) {\n      prev = this._handlers[name] = [handler];\n    } else {\n      if (config && config.intercept) prev.unshift(handler);\n      else prev.push(handler);\n    }\n    if (config && config.tag) this._tag.set(handler, config.tag);\n  }\n  intercept(name, handler, config) {\n    this.on(name, handler, { ...config, intercept: true });\n  }\n  detach(tag) {\n    for (const key in this._handlers) {\n      const stack = this._handlers[key];\n      for (let i = stack.length - 1; i >= 0; i--) {\n        if (this._tag.get(stack[i]) === tag) {\n          stack.splice(i, 1);\n        }\n      }\n    }\n  }\n  async exec(name, ev) {\n    const stack = this._handlers[name];\n    if (stack) {\n      for (let i = 0; i < stack.length; i++) {\n        const res = stack[i](ev);\n        if (res === false) return;\n        if (res && res.then) {\n          const res2 = await res;\n          if (res2 === false) return;\n        }\n      }\n    }\n    if (this._nextHandler) await this._nextHandler.exec(name, ev);\n    return ev;\n  }\n  setNext(next) {\n    return this._nextHandler = next;\n  }\n};\n\n// src/EventResolver.ts\nvar EventResolver = class {\n  constructor(key) {\n    this._key = key;\n    this._nextHandler = null;\n    this.exec = this.exec.bind(this);\n  }\n  async exec(name, ev) {\n    if (ev && ev[this._key]) await ev[this._key](ev);\n    if (this._nextHandler) {\n      await this._nextHandler.exec(name, ev);\n    }\n    return ev;\n  }\n  setNext(next) {\n    return this._nextHandler = next;\n  }\n};\n\n// src/EventBusRouter.ts\nvar EventBusRouter = class {\n  constructor(dispatch) {\n    this._nextHandler = null;\n    this._dispatch = dispatch;\n    this.exec = this.exec.bind(this);\n  }\n  async exec(name, ev) {\n    this._dispatch(name, ev);\n    if (this._nextHandler) await this._nextHandler.exec(name, ev);\n    return ev;\n  }\n  setNext(next) {\n    return this._nextHandler = next;\n  }\n};\n\nexport { _DataArray as DataArray, DataRouter, DataTree, EventBus, EventBusRouter, EventResolver, Store, deepCopy, isSame, isTempID, markReactive, tempID, uid };\n//# sourceMappingURL=index.js.map\n//# sourceMappingURL=index.js.map","import type { IColumn, IRow, Value, ValueGetter, ValueSetter } from \"./types\";\n\nimport { uid } from \"@wx/lib-state\";\n\nfunction rawGetter(key: string): ValueGetter {\n\treturn obj => obj[key];\n}\nfunction rawSetter(key: string): ValueSetter {\n\treturn (obj, v) => (obj[key] = v);\n}\n\nexport function getValue(row: IRow, col: IColumn): any {\n\treturn (col.getter || rawGetter(col.id))(row);\n}\n\nexport function setValue(row: IRow, col: IColumn, v: Value): any {\n\treturn (col.setter || rawSetter(col.id))(row, v);\n}\n\nexport function getEditorConfig(columns: IColumn[]) {\n\treturn columns\n\t\t.filter(a => !!a.editor)\n\t\t.map(col => {\n\t\t\tlet obj: any = {\n\t\t\t\tkey: col.id || uid(),\n\t\t\t\tlabel: col.header,\n\t\t\t};\n\t\t\tif (col.options) obj.options = col.options;\n\t\t\tlet editor = col.editor;\n\t\t\tif (typeof editor === \"function\") editor = editor();\n\t\t\tif (typeof editor === \"object\") {\n\t\t\t\tobj = { ...obj, ...editor };\n\t\t\t\tobj.comp = editor.type;\n\t\t\t} else obj.comp = editor;\n\n\t\t\treturn obj;\n\t\t});\n}\n","import type { IColumn, IRow } from \"../types\";\nimport { getValue } from \"../editors\";\nexport function download(blob: any, filename: string) {\n\tconst a = document.createElement(\"a\");\n\ta.href = URL.createObjectURL(blob);\n\ta.download = filename;\n\tdocument.body.appendChild(a);\n\ta.click();\n\tdocument.body.removeChild(a);\n}\n\nexport function getRenderValue(row: IRow, col: IColumn): string {\n\tlet v = getValue(row, col) ?? \"\";\n\tif (col.template) v = col.template(v, row, col);\n\tif (col.optionsMap) {\n\t\tif (Array.isArray(v)) v = v.map(x => col.optionsMap.get(x));\n\t\telse v = col.optionsMap.get(v);\n\t}\n\treturn typeof v === \"undefined\" ? \"\" : v + \"\";\n}\n","import type { IColumn, IExportCell, IExportOptions, IData } from \"../types\";\nimport { getRenderValue } from \"./index\";\n\nexport function getCsvData(state: Partial<IData>, options: IExportOptions) {\n\tconst reg = /\\n|\"|;|,/;\n\tlet csv = \"\";\n\n\tconst rowSep = options.rows || \"\\n\";\n\tconst colSep = options.cols || \"\\t\";\n\n\tconst cols = state._columns;\n\tconst data = state.flatData;\n\n\tif (options.header !== false && cols[0].header)\n\t\tcsv = addCsvHeader(\"header\", cols, csv, colSep, rowSep);\n\n\tfor (let r = 0; r < data.length; r++) {\n\t\tconst row: IExportCell[] = [];\n\t\tfor (let c = 0; c < cols.length; c++) {\n\t\t\tlet value = getRenderValue(data[r], cols[c]);\n\n\t\t\tif (reg.test(value)) value = '\"' + value.replace(/\"/g, '\"\"') + '\"';\n\n\t\t\trow.push(value);\n\t\t}\n\t\tcsv += (csv ? rowSep : \"\") + row.join(colSep);\n\t}\n\n\tif (options.footer !== false && cols[0].footer)\n\t\tcsv = addCsvHeader(\"footer\", cols, csv, colSep, rowSep);\n\n\treturn csv;\n}\n\nfunction addCsvHeader(\n\ttype: \"header\" | \"footer\",\n\tcols: IColumn[],\n\tcsv: string,\n\tcolSep: string,\n\trowSep: string\n) {\n\tconst reg = /\\n|\"|;|,/;\n\tfor (let r = 0; r < cols[0][type as keyof IColumn].length; r++) {\n\t\tconst row: IExportCell[] = [];\n\t\tfor (let c = 0; c < cols.length; c++) {\n\t\t\tconst header = cols[c][type as keyof IColumn][r];\n\t\t\tlet value = (header.text || \"\") + \"\";\n\t\t\tif (reg.test(value)) value = '\"' + value.replace(/\"/g, '\"\"') + '\"';\n\t\t\trow.push(value);\n\t\t}\n\t\tcsv += (csv ? rowSep : \"\") + row.join(colSep);\n\t}\n\treturn csv;\n}\n","import type {\n\tIColumn,\n\tIExportCell,\n\tIExportMerged,\n\tIExportOptions,\n\tIExportColSize,\n\tIExportRowSize,\n\tIData,\n\tTExportStyles,\n\tTSkinName,\n\tIDataHash,\n\tValue,\n} from \"../types\";\nimport { getRenderValue } from \"./index\";\nimport { getValue } from \"../editors\";\nimport { isSame } from \"@wx/lib-state\";\n\nexport function getExcelData(\n\tstate: Partial<IData>,\n\toptions: IExportOptions,\n\tstyles: IDataHash<any>[]\n) {\n\tconst cells: IExportCell[][] = [];\n\tconst merged: IExportMerged[] = [];\n\tconst colSizes: IExportColSize[] = [];\n\tlet rowSizes: IExportRowSize[] = [];\n\tconst cols = state._columns;\n\tconst data = state.flatData;\n\tconst sizes = state._sizes;\n\n\tfor (const c of cols)\n\t\tcolSizes.push({\n\t\t\twidth: c.flexgrow ? sizes.columnWidth : c.width,\n\t\t});\n\n\tlet rIndex = 0;\n\n\tif (options.header !== false && cols[0].header) {\n\t\taddExcelHeader(\"header\", cols, cells, merged, rIndex, options, styles);\n\n\t\trowSizes = rowSizes.concat(\n\t\t\tsizes.headerRowHeights.map(height => ({ height }))\n\t\t);\n\t\trIndex += (<any>cols[0].header).length;\n\t}\n\n\tfor (let r = 0; r < data.length; r++) {\n\t\tconst dataRow: IExportCell[] = [];\n\t\tfor (let c = 0; c < cols.length; c++) {\n\t\t\tconst row = data[r];\n\t\t\tconst col = cols[c];\n\t\t\tconst value = getValue(row, col) ?? \"\";\n\t\t\tlet text = getRenderValue(row, col);\n\t\t\tlet newStyle;\n\t\t\tif (options.cellStyle)\n\t\t\t\tnewStyle = options.cellStyle(value, row, col);\n\n\t\t\tif (options.cellTemplate) {\n\t\t\t\ttext = options.cellTemplate(value, row, col) ?? text;\n\t\t\t}\n\n\t\t\tconst result = prepareCellValues(text, 2, newStyle, styles);\n\n\t\t\tdataRow.push(result);\n\t\t}\n\n\t\tcells.push(dataRow);\n\t\trowSizes.push({ height: sizes.rowHeight });\n\t}\n\trIndex += data.length;\n\n\tif (options.footer !== false && cols[0].footer) {\n\t\taddExcelHeader(\"footer\", cols, cells, merged, rIndex, options, styles);\n\t\trowSizes = rowSizes.concat(\n\t\t\tsizes.footerRowHeights.map(height => ({ height }))\n\t\t);\n\t}\n\treturn { cells, merged, rowSizes, colSizes, styles };\n}\n\nfunction addExcelHeader(\n\ttype: \"header\" | \"footer\",\n\tcols: IColumn[],\n\tcells: IExportCell[][],\n\tmerged: IExportMerged[],\n\trIndex: number,\n\toptions: IExportOptions,\n\tstyles: IDataHash<any>[]\n) {\n\tfor (let r = 0; r < cols[0][type as keyof IColumn].length; r++) {\n\t\tconst row: IExportCell[] = [];\n\t\tfor (let c = 0; c < cols.length; c++) {\n\t\t\tconst header = cols[c][type as keyof IColumn][r];\n\t\t\tconst colspan = header.colspan ? header.colspan - 1 : 0;\n\t\t\tconst rowspan = header.rowspan ? header.rowspan - 1 : 0;\n\t\t\tif (colspan || rowspan) {\n\t\t\t\tmerged.push({\n\t\t\t\t\tfrom: { row: r + rIndex, column: c },\n\t\t\t\t\tto: { row: r + rIndex + rowspan, column: c + colspan },\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tlet v = header.text ?? \"\";\n\t\t\tlet newStyle;\n\n\t\t\tif (options.headerCellStyle)\n\t\t\t\tnewStyle = options.headerCellStyle(v, header, cols[c], type);\n\n\t\t\tif (options.headerCellTemplate)\n\t\t\t\tv = options.headerCellTemplate(v, header, cols[c], type) ?? v;\n\n\t\t\tlet s;\n\t\t\tif (type == \"header\") {\n\t\t\t\tif (r == cols[0][type as keyof IColumn].length - 1) s = 1;\n\t\t\t\telse s = 0;\n\t\t\t} else if (r) s = 4;\n\t\t\telse s = 3;\n\n\t\t\tconst result = prepareCellValues(v, s, newStyle, styles);\n\t\t\trow.push(result);\n\t\t}\n\t\tcells.push(row);\n\t}\n}\n\nfunction prepareCellValues(\n\tv: Value,\n\tbaseIndex: number,\n\tnewStyle: IDataHash<any>,\n\tstyles: IDataHash<any>[]\n) {\n\tlet s = baseIndex;\n\tif (v && v instanceof Date) {\n\t\tv = getExcelDate(v);\n\t\tnewStyle = newStyle || {};\n\t\tnewStyle.format = newStyle.format || \"dd/mm/yyyy\";\n\t}\n\tif (newStyle) {\n\t\tnewStyle = { ...styles[baseIndex], ...newStyle };\n\t\tconst i = styles.findIndex(style => isSame(style, newStyle));\n\t\tif (i < 0) {\n\t\t\tstyles.push(newStyle);\n\t\t\ts = styles.length - 1;\n\t\t} else s = i;\n\t}\n\treturn { v: v + \"\", s };\n}\n\nexport function getExportStyles(skin: TSkinName): TExportStyles {\n\tconst fontColor = {\n\t\tmaterial: \"#000000\",\n\t\twillow: \"#000000\",\n\t\t\"willow-dark\": \"#ffffff\",\n\t};\n\n\tconst bg = {\n\t\tmaterial: \"none\",\n\t\twillow: \"none\",\n\t\t\"willow-dark\": \"#2a2b2d\",\n\t};\n\tconst headerBg = {\n\t\tmaterial: \"#fafafb\",\n\t\twillow: \"#f2f3f7\",\n\t\t\"willow-dark\": \"#20262b\",\n\t};\n\n\tconst border = {\n\t\tmaterial: \"0.5px solid #dfdfdf\",\n\t\twillow: \"0.5px solid #e6e6e6\",\n\t\t\"willow-dark\": \"0.5px solid #384047\",\n\t};\n\n\tconst headerBorderColor = {\n\t\tmaterial: \"#dfdfdf\",\n\t\twillow: \"#e6e6e6\",\n\t\t\"willow-dark\": \"#384047\",\n\t};\n\n\tconst color = fontColor[skin];\n\tconst hBorder = \"0.5px solid \" + headerBorderColor[skin];\n\tconst align = {\n\t\tverticalAlign: \"center\",\n\t\talign: \"left\",\n\t};\n\tconst headerStyles = {\n\t\tfontWeight: \"bold\",\n\t\tcolor,\n\t\tbackground: headerBg[skin],\n\t\t...align,\n\t\tborderBottom: hBorder,\n\t\tborderRight: hBorder,\n\t};\n\n\tconst styles = {\n\t\tcell: {\n\t\t\tcolor,\n\t\t\tbackground: bg[skin],\n\t\t\tborderBottom: border[skin],\n\t\t\tborderRight: border[skin],\n\t\t\t...align,\n\t\t},\n\t\theader: { ...headerStyles },\n\t\tfooter: { ...headerStyles },\n\t};\n\treturn styles;\n}\n\nfunction getExcelDate(date: Date): number {\n\tif (!date) return null;\n\tconst returnDateTime =\n\t\t25569 +\n\t\t(date.getTime() - date.getTimezoneOffset() * 60000) / (86400 * 1000);\n\treturn returnDateTime;\n}\n","import type {\n\tIFilterValues,\n\tIPrintConfig,\n\tIRenderColumn,\n\tIRenderHeaderCell,\n\tTColumnType,\n} from \"./types\";\n\n// default config and sizes\nconst MODE = \"portrait\";\nconst PPI = 100;\nconst PAPER = \"a4\";\nconst PAPERS = {\n\ta3: { width: 11.7, height: 16.5 },\n\ta4: { width: 8.27, height: 11.7 },\n\tletter: { width: 8.5, height: 11 },\n};\n\nexport function getPrintColumns(\n\tcolumns: IRenderColumn[],\n\tconfig: IPrintConfig\n) {\n\tconst tables: IRenderColumn[][] = [];\n\n\tlet cols: IRenderColumn[] = [];\n\tlet width: number = 0;\n\n\tconst visibleColumns = columns.filter(col => !col.hidden);\n\n\tconst maxWidth = getPaperWidth(config);\n\n\tvisibleColumns.forEach((v, index) => {\n\t\tif (width + v.width <= maxWidth) {\n\t\t\twidth += v.width;\n\t\t\tcols.push(v);\n\t\t} else {\n\t\t\tif (cols.length) tables.push(cols);\n\n\t\t\tcols = [v];\n\t\t\twidth = v.width;\n\t\t}\n\n\t\tif (index === visibleColumns.length - 1 && cols.length) {\n\t\t\ttables.push(cols);\n\t\t}\n\t});\n\n\treturn tables;\n}\n\nexport function getHeaderFooterPrintColumns(\n\tcolumns: IRenderColumn[],\n\ttype: TColumnType,\n\trowsHeights: number[]\n): IRenderHeaderCell[][] {\n\tconst result: IRenderHeaderCell[][] = [];\n\n\tcolumns.forEach((col, c) => {\n\t\tconst header = col[type];\n\n\t\tfor (let r = 0; r < rowsHeights.length; r++) {\n\t\t\tif (!result[r]) result[r] = [];\n\t\t\tconst hcell = { ...header[r] };\n\n\t\t\tif (result[r][c] !== null) {\n\t\t\t\t// for the case when the сolspan was divided into parts in order to fit on the sheet, need to create new cell\n\t\t\t\tif (!c && !hcell.rowspan && !hcell.colspan) {\n\t\t\t\t\tlet colspan = 1;\n\t\t\t\t\tlet nextCell = columns[c + colspan][type][r];\n\t\t\t\t\tlet width = hcell.width;\n\t\t\t\t\twhile (!nextCell.rowspan && !nextCell.colspan) {\n\t\t\t\t\t\tcolspan++;\n\t\t\t\t\t\tnextCell = columns[c + colspan][type][r];\n\t\t\t\t\t\twidth += nextCell.width;\n\t\t\t\t\t}\n\t\t\t\t\thcell.colspan = colspan;\n\t\t\t\t\thcell.width = width;\n\t\t\t\t\thcell.height = rowsHeights[r];\n\t\t\t\t}\n\t\t\t\tresult[r].push(hcell);\n\n\t\t\t\tif (!hcell.collapsed && hcell.colspan > 1) {\n\t\t\t\t\tlet colstubs = hcell.colspan - 1;\n\t\t\t\t\t// for the case when the сolspan goes beyond the sheet width\n\t\t\t\t\tif (hcell.colspan + c > columns.length) {\n\t\t\t\t\t\tconst colspan =\n\t\t\t\t\t\t\thcell.colspan -\n\t\t\t\t\t\t\t(hcell.colspan + c - columns.length);\n\n\t\t\t\t\t\thcell.colspan = colspan;\n\t\t\t\t\t\thcell.width = columns\n\t\t\t\t\t\t\t.slice(c, c + colstubs + 1)\n\t\t\t\t\t\t\t.reduce((a, b) => a + b.width, 0);\n\n\t\t\t\t\t\tif (colspan > 1) colstubs = colspan - 1;\n\t\t\t\t\t}\n\t\t\t\t\tfor (let y = 0; y < colstubs; y++) result[r].push(null);\n\t\t\t\t}\n\t\t\t\tif (hcell.rowspan > 1) {\n\t\t\t\t\tconst rowstubs = hcell.rowspan;\n\t\t\t\t\tfor (let y = 1; y < rowstubs; y++) {\n\t\t\t\t\t\tif (!result[r + y]) result[r + y] = [];\n\t\t\t\t\t\tresult[r + y].push(null);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (col.collapsed) {\n\t\t\tfor (let i = 0; i < result.length; i++) {\n\t\t\t\tconst rRow = result[i];\n\t\t\t\tconst currentCell = rRow[c];\n\n\t\t\t\tif (currentCell && currentCell.collapsed) {\n\t\t\t\t\trRow[c] = null;\n\t\t\t\t\tif (!i) break;\n\t\t\t\t} else {\n\t\t\t\t\tconst lastCell =\n\t\t\t\t\t\tcurrentCell ||\n\t\t\t\t\t\trRow.findLast(cell => cell?.colspan >= 1);\n\t\t\t\t\tif (lastCell) {\n\t\t\t\t\t\tlastCell.colspan = lastCell.colspan - 1;\n\t\t\t\t\t\tlastCell.width = lastCell.width - col.width;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\treturn result.map(row => row.filter(c => c && c.colspan !== 0));\n}\n\nfunction getPaperWidth(config: IPrintConfig) {\n\tconst { mode, ppi, paper } = config;\n\tconst { width, height } = PAPERS[paper];\n\n\treturn getPixels(mode === \"portrait\" ? width : height, ppi);\n}\n\nfunction getPixels(inches: number, ppi: number) {\n\treturn inches * ppi;\n}\n\nexport function normalizePrintConfig(config: IPrintConfig = {}) {\n\tconst { mode, ppi, paper } = config;\n\n\treturn {\n\t\tmode: mode || MODE,\n\t\tppi: ppi || PPI,\n\t\tpaper: paper || PAPER,\n\t};\n}\n\nexport function getPrintCellStyle(\n\tcell: IRenderHeaderCell,\n\tcolumnWidth: number\n) {\n\tif (cell.flexgrow) return `min-width:${columnWidth}px;width:auto`;\n\treturn `width:${cell.width}px; max-width:${cell.width}px; height:${cell.height}px`;\n}\n\nexport function getPrintFilterValue(\n\tfilterValues: IFilterValues,\n\tcolumns: IRenderColumn[],\n\tcell: IRenderHeaderCell\n) {\n\tlet value = filterValues[cell.id];\n\tif (cell.filter.type === \"richselect\" && value) {\n\t\tconst options =\n\t\t\tcell.filter.config?.options ||\n\t\t\tcolumns.find(({ id }) => id == cell.id).options;\n\t\tif (options) {\n\t\t\tvalue = options.find(({ id }) => id == value).label;\n\t\t}\n\t}\n\treturn value ?? \"\";\n}\n","import { deepCopy, EventBus, TID, isSame } from \"@wx/lib-state\";\nimport type { IDataMethodsConfig } from \"./DataStore\";\nimport { getValue } from \"./editors\";\nimport { IColumn, IData, IRow, TMethodsConfig } from \"./types\";\n\ntype ActionType = keyof IDataMethodsConfig;\ninterface ActionData<T extends ActionType> {\n\taction: T;\n\tdata: IDataMethodsConfig[T];\n}\n\ninterface HistoryEntry extends ActionData<ActionType> {\n\tsource: ActionData<ActionType>;\n}\n\nconst COLUMNS_ACTIONS = [\"resize-column\", \"hide-column\", \"update-cell\"];\nconst DATA_ACTIONS = [\"delete-row\", \"update-row\", \"update-cell\"];\nconst FLATDATA_ACTIONS = [\"move-item\"];\nconst PROGRESS_ACTIONS = [\"resize-column\", \"move-item\"];\n\nexport class HistoryManager {\n\tprivate undo: HistoryEntry[] = [];\n\tprivate redo: HistoryEntry[] = [];\n\tprivate progress: Partial<Record<ActionType, boolean>> = {};\n\tprivate in: EventBus<TMethodsConfig, keyof TMethodsConfig>;\n\tprivate getState: () => Partial<IData>;\n\tprivate setState: (state: Partial<IData>) => void;\n\tprivate _previousValues: Partial<IData> = {};\n\n\tconstructor(\n\t\teventBus: EventBus<TMethodsConfig, keyof TMethodsConfig>,\n\t\tstateGetter: () => Partial<IData>,\n\t\tstateSetter: (state: Partial<IData>) => void\n\t) {\n\t\tthis.in = eventBus;\n\t\tthis.getState = stateGetter;\n\t\tthis.setState = stateSetter;\n\t\tthis.setHandlers();\n\n\t\tthis.resetStateHistory();\n\t}\n\n\tgetHandlers(): { [key: string]: { handler: (ev: any) => HistoryEntry } } {\n\t\treturn {\n\t\t\t\"add-row\": {\n\t\t\t\thandler: (ev: IDataMethodsConfig[\"add-row\"]) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\taction: \"delete-row\",\n\t\t\t\t\t\tdata: { id: ev.id },\n\t\t\t\t\t\tsource: { action: \"add-row\", data: ev },\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\t\"delete-row\": {\n\t\t\t\thandler: (ev: IDataMethodsConfig[\"delete-row\"]) => {\n\t\t\t\t\tconst { id } = ev;\n\n\t\t\t\t\tconst { data } = this.getPrev();\n\t\t\t\t\tconst rowIndex = data.findIndex(a => a.id == id);\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\taction: \"add-row\",\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\trow: data[rowIndex],\n\t\t\t\t\t\t\tbefore:\n\t\t\t\t\t\t\t\trowIndex < data.length - 1\n\t\t\t\t\t\t\t\t\t? data[rowIndex + 1].id\n\t\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsource: { action: \"delete-row\", data: ev },\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\t\"update-cell\": {\n\t\t\t\thandler: (ev: IDataMethodsConfig[\"update-cell\"]) => {\n\t\t\t\t\tconst { id, column } = ev;\n\n\t\t\t\t\tconst row = this.getRow(id);\n\t\t\t\t\tconst col = this.getColumn(column);\n\n\t\t\t\t\tconst prevValue = getValue(row, col);\n\t\t\t\t\t// isSame is for dates\n\t\t\t\t\treturn !isSame(prevValue, ev.value)\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\taction: \"update-cell\",\n\t\t\t\t\t\t\t\tdata: { id, column, value: prevValue },\n\t\t\t\t\t\t\t\tsource: { action: \"update-cell\", data: ev },\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t: null;\n\t\t\t\t},\n\t\t\t},\n\t\t\t\"update-row\": {\n\t\t\t\thandler: (ev: IDataMethodsConfig[\"update-row\"]) => {\n\t\t\t\t\tconst { id } = ev;\n\n\t\t\t\t\tconst rowData = this.getRow(id);\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\taction: \"update-row\",\n\t\t\t\t\t\tdata: { id, row: rowData },\n\t\t\t\t\t\tsource: { action: \"update-row\", data: ev },\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\t\"resize-column\": {\n\t\t\t\thandler: (ev: IDataMethodsConfig[\"resize-column\"]) => {\n\t\t\t\t\tconst { id, width } = ev;\n\t\t\t\t\tconst column = this.getColumn(id);\n\t\t\t\t\tconst { _sizes: sizes } = this.getState();\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\taction: \"resize-column\",\n\t\t\t\t\t\tdata: { id, width: column.width ?? sizes.columnWidth },\n\t\t\t\t\t\tsource: {\n\t\t\t\t\t\t\taction: \"resize-column\",\n\t\t\t\t\t\t\tdata: { id, width },\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\t\"hide-column\": {\n\t\t\t\thandler: (ev: IDataMethodsConfig[\"hide-column\"]) => {\n\t\t\t\t\tconst { id } = ev;\n\t\t\t\t\tconst column = this.getColumn(id);\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\taction: \"hide-column\",\n\t\t\t\t\t\tdata: { id, mode: column.hidden },\n\t\t\t\t\t\tsource: {\n\t\t\t\t\t\t\taction: \"hide-column\",\n\t\t\t\t\t\t\tdata: ev,\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\t\"collapse-column\": {\n\t\t\t\thandler: (ev: IDataMethodsConfig[\"collapse-column\"]) => {\n\t\t\t\t\tconst { id, row, mode } = ev;\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\taction: \"collapse-column\",\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\trow,\n\t\t\t\t\t\t\tmode: typeof mode === \"boolean\" ? !mode : mode,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsource: { action: \"collapse-column\", data: ev },\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\t\"move-item\": {\n\t\t\t\thandler: (ev: IDataMethodsConfig[\"move-item\"]) => {\n\t\t\t\t\tconst { id, target, mode } = ev;\n\t\t\t\t\tconst { flatData } = this.getPrev();\n\n\t\t\t\t\tconst sourceIndex = flatData.findIndex(a => a.id == id);\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\taction: \"move-item\",\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\ttarget: flatData[\n\t\t\t\t\t\t\t\tsourceIndex + (sourceIndex ? -1 : 1)\n\t\t\t\t\t\t\t].id,\n\t\t\t\t\t\t\tmode: sourceIndex ? \"after\" : \"before\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsource: {\n\t\t\t\t\t\t\taction: \"move-item\",\n\t\t\t\t\t\t\tdata: { id, target, mode },\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\t\"open-row\": {\n\t\t\t\thandler: (ev: IDataMethodsConfig[\"open-row\"]) => {\n\t\t\t\t\tconst { id, nested } = ev;\n\t\t\t\t\treturn {\n\t\t\t\t\t\taction: \"close-row\",\n\t\t\t\t\t\tdata: { id, nested },\n\t\t\t\t\t\tsource: { action: \"open-row\", data: ev },\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\t\"close-row\": {\n\t\t\t\thandler: (ev: IDataMethodsConfig[\"close-row\"]) => {\n\t\t\t\t\tconst { id, nested } = ev;\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\taction: \"open-row\",\n\t\t\t\t\t\tdata: { id, nested },\n\t\t\t\t\t\tsource: { action: \"close-row\", data: ev },\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\tresetHistory() {\n\t\tthis.undo = [];\n\t\tthis.redo = [];\n\t\tthis.progress = {};\n\n\t\tthis.resetStateHistory();\n\t}\n\n\tprivate getPrev() {\n\t\treturn this._previousValues;\n\t}\n\n\tprivate setHandlers() {\n\t\tconst handlers = this.getHandlers();\n\n\t\tfor (const action in handlers) {\n\t\t\tthis.in.intercept(action as ActionType, (ev: any) => {\n\t\t\t\tif (\n\t\t\t\t\tev.eventSource === \"undo\" ||\n\t\t\t\t\tev.eventSource === \"redo\" ||\n\t\t\t\t\tev.skipUndo\n\t\t\t\t)\n\t\t\t\t\treturn;\n\n\t\t\t\tif (PROGRESS_ACTIONS.includes(action)) {\n\t\t\t\t\tif (\n\t\t\t\t\t\t(ev.inProgress &&\n\t\t\t\t\t\t\t!this.progress[action as ActionType]) ||\n\t\t\t\t\t\ttypeof ev.inProgress !== \"boolean\"\n\t\t\t\t\t) {\n\t\t\t\t\t\tif (FLATDATA_ACTIONS.includes(action))\n\t\t\t\t\t\t\tthis.setPrev(\"flatData\");\n\t\t\t\t\t\tif (COLUMNS_ACTIONS.includes(action))\n\t\t\t\t\t\t\tthis.setPrev(\"columns\");\n\t\t\t\t\t}\n\t\t\t\t\tthis.progress[action as ActionType] = ev.inProgress;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (DATA_ACTIONS.includes(action)) this.setPrev(\"data\");\n\t\t\t\tif (COLUMNS_ACTIONS.includes(action)) this.setPrev(\"columns\");\n\t\t\t});\n\n\t\t\tthis.in.on(action as ActionType, (ev: any) => {\n\t\t\t\tif (\n\t\t\t\t\tev.eventSource === \"undo\" ||\n\t\t\t\t\tev.eventSource === \"redo\" ||\n\t\t\t\t\tev.skipUndo ||\n\t\t\t\t\tev.inProgress\n\t\t\t\t)\n\t\t\t\t\treturn;\n\n\t\t\t\tconst historyEntry = handlers[action].handler(ev);\n\t\t\t\tif (historyEntry) this.addToHistory(historyEntry);\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate setPrev(prop: keyof IData) {\n\t\t(this._previousValues as any)[prop] = deepCopy(this.getState()[prop]);\n\t}\n\n\tprivate addToHistory(entry: HistoryEntry) {\n\t\tthis.undo.push(entry);\n\t\tthis.redo = [];\n\n\t\tthis.setStateHistory();\n\t}\n\n\thandleUndo() {\n\t\tif (!this.undo.length) return;\n\n\t\tconst action = this.undo.pop();\n\t\tthis.redo.push({ ...action.source, source: action });\n\n\t\tthis.in.exec(action.action, {\n\t\t\t...action.data,\n\t\t\teventSource: \"undo\",\n\t\t} as any);\n\n\t\tthis.setStateHistory();\n\t}\n\n\thandleRedo() {\n\t\tif (!this.redo.length) return;\n\n\t\tconst action = this.redo.pop();\n\t\tthis.undo.push({ ...action.source, source: action });\n\n\t\tthis.in.exec(action.action, {\n\t\t\t...action.data,\n\t\t\teventSource: \"redo\",\n\t\t} as any);\n\n\t\tthis.setStateHistory();\n\t}\n\n\tprivate resetStateHistory() {\n\t\tthis.setState({ history: { undo: 0, redo: 0 } });\n\t}\n\n\tprivate setStateHistory() {\n\t\tthis.setState({\n\t\t\thistory: {\n\t\t\t\tundo: this.undo.length,\n\t\t\t\tredo: this.redo.length,\n\t\t\t},\n\t\t});\n\t}\n\n\tprivate getRow(id: TID): IRow {\n\t\tconst { data } = this.getPrev();\n\n\t\tif (this.getState().tree) return this.getTreeRow(data, id);\n\n\t\treturn data.find(a => a.id == id);\n\t}\n\n\tprivate getTreeRow(data: IRow[], id: TID): IRow {\n\t\tfor (let i = 0; i < data.length; i++) {\n\t\t\tif (data[i].id == id) return data[i];\n\t\t\tif (data[i].data) {\n\t\t\t\tconst res = this.getTreeRow(data[i].data, id);\n\t\t\t\tif (res) return res;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tprivate getColumn(id: TID): IColumn {\n\t\tconst { columns } = this.getPrev();\n\t\treturn columns.find(a => a.id == id);\n\t}\n}\n","// #if [WX_PACKAGE_TYPE=trial]\nfunction checkStrings() {\n\tif (typeof window === \"undefined\") return true;\n\tconst l = location.hostname;\n\tconst t = [\n\t\t// svar.dev\n\t\t\"c3Zhci5kZXY=\",\n\t\t// dhtmlx.com\n\t\t\"ZGh0bWx4LmNvbQ==\",\n\t\t// dhtmlxcode.com\n\t\t\"ZGh0bWx4Y29kZS5jb20=\",\n\t\t// webixcode.com\n\t\t\"d2ViaXhjb2RlLmNvbQ==\",\n\t\t// webix.io\n\t\t\"d2ViaXguaW8=\",\n\t\t// repl.co\n\t\t\"cmVwbC5jbw==\",\n\t\t// csb.app\n\t\t\"Y3NiLmFwcA==\",\n\t\t// replit.dev\n\t\t\"cmVwbGl0LmRldg==\",\n\t];\n\n\tfor (let i = 0; i < t.length; i++) {\n\t\tconst x = window.atob(t[i]);\n\t\tif (x === l || l.endsWith(\".\" + x)) return true;\n\t}\n\n\treturn false;\n}\n\nconst amode = checkStrings();\n\nexport function isValid() {\n\treturn amode;\n}\n\nexport function isExpired() {\n\treturn new Date().valueOf() > 0x00ffffff * 256000;\n}\n\nexport function isBadLuck() {\n\treturn Math.random() < 0.05;\n}\n// #endif\n\nexport function getStamp() {\n\treturn { gen: 1 };\n}\n\nexport function isCommunity() {\n\tlet community = true;\n\t// #if [!(WX_PACKAGE_TYPE=open)]\n\tcommunity = false;\n\t// #endif\n\treturn community;\n}\n","import { getValue } from \"./editors\";\nimport type { TSortObject, TSortValue, TSortConfig, IColumn } from \"./types\";\n\nfunction sortAsc(a: TSortValue, b: TSortValue): number {\n\tif (typeof a === \"undefined\" || a === null) return -1;\n\tif (typeof b === \"undefined\" || b === null) return 1;\n\treturn a === b ? 0 : a > b ? 1 : -1;\n}\n\nfunction sortDesc(a: TSortValue, b: TSortValue): number {\n\treturn -sortAsc(a, b);\n}\n\nfunction sortBy(order: string, column: IColumn) {\n\tconst sortMethod = order === \"asc\" ? sortAsc : sortDesc;\n\treturn function (a: TSortObject, b: TSortObject) {\n\t\treturn sortMethod(getValue(a, column), getValue(b, column));\n\t};\n}\n\nexport function sortByMany(sortArray: TSortConfig[], columns: IColumn[]) {\n\tif (!sortArray || !sortArray.length) return;\n\n\tconst sorts = sortArray.map(item =>\n\t\tsortBy(\n\t\t\titem.order,\n\t\t\tcolumns.find(c => c.id == item.key)\n\t\t)\n\t);\n\tif (sortArray.length === 1) return sorts[0];\n\n\treturn function (a: TSortObject, b: TSortObject) {\n\t\tfor (let i = 0; i < sorts.length; i++) {\n\t\t\tconst res = sorts[i](a, b);\n\t\t\tif (res !== 0) return res;\n\t\t}\n\t\treturn 0;\n\t};\n}\n","import type {\n\tIRenderColumn,\n\tTColumnType,\n\tIColumn,\n\tIRow,\n\tTSkinName,\n} from \"./types\";\n\nimport { getRenderValue } from \"./export\";\n\nconst BASE_CELL_OFFSET = 28; // base offset for grid cells\nconst SORT_EL_OFFSET = 20; // offset for sort arrows\n\nexport function suggestSkin() {\n\t// FIXME :: Svelte-kit\n\tif (typeof document === \"undefined\") return \"willow\";\n\n\tconst skin = document.querySelector('[class^=\"wx\"][class$=\"theme\"]');\n\tif (!skin) return \"willow\";\n\n\treturn skin.className.substring(3, skin.className.length - 6) as TSkinName;\n}\n\nfunction getTextSize(\n\ttext: string | number | (string | number)[],\n\tcss: string,\n\tskin: string,\n\toffsets?: number[],\n\tbasewidth?: string | number\n): { width: number; height: number } {\n\tconst container = document.createElement(\"div\");\n\tconst content = document.createElement(\"div\");\n\n\tconst target = document.body;\n\tbasewidth = basewidth ? `${basewidth}px` : \"auto\";\n\tlet width;\n\tlet height;\n\n\tcontent.className = css;\n\tcontainer.classList.add(`wx-${skin}-theme`);\n\tcontainer.style.cssText = `height:auto;position:absolute;top:0px;left:100px;overflow:hidden;width=${basewidth};white-space:nowrap;`;\n\n\tcontainer.appendChild(content);\n\ttarget.appendChild(container);\n\n\tif (typeof text != \"object\") text = [text];\n\n\tfor (let i = 0; i < text.length; i++) {\n\t\tcontent.innerText = text[i] + \"\";\n\n\t\tconst rect = container.getBoundingClientRect();\n\t\tconst rectWidth =\n\t\t\tMath.ceil(rect.width) +\n\t\t\t(offsets && offsets.length ? offsets[i] : 0);\n\t\tconst rectHeight = Math.ceil(rect.height);\n\n\t\twidth = Math.max(width || 0, rectWidth);\n\t\theight = Math.max(height || 0, rectHeight);\n\t}\n\n\tcontainer.remove();\n\n\treturn { width, height };\n}\n\nexport function getHeaderFooterHeights(\n\tcolumns: IRenderColumn[],\n\tcondition: TColumnType,\n\trowsCount: number,\n\tdefaultHeight: number,\n\tskin: string\n) {\n\tconst headerRowHeights: number[] = [];\n\n\tfor (let c = 0; c < columns.length; c++) {\n\t\tconst column = columns[c][condition];\n\t\tconst length = column.length;\n\n\t\tfor (let r = 0; r < length; r++) {\n\t\t\tconst { text, vertical, collapsed, rowspan, css } = column[r];\n\n\t\t\tif (!text) {\n\t\t\t\theaderRowHeights[r] = Math.max(\n\t\t\t\t\theaderRowHeights[r] || 0,\n\t\t\t\t\tdefaultHeight\n\t\t\t\t);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet height = 0;\n\n\t\t\tif (vertical && !collapsed) {\n\t\t\t\tlet cellCss = `wx-measure-cell-${condition}`;\n\t\t\t\tcellCss += css ? ` ${css}` : \"\";\n\n\t\t\t\theight = getTextSize(text, cellCss, skin).width;\n\n\t\t\t\t// need to find out if current vertical cell is a rowspan\n\t\t\t\tif ((rowspan > 1 || !column[r + 1]) && rowsCount > r + 1) {\n\t\t\t\t\t// need to calculate previous sum of same rows heights.\n\t\t\t\t\t// if sum is less then current height than need to add diff btw sum and height to each cell\n\t\t\t\t\tconst count = rowspan || rowsCount - r;\n\t\t\t\t\tconst prevHeight = headerRowHeights\n\t\t\t\t\t\t.slice(r, r + count)\n\t\t\t\t\t\t.reduce((sum, value) => sum + value, 0);\n\n\t\t\t\t\tif (prevHeight < height) {\n\t\t\t\t\t\tconst diff = Math.ceil((height - prevHeight) / count);\n\t\t\t\t\t\tfor (let i = r; i < r + count; i++)\n\t\t\t\t\t\t\theaderRowHeights[i] =\n\t\t\t\t\t\t\t\t(headerRowHeights[i] || defaultHeight) + diff;\n\t\t\t\t\t}\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\theaderRowHeights[r] = Math.max(\n\t\t\t\theaderRowHeights[r] || defaultHeight,\n\t\t\t\theight\n\t\t\t);\n\t\t}\n\t}\n\n\treturn headerRowHeights;\n}\n\nexport function getColumnWidth(col: IColumn, data: IRow[], skin: string) {\n\tconst text = [];\n\tconst offsets = [];\n\n\tlet css = \"wx-measure-cell-body\";\n\n\tcss += col.css ? ` ${col.css}` : \"\";\n\n\tfor (let i = 0; i < data.length; i++) {\n\t\tconst row = data[i];\n\t\tconst colText = getRenderValue(row, col);\n\n\t\tif (colText) {\n\t\t\ttext.push(colText);\n\n\t\t\tif (col.treetoggle) {\n\t\t\t\toffsets.push(\n\t\t\t\t\tdata[i].$level * BASE_CELL_OFFSET +\n\t\t\t\t\t\t(data[i].$count ? BASE_CELL_OFFSET : 0) +\n\t\t\t\t\t\t(col.draggable ? BASE_CELL_OFFSET : 0)\n\t\t\t\t);\n\t\t\t} else if (col.draggable) {\n\t\t\t\toffsets.push(BASE_CELL_OFFSET);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn getTextSize(text, css, skin, offsets).width;\n}\n\nexport function getHeaderColWidth(column: IColumn, skin: string): number {\n\tconst css = \"wx-measure-cell-header\";\n\tconst sortElOffset = column.sort ? SORT_EL_OFFSET : 0;\n\tlet header = column.header;\n\tif (typeof header === \"string\")\n\t\treturn getTextSize(header, css, skin).width + sortElOffset;\n\n\tlet width: number;\n\n\tif (!Array.isArray(header)) header = [header];\n\n\tfor (let i = 0; i < header.length; i++) {\n\t\tconst cell = header[i];\n\t\tconst text = typeof cell === \"string\" ? cell : cell.text;\n\t\tconst style = css + (typeof cell === \"string\" ? \"\" : ` ${cell.css}`);\n\t\tlet currWidth = getTextSize(text, style, skin).width;\n\t\tif (i === header.length - 1) currWidth += sortElOffset;\n\n\t\twidth = Math.max(width || 0, currWidth);\n\t}\n\n\treturn width;\n}\n","import { TFilterHandler, TFilterType } from \"./types\";\n\nexport const filtersHandlers: { [key: string]: TFilterHandler } = {\n\ttext: (a: string, b: string) => {\n\t\tif (a) return a.toLowerCase().indexOf(b.toLowerCase()) !== -1;\n\t\treturn !b;\n\t},\n\trichselect: (a: string | number, b: string | number) => {\n\t\tif (typeof b !== \"number\" && !b) return true;\n\t\treturn a == b;\n\t},\n};\n\nexport function getFilterHandler(type: TFilterType): TFilterHandler {\n\treturn filtersHandlers[type];\n}\n","import { Store, EventBus, DataRouter, isSame } from \"@wx/lib-state\";\nimport type { TDataConfig, TWritableCreator, TID } from \"@wx/lib-state\";\nimport { getValue, setValue } from \"./editors\";\nimport { download, getRenderValue } from \"./export\";\nimport { getCsvData } from \"./export/csv\";\nimport { getExcelData, getExportStyles } from \"./export/excel\";\nimport { normalizePrintConfig } from \"./print\";\nimport { HistoryManager } from \"./HistoryManager\";\n// #if [WX_PACKAGE_TYPE=trial]\nimport { isValid, isExpired, isBadLuck } from \"./package\";\n// #endif\nimport { isCommunity } from \"./package\";\n\nimport type {\n\tIColumn,\n\tIRenderColumn,\n\tIData,\n\tIDataConfig,\n\tIRenderHeaderCell,\n\tIRow,\n\tTMethodsConfig,\n\tISizeConfig,\n\tIRenderSizes,\n\tIExportOptions,\n\tTColumnType,\n\tTSortValue,\n\tIDataHash,\n\tIFilterValues,\n\tIPrintConfig,\n} from \"./types\";\nimport { sortByMany } from \"./sort\";\nimport {\n\tgetHeaderFooterHeights,\n\tgetColumnWidth,\n\tgetHeaderColWidth,\n\tsuggestSkin,\n} from \"./sizes\";\nimport { getFilterHandler } from \"./filters\";\n\nexport default class DataStore extends Store<IData> {\n\tpublic in: EventBus<TMethodsConfig, keyof TMethodsConfig>;\n\tprivate _router: DataRouter<IData, IDataConfig, TMethodsConfig>;\n\tprivate _branches: { [key: TID]: IRow };\n\tprivate _xlsxWorker: any;\n\tprivate _historyManager: HistoryManager;\n\n\tconstructor(w: TWritableCreator) {\n\t\tsuper({ writable: w, async: false });\n\n\t\tconst defaultSizes = {\n\t\t\trowHeight: 37,\n\t\t\tcolumnWidth: 160,\n\t\t\theaderHeight: 36,\n\t\t\tfooterHeight: 36,\n\t\t};\n\n\t\tthis._router = new DataRouter(\n\t\t\tsuper.setState.bind(this),\n\t\t\t// data recalculation dependencies\n\t\t\t[\n\t\t\t\t// normalize columns, headers and footers\n\t\t\t\t{\n\t\t\t\t\tin: [\"columns\", \"sizes\", \"_skin\"],\n\t\t\t\t\tout: [\"_columns\", \"_sizes\"],\n\t\t\t\t\texec: (ctx: TDataConfig) => {\n\t\t\t\t\t\tconst { columns, sizes, _skin } = this.getState();\n\t\t\t\t\t\tconst _columns: IRenderColumn[] =\n\t\t\t\t\t\t\tthis.copyColumns(columns);\n\n\t\t\t\t\t\tconst headerRowCount = _columns.reduce(\n\t\t\t\t\t\t\t(a, b) => Math.max(b.header.length, a),\n\t\t\t\t\t\t\t0\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst footerRowCount = _columns.reduce(\n\t\t\t\t\t\t\t(a, b) => Math.max(b.footer.length, a),\n\t\t\t\t\t\t\t0\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\t_columns.forEach(this.setCollapsibleColumns);\n\n\t\t\t\t\t\tconst _sizes: IRenderSizes = this.normalizeSizes(\n\t\t\t\t\t\t\t_columns,\n\t\t\t\t\t\t\tsizes,\n\t\t\t\t\t\t\theaderRowCount,\n\t\t\t\t\t\t\tfooterRowCount,\n\t\t\t\t\t\t\t_skin\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\t_columns.forEach((col, i) => {\n\t\t\t\t\t\t\tthis.normalizeColumns(\n\t\t\t\t\t\t\t\t_columns,\n\t\t\t\t\t\t\t\ti,\n\t\t\t\t\t\t\t\t\"header\",\n\t\t\t\t\t\t\t\theaderRowCount,\n\t\t\t\t\t\t\t\t_sizes\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tthis.normalizeColumns(\n\t\t\t\t\t\t\t\t_columns,\n\t\t\t\t\t\t\t\ti,\n\t\t\t\t\t\t\t\t\"footer\",\n\t\t\t\t\t\t\t\tfooterRowCount,\n\t\t\t\t\t\t\t\t_sizes\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.setState({ _columns, _sizes }, ctx);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tin: [\"data\", \"tree\", \"_filterIds\"],\n\t\t\t\t\tout: [\"flatData\"],\n\t\t\t\t\texec: (ctx: TDataConfig) => {\n\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\tdata,\n\t\t\t\t\t\t\ttree,\n\t\t\t\t\t\t\t_filterIds: filterIds,\n\t\t\t\t\t\t} = this.getState();\n\t\t\t\t\t\tconst flatData = tree\n\t\t\t\t\t\t\t? this.flattenRows(data, [], filterIds)\n\t\t\t\t\t\t\t: data.filter(\n\t\t\t\t\t\t\t\t\td => !filterIds || filterIds.includes(d.id)\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\tthis.setState({ flatData }, ctx);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\t{\n\t\t\t\t// data initializers\n\t\t\t\tsizes: (v: ISizeConfig) => ({ ...defaultSizes, ...v }),\n\t\t\t}\n\t\t);\n\n\t\tconst inBus = (this.in = new EventBus());\n\n\t\tinBus.on(\n\t\t\t\"close-editor\",\n\t\t\t({ ignore }: IDataMethodsConfig[\"close-editor\"]) => {\n\t\t\t\tconst { editor } = this.getState();\n\t\t\t\tif (editor) {\n\t\t\t\t\tif (!ignore) {\n\t\t\t\t\t\tinBus.exec(\"update-cell\", editor);\n\t\t\t\t\t}\n\t\t\t\t\tthis.setState({ editor: null });\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tinBus.on(\n\t\t\t\"open-editor\",\n\t\t\t({ id, column }: IDataMethodsConfig[\"open-editor\"]) => {\n\t\t\t\tlet editor = this.getState().editor;\n\t\t\t\tif (editor) inBus.exec(\"close-editor\", {});\n\n\t\t\t\tconst row = this.getRow(id);\n\t\t\t\tconst col = column\n\t\t\t\t\t? this.getColumn(column)\n\t\t\t\t\t: this.getNextEditor(row);\n\n\t\t\t\tif (col?.editor) {\n\t\t\t\t\tlet columnEditor = col.editor;\n\t\t\t\t\tif (typeof columnEditor === \"function\")\n\t\t\t\t\t\tcolumnEditor = columnEditor(row, col);\n\t\t\t\t\tif (!columnEditor) return;\n\n\t\t\t\t\teditor = {\n\t\t\t\t\t\tcolumn: col.id,\n\t\t\t\t\t\tid,\n\t\t\t\t\t\tvalue: getValue(row, col) ?? \"\",\n\t\t\t\t\t\trenderedValue: getRenderValue(row, col),\n\t\t\t\t\t};\n\n\t\t\t\t\tif (\n\t\t\t\t\t\ttypeof columnEditor === \"object\" &&\n\t\t\t\t\t\tcolumnEditor.config\n\t\t\t\t\t) {\n\t\t\t\t\t\teditor.config = columnEditor.config;\n\t\t\t\t\t\tif (columnEditor.config.options)\n\t\t\t\t\t\t\teditor.options = columnEditor.config.options;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (col.options && !editor.options)\n\t\t\t\t\t\teditor.options = col.options;\n\n\t\t\t\t\tthis.setState({ editor });\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t\tinBus.on(\"editor\", ({ value }: IDataMethodsConfig[\"editor\"]) => {\n\t\t\tconst editor = this.getState().editor;\n\t\t\tif (editor) {\n\t\t\t\teditor.value = value;\n\t\t\t\tthis.setState({ editor });\n\t\t\t}\n\t\t});\n\t\tinBus.on(\"add-row\", (ev: IDataMethodsConfig[\"add-row\"]) => {\n\t\t\tconst state = this.getState();\n\t\t\tlet { data } = state;\n\t\t\tconst { select, _filterIds: filterIds } = state;\n\t\t\tconst { row, before, after, select: selectForce } = ev;\n\t\t\tev.id = row.id = ev.id || row.id || uid();\n\n\t\t\tif (before || after) {\n\t\t\t\tconst id = before || after;\n\t\t\t\tconst index = data.findIndex(a => a.id === id);\n\t\t\t\tdata.splice(index + (after ? 1 : 0), 0, ev.row);\n\t\t\t\tdata = [...data];\n\t\t\t} else {\n\t\t\t\tdata = [...data, ev.row];\n\t\t\t}\n\n\t\t\tconst update: Partial<IData> = { data };\n\n\t\t\tif (filterIds) update._filterIds = [...filterIds, ev.id];\n\n\t\t\tthis.setState(update);\n\n\t\t\tif (typeof selectForce === \"boolean\" && !selectForce) return;\n\t\t\tif (selectForce || select)\n\t\t\t\tinBus.exec(\"select-row\", { id: row.id, show: true });\n\t\t});\n\t\tinBus.on(\"delete-row\", (ev: IDataMethodsConfig[\"delete-row\"]) => {\n\t\t\tconst { data, selectedRows, focusCell } = this.getState();\n\t\t\tconst { id } = ev;\n\n\t\t\tconst update: Partial<IData> = {\n\t\t\t\tdata: data.filter(a => a.id !== id),\n\t\t\t};\n\n\t\t\tif (this.isSelected(id)) {\n\t\t\t\tupdate.selectedRows = selectedRows.filter(a => a !== id);\n\t\t\t}\n\n\t\t\tthis.setState(update);\n\n\t\t\tif (focusCell?.row === id) {\n\t\t\t\tthis.in.exec(\"focus-cell\", { eventSource: \"delete-row\" });\n\t\t\t}\n\t\t});\n\t\tinBus.on(\"update-cell\", (ev: IDataMethodsConfig[\"update-cell\"]) => {\n\t\t\tconst state = this.getState();\n\t\t\tlet { data } = state;\n\t\t\tdata = [...data];\n\n\t\t\tconst { tree } = state;\n\t\t\tconst { id, column, value } = ev;\n\n\t\t\tconst col = this.getColumn(column);\n\n\t\t\tif (tree) {\n\t\t\t\tconst obj = { ...this._branches[id] };\n\t\t\t\tsetValue(obj, col, value);\n\n\t\t\t\tconst update = this.updateTreeRow(obj);\n\t\t\t\tif (obj.$parent === 0) {\n\t\t\t\t\tdata = update;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst index = data.findIndex(a => a.id == id);\n\t\t\t\tconst obj = { ...data[index] };\n\t\t\t\tsetValue(obj, col, value);\n\n\t\t\t\tdata[index] = obj;\n\t\t\t}\n\n\t\t\tthis.setState({ data });\n\t\t});\n\t\tinBus.on(\"update-row\", (ev: IDataMethodsConfig[\"update-row\"]) => {\n\t\t\tlet { data } = this.getState();\n\t\t\tconst { id, row } = ev;\n\n\t\t\tconst index = data.findIndex(a => a.id == id);\n\t\t\tdata = [...data];\n\t\t\tdata[index] = { ...data[index], ...row };\n\t\t\tthis.setState({ data });\n\t\t});\n\t\tinBus.on(\n\t\t\t\"select-row\",\n\t\t\t({\n\t\t\t\tid,\n\t\t\t\ttoggle,\n\t\t\t\trange,\n\t\t\t\tmode,\n\t\t\t\tshow,\n\t\t\t\tcolumn,\n\t\t\t}: IDataMethodsConfig[\"select-row\"]) => {\n\t\t\t\tconst state = this.getState();\n\t\t\t\tconst { focusCell } = state;\n\t\t\t\tlet { selectedRows } = state;\n\n\t\t\t\tif (!selectedRows.length) range = toggle = false;\n\n\t\t\t\tif (range) {\n\t\t\t\t\tconst { data } = this.getState();\n\n\t\t\t\t\tlet sindex = data.findIndex(\n\t\t\t\t\t\ta => a.id == selectedRows[selectedRows.length - 1]\n\t\t\t\t\t);\n\t\t\t\t\tlet eindex = data.findIndex(a => a.id == id);\n\t\t\t\t\tif (sindex > eindex) [sindex, eindex] = [eindex, sindex];\n\n\t\t\t\t\tdata.slice(sindex, eindex + 1).forEach(a => {\n\t\t\t\t\t\tif (selectedRows.indexOf(a.id) === -1)\n\t\t\t\t\t\t\tselectedRows.push(a.id);\n\t\t\t\t\t});\n\t\t\t\t} else if (toggle && this.isSelected(id)) {\n\t\t\t\t\tif (mode === true) return;\n\t\t\t\t\tselectedRows = selectedRows.filter(a => a !== id);\n\t\t\t\t} else {\n\t\t\t\t\tif (toggle) {\n\t\t\t\t\t\tif (mode === false) return;\n\t\t\t\t\t\tselectedRows.push(id);\n\t\t\t\t\t} else selectedRows = [id];\n\t\t\t\t}\n\n\t\t\t\tthis.setState({ selectedRows });\n\n\t\t\t\tif (focusCell?.row !== id) {\n\t\t\t\t\tthis.in.exec(\"focus-cell\", { eventSource: \"select-row\" });\n\t\t\t\t}\n\t\t\t\tif (show) this.in.exec(\"scroll\", { row: id, column });\n\t\t\t}\n\t\t);\n\t\tthis.in.on(\"focus-cell\", (ev: IDataMethodsConfig[\"focus-cell\"]) => {\n\t\t\tconst { row, column, eventSource } = ev;\n\t\t\tconst { _columns, split } = this.getState();\n\n\t\t\tif (row && column) {\n\t\t\t\tthis.setState({ focusCell: { row, column } });\n\t\t\t\tif (eventSource !== \"click\") {\n\t\t\t\t\tif (\n\t\t\t\t\t\t(!split.left ||\n\t\t\t\t\t\t\t_columns.findIndex(a => a.id == ev.column) >=\n\t\t\t\t\t\t\t\tsplit.left) &&\n\t\t\t\t\t\t(!split.right ||\n\t\t\t\t\t\t\t_columns.findIndex(a => a.id == ev.column) <\n\t\t\t\t\t\t\t\t_columns.length - split.right)\n\t\t\t\t\t) {\n\t\t\t\t\t\tthis.in.exec(\"scroll\", { row, column });\n\t\t\t\t\t} else this.in.exec(\"scroll\", { row });\n\t\t\t\t}\n\t\t\t} else this.setState({ focusCell: null });\n\t\t});\n\t\tinBus.on(\"resize-column\", (ev: IDataMethodsConfig[\"resize-column\"]) => {\n\t\t\tconst { id, auto, maxRows, inProgress } = ev;\n\t\t\tif (inProgress === false) {\n\t\t\t\t// event called with inProgress=false is purely informational (indicates that the resize is over)\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet width = ev.width || 0;\n\t\t\tconst columns = [...this.getState().columns];\n\t\t\tconst column = columns.find(a => a.id == id);\n\n\t\t\tif (auto) {\n\t\t\t\tif (auto == \"data\" || auto === true) {\n\t\t\t\t\tconst { flatData, _skin } = this.getState();\n\t\t\t\t\tlet max = flatData.length;\n\n\t\t\t\t\tif (maxRows) max = Math.min(maxRows, max);\n\n\t\t\t\t\tconst curData = flatData.slice(0, max);\n\t\t\t\t\twidth = getColumnWidth(column, curData, _skin);\n\t\t\t\t}\n\n\t\t\t\tif (auto == \"header\" || auto === true) {\n\t\t\t\t\tconst { _skin } = this.getState();\n\n\t\t\t\t\twidth = Math.max(getHeaderColWidth(column, _skin), width);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcolumn.width = Math.max(17, width);\n\t\t\tdelete column.flexgrow;\n\t\t\tthis.setState({ columns });\n\t\t});\n\t\tinBus.on(\"hide-column\", (ev: IDataMethodsConfig[\"hide-column\"]) => {\n\t\t\tconst { id, mode } = ev;\n\t\t\tconst columns = [...this.getState().columns];\n\t\t\tconst column = columns.find(a => a.id == id);\n\t\t\tconst visibleColumns = columns.reduce(\n\t\t\t\t(p, v) => p + (v.hidden ? 0 : 1),\n\t\t\t\t0\n\t\t\t);\n\t\t\tif (!mode || visibleColumns > 1) {\n\t\t\t\tcolumn.hidden = !column.hidden;\n\t\t\t\tthis.setState({ columns });\n\t\t\t} else ev.skipUndo = true;\n\t\t});\n\t\tinBus.on(\"sort-rows\", (ev: IDataMethodsConfig[\"sort-rows\"]) => {\n\t\t\tconst { key, add } = ev;\n\t\t\tlet { order = \"asc\" } = ev;\n\n\t\t\tconst state = this.getState();\n\t\t\tlet sortMarks = state.sortMarks;\n\t\t\tconst { columns, data, tree } = state;\n\t\t\tconst fields = Object.keys(sortMarks);\n\t\t\tconst fLength = fields.length;\n\n\t\t\tif (sortMarks[key])\n\t\t\t\torder = sortMarks[key].order === \"asc\" ? \"desc\" : \"asc\";\n\n\t\t\tif (!add || !fLength || (fLength === 1 && sortMarks[key])) {\n\t\t\t\tsortMarks = { [key]: { order } };\n\t\t\t} else {\n\t\t\t\tif (fLength === 1) {\n\t\t\t\t\t// ensure the first sort field has an index for proper ordering\n\t\t\t\t\tsortMarks[fields[0]] = {\n\t\t\t\t\t\t...sortMarks[fields[0]],\n\t\t\t\t\t\tindex: 0,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tsortMarks = {\n\t\t\t\t\t...sortMarks,\n\t\t\t\t\t[key]: {\n\t\t\t\t\t\torder,\n\t\t\t\t\t\tindex: sortMarks[key]?.index ?? fLength,\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tconst sortArr = Object.keys(sortMarks)\n\t\t\t\t.sort((a, b) => sortMarks[a].index - sortMarks[b].index)\n\t\t\t\t.map(k => ({ key: k, order: sortMarks[k].order }));\n\n\t\t\tthis.setState({ sortMarks });\n\n\t\t\tconst sorter = sortByMany(sortArr, columns);\n\t\t\tif (sorter) {\n\t\t\t\tconst nextData = [...data];\n\n\t\t\t\tif (tree) {\n\t\t\t\t\tthis.sortTree(nextData, sorter);\n\t\t\t\t} else nextData.sort(sorter);\n\n\t\t\t\tthis.setState({ data: nextData });\n\t\t\t}\n\t\t});\n\n\t\tinBus.on(\"filter-rows\", (ev: IDataMethodsConfig[\"filter-rows\"]) => {\n\t\t\tconst { value, key, filter } = ev;\n\n\t\t\t// clear all filters\n\t\t\tif (!Object.keys(ev).length) {\n\t\t\t\tthis.setState({ filterValues: {}, _filterIds: null });\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst state = this.getState();\n\t\t\tconst { data, tree } = state;\n\t\t\tlet filterValues = state.filterValues;\n\n\t\t\tconst update: Partial<IData> = {};\n\t\t\tif (key) {\n\t\t\t\tfilterValues = {\n\t\t\t\t\t...filterValues,\n\t\t\t\t\t[key]: value,\n\t\t\t\t};\n\t\t\t\tupdate.filterValues = filterValues;\n\t\t\t}\n\n\t\t\tconst filterFn = filter ?? this.createFilter(filterValues);\n\n\t\t\tlet filterIds: TID[] = [];\n\t\t\tif (tree) {\n\t\t\t\tfilterIds = this.filterTree(data, filterFn, filterIds);\n\t\t\t} else\n\t\t\t\tdata.forEach(d => {\n\t\t\t\t\tif (filterFn(d)) filterIds.push(d.id);\n\t\t\t\t});\n\t\t\tupdate._filterIds = filterIds;\n\n\t\t\tthis.setState(update);\n\t\t});\n\n\t\tinBus.on(\n\t\t\t\"collapse-column\",\n\t\t\t(ev: IDataMethodsConfig[\"collapse-column\"]) => {\n\t\t\t\tconst { id, row, mode } = ev;\n\t\t\t\tconst columns = [...this.getState().columns];\n\t\t\t\tconst header = this.getColumn(id).header;\n\t\t\t\tconst cell = Array.isArray(header) ? header[row] : header;\n\n\t\t\t\tif (typeof cell === \"object\") {\n\t\t\t\t\tcell.collapsed = mode ?? !cell.collapsed;\n\t\t\t\t\tthis.setState({ columns });\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\tinBus.on(\"move-item\", (ev: IDataMethodsConfig[\"move-item\"]) => {\n\t\t\tconst { id, target, mode = \"after\", inProgress } = ev;\n\t\t\tconst { data, flatData, tree } = this.getState();\n\t\t\tconst sourceIndex = flatData.findIndex(a => a.id == id);\n\t\t\tconst targetIndex = flatData.findIndex(a => a.id == target);\n\n\t\t\tif (\n\t\t\t\tsourceIndex === -1 ||\n\t\t\t\ttargetIndex === -1 ||\n\t\t\t\tinProgress === false\n\t\t\t) {\n\t\t\t\t// event called with inProgress=false is purely informational (indicates that the drag is over)\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet updatedData;\n\t\t\tif (tree) {\n\t\t\t\t// #if [!(WX_PACKAGE_TYPE=open)]\n\t\t\t\tupdatedData = this.moveItem(id, target, data, mode);\n\t\t\t\t// #endif\n\t\t\t} else {\n\t\t\t\tupdatedData = this.moveItem(id, target, data, mode);\n\t\t\t}\n\n\t\t\tthis.setState({\n\t\t\t\tdata: tree ? this.normalizeTreeRows(updatedData) : updatedData,\n\t\t\t});\n\t\t});\n\n\t\tinBus.on(\"open-row\", (ev: IDataMethodsConfig[\"open-row\"]) => {\n\t\t\tconst { id, nested } = ev;\n\t\t\tthis.toggleBranch(id, true, nested);\n\t\t});\n\n\t\tinBus.on(\"close-row\", (ev: IDataMethodsConfig[\"close-row\"]) => {\n\t\t\tconst { id, nested } = ev;\n\t\t\tthis.toggleBranch(id, false, nested);\n\t\t});\n\t\t// #if [!(WX_PACKAGE_TYPE=open)]\n\t\tinBus.on(\"export\", (ev: IDataMethodsConfig[\"export\"]) => {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tconst options = ev.options || {};\n\n\t\t\t\tconst filename = `${options.fileName || \"data\"}.${options.format}`;\n\n\t\t\t\tif (options.format == \"csv\") {\n\t\t\t\t\tconst csv = getCsvData(this.getState(), options);\n\t\t\t\t\tif (options.download !== false)\n\t\t\t\t\t\tdownload(\n\t\t\t\t\t\t\tnew Blob([\"\\uFEFF\" + csv], { type: \"text/csv\" }),\n\t\t\t\t\t\t\tfilename\n\t\t\t\t\t\t);\n\t\t\t\t\telse ev.result = csv;\n\t\t\t\t\tresolve(true);\n\t\t\t\t} else if (options.format == \"xlsx\") {\n\t\t\t\t\t// common styles\n\t\t\t\t\tlet styleOps = options.styles;\n\t\t\t\t\tif (!styleOps && styleOps !== false) {\n\t\t\t\t\t\tstyleOps = getExportStyles(this.getState()._skin);\n\t\t\t\t\t}\n\t\t\t\t\tconst styles = styleOps as IDataHash<any>;\n\t\t\t\t\tconst stylesArr = styles\n\t\t\t\t\t\t? [\n\t\t\t\t\t\t\t\t{ ...styles.header },\n\t\t\t\t\t\t\t\t{ ...(styles.lastHeaderCell || styles.header) },\n\t\t\t\t\t\t\t\t{ ...styles.cell },\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t...(styles.firstFooterCell ||\n\t\t\t\t\t\t\t\t\t\tstyles.footer),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{ ...styles.footer },\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t: Array(5).fill({});\n\n\t\t\t\t\t// data and cell styles\n\t\t\t\t\tconst {\n\t\t\t\t\t\tcells,\n\t\t\t\t\t\tmerged,\n\t\t\t\t\t\trowSizes,\n\t\t\t\t\t\tcolSizes,\n\t\t\t\t\t\tstyles: cellStyles,\n\t\t\t\t\t} = getExcelData(this.getState(), options, stylesArr);\n\n\t\t\t\t\tconst path =\n\t\t\t\t\t\toptions.cdn ||\n\t\t\t\t\t\t\"https://cdn.dhtmlx.com/libs/json2excel/1.3.2/worker.js\";\n\t\t\t\t\tconst xlsxWorker = this.getXlsxWorker(path);\n\n\t\t\t\t\txlsxWorker.then(x => {\n\t\t\t\t\t\tx.onmessage = (e: any) => {\n\t\t\t\t\t\t\tif (e.data.type == \"ready\") {\n\t\t\t\t\t\t\t\tconst blob = e.data.blob;\n\t\t\t\t\t\t\t\tif (options.download !== false)\n\t\t\t\t\t\t\t\t\tdownload(blob, filename);\n\t\t\t\t\t\t\t\telse ev.result = blob;\n\t\t\t\t\t\t\t\tresolve(true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tx.postMessage({\n\t\t\t\t\t\t\ttype: \"convert\",\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tdata: [\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tname: options.sheetName || \"data\",\n\t\t\t\t\t\t\t\t\t\tcells,\n\t\t\t\t\t\t\t\t\t\tcols: colSizes,\n\t\t\t\t\t\t\t\t\t\trows: rowSizes,\n\t\t\t\t\t\t\t\t\t\tmerged,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\tstyles: cellStyles,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t} else reject();\n\t\t\t});\n\t\t});\n\t\t// #endif\n\t\tinBus.on(\n\t\t\t\"hotkey\",\n\t\t\t({ key, event, isInput }: IDataMethodsConfig[\"hotkey\"]) => {\n\t\t\t\tswitch (key) {\n\t\t\t\t\tcase \"arrowup\": {\n\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\tflatData: data,\n\t\t\t\t\t\t\tfocusCell,\n\t\t\t\t\t\t\tselect,\n\t\t\t\t\t\t} = this.getState();\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tif (isInput) return;\n\n\t\t\t\t\t\tconst colId = focusCell\n\t\t\t\t\t\t\t? focusCell.column\n\t\t\t\t\t\t\t: this._getFirstVisibleColumn()?.id;\n\t\t\t\t\t\tconst rowId = focusCell\n\t\t\t\t\t\t\t? this.getPrevRow(focusCell.row)?.id\n\t\t\t\t\t\t\t: data[data.length - 1]?.id;\n\t\t\t\t\t\tif (colId && rowId) {\n\t\t\t\t\t\t\tthis.in.exec(\"focus-cell\", {\n\t\t\t\t\t\t\t\trow: rowId,\n\t\t\t\t\t\t\t\tcolumn: colId,\n\t\t\t\t\t\t\t\teventSource: \"key\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (select)\n\t\t\t\t\t\t\t\tthis.in.exec(\"select-row\", { id: rowId });\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"arrowdown\": {\n\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\tflatData: data,\n\t\t\t\t\t\t\tfocusCell,\n\t\t\t\t\t\t\tselect,\n\t\t\t\t\t\t} = this.getState();\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tif (isInput) return;\n\n\t\t\t\t\t\tconst colId = focusCell\n\t\t\t\t\t\t\t? focusCell.column\n\t\t\t\t\t\t\t: this._getFirstVisibleColumn()?.id;\n\t\t\t\t\t\tconst rowId = focusCell\n\t\t\t\t\t\t\t? this.getNextRow(focusCell.row)?.id\n\t\t\t\t\t\t\t: data[0]?.id;\n\t\t\t\t\t\tif (colId && rowId) {\n\t\t\t\t\t\t\tthis.in.exec(\"focus-cell\", {\n\t\t\t\t\t\t\t\trow: rowId,\n\t\t\t\t\t\t\t\tcolumn: colId,\n\t\t\t\t\t\t\t\teventSource: \"key\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif (select)\n\t\t\t\t\t\t\t\tthis.in.exec(\"select-row\", { id: rowId });\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"arrowright\": {\n\t\t\t\t\t\tconst { focusCell } = this.getState();\n\t\t\t\t\t\tif (isInput) return;\n\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tif (focusCell) {\n\t\t\t\t\t\t\tconst colId = this.getNextColumn(\n\t\t\t\t\t\t\t\tfocusCell.column,\n\t\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t\t)?.id;\n\t\t\t\t\t\t\tif (colId) {\n\t\t\t\t\t\t\t\tthis.in.exec(\"focus-cell\", {\n\t\t\t\t\t\t\t\t\trow: focusCell.row,\n\t\t\t\t\t\t\t\t\tcolumn: colId,\n\t\t\t\t\t\t\t\t\teventSource: \"key\",\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"arrowleft\": {\n\t\t\t\t\t\tconst { focusCell } = this.getState();\n\t\t\t\t\t\tif (isInput) return;\n\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tif (focusCell) {\n\t\t\t\t\t\t\tconst colId = this.getPrevColumn(\n\t\t\t\t\t\t\t\tfocusCell.column,\n\t\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t\t)?.id;\n\t\t\t\t\t\t\tif (colId) {\n\t\t\t\t\t\t\t\tthis.in.exec(\"focus-cell\", {\n\t\t\t\t\t\t\t\t\trow: focusCell.row,\n\t\t\t\t\t\t\t\t\tcolumn: colId,\n\t\t\t\t\t\t\t\t\teventSource: \"key\",\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"tab\": {\n\t\t\t\t\t\tconst { editor, focusCell, select } = this.getState();\n\t\t\t\t\t\tif (editor) {\n\t\t\t\t\t\t\tevent.preventDefault();\n\n\t\t\t\t\t\t\tconst column = editor.column;\n\t\t\t\t\t\t\tlet id = editor.id;\n\t\t\t\t\t\t\tlet col = this.getNextEditor(\n\t\t\t\t\t\t\t\tthis.getRow(id),\n\t\t\t\t\t\t\t\tthis.getColumn(column)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (!col) {\n\t\t\t\t\t\t\t\tconst row = this.getNextRow(id);\n\t\t\t\t\t\t\t\tif (row) {\n\t\t\t\t\t\t\t\t\tid = row.id;\n\t\t\t\t\t\t\t\t\tcol = this.getNextEditor(row);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (col) {\n\t\t\t\t\t\t\t\tthis.in.exec(\"open-editor\", {\n\t\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t\t\tcolumn: col.id,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tthis.in.exec(\"focus-cell\", {\n\t\t\t\t\t\t\t\t\trow: id,\n\t\t\t\t\t\t\t\t\tcolumn: col.id,\n\t\t\t\t\t\t\t\t\teventSource: \"key\",\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tif (select && !this.isSelected(id))\n\t\t\t\t\t\t\t\t\tthis.in.exec(\"select-row\", { id });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (focusCell) {\n\t\t\t\t\t\t\tthis.in.exec(\"focus-cell\", { eventSource: \"key\" });\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"shift+tab\": {\n\t\t\t\t\t\tconst { editor, focusCell, select } = this.getState();\n\t\t\t\t\t\tif (editor) {\n\t\t\t\t\t\t\tevent.preventDefault();\n\n\t\t\t\t\t\t\tconst column = editor.column;\n\t\t\t\t\t\t\tlet id = editor.id;\n\t\t\t\t\t\t\tlet col = this.getPrevEditor(\n\t\t\t\t\t\t\t\tthis.getRow(id),\n\t\t\t\t\t\t\t\tthis.getColumn(column)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (!col) {\n\t\t\t\t\t\t\t\tconst row = this.getPrevRow(id);\n\t\t\t\t\t\t\t\tif (row) {\n\t\t\t\t\t\t\t\t\tid = row.id;\n\t\t\t\t\t\t\t\t\tcol = this.getPrevEditor(row);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (col) {\n\t\t\t\t\t\t\t\tthis.in.exec(\"open-editor\", {\n\t\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t\t\tcolumn: col.id,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tthis.in.exec(\"focus-cell\", {\n\t\t\t\t\t\t\t\t\trow: id,\n\t\t\t\t\t\t\t\t\tcolumn: col.id,\n\t\t\t\t\t\t\t\t\teventSource: \"key\",\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tif (select && !this.isSelected(id))\n\t\t\t\t\t\t\t\t\tthis.in.exec(\"select-row\", { id });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (focusCell) {\n\t\t\t\t\t\t\tthis.in.exec(\"focus-cell\", { eventSource: \"key\" });\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"escape\": {\n\t\t\t\t\t\tconst { editor } = this.getState();\n\t\t\t\t\t\tif (editor) {\n\t\t\t\t\t\t\tthis.in.exec(\"close-editor\", { ignore: true });\n\t\t\t\t\t\t\tthis.in.exec(\"focus-cell\", {\n\t\t\t\t\t\t\t\trow: editor.id,\n\t\t\t\t\t\t\t\tcolumn: editor.column,\n\t\t\t\t\t\t\t\teventSource: \"key\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"f2\": {\n\t\t\t\t\t\tconst { editor, focusCell } = this.getState();\n\t\t\t\t\t\tif (!editor && focusCell) {\n\t\t\t\t\t\t\tthis.in.exec(\"open-editor\", {\n\t\t\t\t\t\t\t\tid: focusCell.row,\n\t\t\t\t\t\t\t\tcolumn: focusCell.column,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"enter\": {\n\t\t\t\t\t\tconst { focusCell, tree } = this.getState();\n\t\t\t\t\t\tif (!isInput && tree && focusCell) {\n\t\t\t\t\t\t\tconst column = this.getColumn(focusCell.column);\n\t\t\t\t\t\t\tif (column.treetoggle) {\n\t\t\t\t\t\t\t\tconst row = this.getRow(focusCell.row);\n\t\t\t\t\t\t\t\tif (!row.data) return;\n\t\t\t\t\t\t\t\tthis.in.exec(\n\t\t\t\t\t\t\t\t\trow.open ? \"close-row\" : \"open-row\",\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tid: focusCell.row,\n\t\t\t\t\t\t\t\t\t\tnested: true,\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"home\": {\n\t\t\t\t\t\tconst { editor, focusCell } = this.getState();\n\t\t\t\t\t\tif (!editor && focusCell) {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tconst colId = this._getFirstVisibleColumn()?.id;\n\t\t\t\t\t\t\tthis.in.exec(\"focus-cell\", {\n\t\t\t\t\t\t\t\trow: focusCell.row,\n\t\t\t\t\t\t\t\tcolumn: colId,\n\t\t\t\t\t\t\t\teventSource: \"key\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"ctrl+home\": {\n\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\teditor,\n\t\t\t\t\t\t\tfocusCell,\n\t\t\t\t\t\t\tflatData: data,\n\t\t\t\t\t\t\tselect,\n\t\t\t\t\t\t} = this.getState();\n\t\t\t\t\t\tif (!editor && focusCell) {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tconst rowId = data[0]?.id;\n\t\t\t\t\t\t\tconst colId = this._getFirstVisibleColumn()?.id;\n\t\t\t\t\t\t\tif (rowId && colId) {\n\t\t\t\t\t\t\t\tthis.in.exec(\"focus-cell\", {\n\t\t\t\t\t\t\t\t\trow: rowId,\n\t\t\t\t\t\t\t\t\tcolumn: colId,\n\t\t\t\t\t\t\t\t\teventSource: \"key\",\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tif (select && !this.isSelected(rowId))\n\t\t\t\t\t\t\t\t\tthis.in.exec(\"select-row\", { id: rowId });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"end\": {\n\t\t\t\t\t\tconst { editor, focusCell } = this.getState();\n\t\t\t\t\t\tif (!editor && focusCell) {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tconst colId = this._getLastVisibleColumn()?.id;\n\t\t\t\t\t\t\tconst rowId = focusCell.row;\n\t\t\t\t\t\t\tthis.in.exec(\"focus-cell\", {\n\t\t\t\t\t\t\t\trow: rowId,\n\t\t\t\t\t\t\t\tcolumn: colId,\n\t\t\t\t\t\t\t\teventSource: \"key\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"ctrl+end\": {\n\t\t\t\t\t\tconst {\n\t\t\t\t\t\t\teditor,\n\t\t\t\t\t\t\tfocusCell,\n\t\t\t\t\t\t\tflatData: data,\n\t\t\t\t\t\t\tselect,\n\t\t\t\t\t\t} = this.getState();\n\t\t\t\t\t\tif (!editor && focusCell) {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tconst rowId = data.at(-1).id;\n\t\t\t\t\t\t\tconst colId = this._getLastVisibleColumn()?.id;\n\t\t\t\t\t\t\tif (rowId && colId) {\n\t\t\t\t\t\t\t\tthis.in.exec(\"focus-cell\", {\n\t\t\t\t\t\t\t\t\trow: rowId,\n\t\t\t\t\t\t\t\t\tcolumn: colId,\n\t\t\t\t\t\t\t\t\teventSource: \"key\",\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tif (select && !this.isSelected(rowId))\n\t\t\t\t\t\t\t\t\tthis.in.exec(\"select-row\", { id: rowId });\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"ctrl+z\": {\n\t\t\t\t\t\tthis.in.exec(\"undo\", {});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcase \"ctrl+y\": {\n\t\t\t\t\t\tthis.in.exec(\"redo\", {});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\tinBus.on(\"scroll\", (ev: IDataMethodsConfig[\"scroll\"]) => {\n\t\t\tconst {\n\t\t\t\t_columns,\n\t\t\t\tsplit,\n\t\t\t\t_sizes,\n\t\t\t\tflatData: data,\n\t\t\t\tdynamic,\n\t\t\t} = this.getState();\n\n\t\t\tlet left = -1,\n\t\t\t\ttop = -1,\n\t\t\t\twidth = 0;\n\t\t\tif (ev.column) {\n\t\t\t\tleft = 0;\n\t\t\t\tconst ind = _columns.findIndex(a => a.id == ev.column);\n\t\t\t\twidth = _columns[ind].width;\n\t\t\t\tfor (let i = split.left ?? 0; i < ind; i++) {\n\t\t\t\t\tconst col = _columns[i];\n\t\t\t\t\tif (col.hidden) continue;\n\t\t\t\t\tleft += col.width;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (ev.row && !dynamic) {\n\t\t\t\tconst index = data.findIndex(a => a.id === ev.row);\n\t\t\t\tif (index >= 0) top = _sizes.rowHeight * index;\n\t\t\t}\n\n\t\t\tthis.setState({\n\t\t\t\tscroll: {\n\t\t\t\t\ttop,\n\t\t\t\t\tleft,\n\t\t\t\t\twidth,\n\t\t\t\t\theight: _sizes.rowHeight,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\t\tinBus.on(\"print\", (ev: IDataMethodsConfig[\"print\"]) => {\n\t\t\tconst config = normalizePrintConfig(ev);\n\t\t\tthis.setState({ _print: config });\n\t\t\tthis.setStateAsync({ _print: null });\n\t\t});\n\n\t\tinBus.on(\"undo\", () => {\n\t\t\tthis._historyManager?.handleUndo();\n\t\t});\n\n\t\tinBus.on(\"redo\", () => {\n\t\t\tthis._historyManager?.handleRedo();\n\t\t});\n\n\t\tthis.initOnce();\n\t}\n\n\tprivate getXlsxWorker(path: string): Promise<any> {\n\t\tif (!this._xlsxWorker) {\n\t\t\tconst url = window.URL.createObjectURL(\n\t\t\t\tnew Blob([`importScripts('${path}');`], {\n\t\t\t\t\ttype: \"text/javascript\",\n\t\t\t\t})\n\t\t\t);\n\n\t\t\tthis._xlsxWorker = new Promise(res => {\n\t\t\t\tconst xlsxWorker = new Worker(url);\n\t\t\t\txlsxWorker.addEventListener(\"message\", e => {\n\t\t\t\t\tif (e.data.type === \"init\") res(xlsxWorker);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\treturn this._xlsxWorker;\n\t}\n\n\tinitOnce() {\n\t\tconst state: Partial<IDataConfig> = {\n\t\t\tsortMarks: {},\n\t\t\t_filterIds: null,\n\t\t\tdata: [],\n\t\t\tfilterValues: {},\n\t\t\tscroll: null,\n\t\t\teditor: null,\n\t\t\tfocusCell: null,\n\t\t\t_print: null,\n\t\t\thistory: { undo: 0, redo: 0 },\n\t\t};\n\t\tthis._router.init(state);\n\t}\n\n\tinit(state: Partial<IDataConfig>) {\n\t\t// eslint-disable-next-line no-prototype-builtins\n\t\tif (state.hasOwnProperty(\"_skin\") && !(state as IData)._skin) {\n\t\t\t(state as IData)._skin = suggestSkin();\n\t\t}\n\t\tif (state.columns)\n\t\t\tstate.columns.forEach(a => {\n\t\t\t\tif (a.options) {\n\t\t\t\t\ta.optionsMap = new Map(a.options.map(x => [x.id, x.label]));\n\t\t\t\t}\n\t\t\t});\n\t\t// perform these changes only if data was reset\n\t\tif (!isSame(this.getState().data, state.data)) {\n\t\t\tif (state.tree) {\n\t\t\t\tthis._branches = { 0: { data: state.data } };\n\t\t\t\tstate.data = this.normalizeTreeRows(state.data);\n\t\t\t} else state.data = this.normalizeRows(state.data);\n\n\t\t\tthis.setState({\n\t\t\t\t_filterIds: null,\n\t\t\t\tfilterValues: {},\n\t\t\t\tsortMarks: {},\n\t\t\t});\n\t\t\tif (this._historyManager) this._historyManager.resetHistory();\n\t\t}\n\n\t\tif (isCommunity()) {\n\t\t\tif (state.tree) state.undo = false;\n\t\t\tif (state.split?.right) state.split.right = 0;\n\t\t}\n\n\t\tif (state.undo && !this._historyManager) {\n\t\t\tthis._historyManager = new HistoryManager(\n\t\t\t\tthis.in,\n\t\t\t\tthis.getState.bind(this),\n\t\t\t\tthis.setState.bind(this)\n\t\t\t);\n\t\t}\n\n\t\tthis._router.init({\n\t\t\t...state,\n\t\t});\n\t}\n\n\tsetState(state: Partial<IData>, ctx?: TDataConfig) {\n\t\treturn this._router.setState(state, ctx);\n\t}\n\n\tsetStateAsync(state: Partial<IData>) {\n\t\tthis._router.setStateAsync(state);\n\t}\n\n\tgetRow(id: TID): IRow {\n\t\tconst { tree } = this.getState();\n\t\tif (tree) return this._branches[id];\n\t\treturn this.getState().data.find(a => a.id == id);\n\t}\n\n\tgetRowIndex(id: TID, data?: any[]): number {\n\t\tif (!data) data = this.getState().flatData;\n\t\treturn data.findIndex(a => a.id == id);\n\t}\n\n\tgetNextRow(id: TID): IRow {\n\t\tconst data = this.getState().flatData;\n\t\tconst index = this.getRowIndex(id, data);\n\t\treturn data[index + 1];\n\t}\n\n\tgetPrevRow(id: TID): IRow {\n\t\tconst data = this.getState().flatData;\n\t\tconst index = this.getRowIndex(id, data);\n\t\treturn data[index - 1];\n\t}\n\n\tgetColumn(id: TID): IColumn {\n\t\treturn this.getState().columns.find(a => a.id == id);\n\t}\n\n\tgetNextColumn(id: TID, visible?: boolean): IRenderColumn {\n\t\tconst columns = this.getState()._columns;\n\t\tconst index = columns.findIndex((c: IRenderColumn) => c.id == id);\n\n\t\tif (visible) {\n\t\t\treturn this._getFirstVisibleColumn(index + 1);\n\t\t}\n\n\t\treturn columns[index + 1];\n\t}\n\n\tgetPrevColumn(id: TID, visible?: boolean): IRenderColumn {\n\t\tconst columns = this.getState()._columns;\n\t\tconst index = columns.findIndex((c: IRenderColumn) => c.id == id);\n\n\t\tif (visible) {\n\t\t\treturn this._getLastVisibleColumn(index - 1);\n\t\t}\n\n\t\treturn columns[index - 1];\n\t}\n\n\t_getFirstVisibleColumn(index?: number): IRenderColumn {\n\t\tconst columns = this.getState()._columns;\n\t\tlet start = index ?? 0;\n\n\t\twhile (\n\t\t\tstart < columns.length &&\n\t\t\t(columns[start]?.hidden || columns[start]?.collapsed)\n\t\t) {\n\t\t\tstart++;\n\t\t}\n\n\t\treturn columns[start];\n\t}\n\n\t_getLastVisibleColumn(index?: number): IRenderColumn {\n\t\tconst columns = this.getState()._columns;\n\n\t\tlet start = index ?? columns.length - 1;\n\n\t\twhile (\n\t\t\tstart < columns.length &&\n\t\t\t(columns[start]?.hidden || columns[start]?.collapsed)\n\t\t) {\n\t\t\tstart--;\n\t\t}\n\n\t\treturn columns[start];\n\t}\n\n\tisCellEditable(row: IRow, column: IColumn) {\n\t\tconst { editor, hidden } = column;\n\t\tif (!editor || hidden) return false;\n\t\tif (typeof editor === \"function\") return editor(row, column);\n\t\treturn true;\n\t}\n\n\tgetNextEditor(row: IRow, column?: IColumn): IColumn {\n\t\tlet columns = this.getState().columns;\n\t\tif (column) {\n\t\t\tconst index = columns.findIndex(c => c.id == column.id);\n\t\t\tcolumns = columns.slice(index + 1);\n\t\t}\n\t\treturn columns.find(c => this.isCellEditable(row, c));\n\t}\n\n\tgetPrevEditor(row: IRow, column?: IColumn): IColumn {\n\t\tlet columns = this.getState().columns;\n\t\tif (column) {\n\t\t\tconst index = columns.findLastIndex(c => c.id == column.id);\n\t\t\tcolumns = columns.slice(0, index);\n\t\t}\n\t\treturn columns.findLast(c => this.isCellEditable(row, c));\n\t}\n\n\ttoggleBranch(id: TID, open: boolean, nested?: boolean) {\n\t\tlet item = this._branches[id];\n\n\t\tlet { data } = this.getState();\n\t\tdata = [...data];\n\n\t\tif (id !== 0) {\n\t\t\titem = { ...item, open };\n\t\t\tconst update = this.updateTreeRow(item);\n\t\t\tif (item.$parent === 0) data = update;\n\t\t}\n\n\t\tif (nested && item.data?.length) {\n\t\t\titem.data.forEach((row: IRow) => {\n\t\t\t\tconst update = this.toggleKids(row, open, nested);\n\t\t\t\tif (id === 0) data = update;\n\t\t\t});\n\t\t}\n\t\tthis.setState({ data });\n\t}\n\n\ttoggleKids(item: IRow, open: boolean, nested?: boolean) {\n\t\titem = { ...item, open };\n\n\t\tconst data = this.updateTreeRow(item);\n\n\t\tif (nested && item.data?.length) {\n\t\t\titem.data.forEach((row: IRow) => {\n\t\t\t\tthis.toggleKids(row, open, nested);\n\t\t\t});\n\t\t}\n\t\treturn data;\n\t}\n\n\tprivate updateTreeRow(item: IRow) {\n\t\tconst id = item.id;\n\n\t\tthis._branches[id] = item;\n\n\t\tconst parentRow = this._branches[item.$parent];\n\t\tconst parentIndex = parentRow.data.findIndex((a: IRow) => a.id == id);\n\n\t\tparentRow.data = [...parentRow.data];\n\t\tparentRow.data[parentIndex] = item;\n\n\t\treturn parentRow.data;\n\t}\n\n\tprivate isSelected(id: TID): boolean {\n\t\treturn this.getState().selectedRows.indexOf(id) !== -1;\n\t}\n\n\tprivate findAndRemove(items: any[], id: TID): any {\n\t\tfor (let i = 0; i < items.length; i++) {\n\t\t\tif (items[i].id == id) {\n\t\t\t\treturn items.splice(i, 1)[0];\n\t\t\t}\n\t\t\tif (items[i].data) {\n\t\t\t\tconst copy = [...items[i].data];\n\t\t\t\tconst found = this.findAndRemove(copy, id);\n\t\t\t\tif (found) {\n\t\t\t\t\titems[i] = {\n\t\t\t\t\t\t...items[i],\n\t\t\t\t\t\tdata: copy,\n\t\t\t\t\t};\n\t\t\t\t\treturn found;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tprivate insertItem(\n\t\titems: any[],\n\t\ttargetId: TID,\n\t\titem: any,\n\t\tmode: IDataMethodsConfig[\"move-item\"][\"mode\"]\n\t): boolean {\n\t\tfor (let i = 0; i < items.length; i++) {\n\t\t\tif (items[i].id == targetId) {\n\t\t\t\tconst targetItem = items[i];\n\t\t\t\tconst insertIndex = mode === \"before\" ? i : i + 1;\n\n\t\t\t\t// is a branch\n\t\t\t\tif (targetItem.data) {\n\t\t\t\t\tif (mode === \"before\") {\n\t\t\t\t\t\tconst prevItem = i > 0 ? items[i - 1] : null;\n\n\t\t\t\t\t\t// open branch - insert as last child of prev. branch (before)\n\t\t\t\t\t\tif (prevItem?.data && prevItem.open) {\n\t\t\t\t\t\t\titems[i - 1] = {\n\t\t\t\t\t\t\t\t...prevItem,\n\t\t\t\t\t\t\t\tdata: [...prevItem.data, item],\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\titems.splice(insertIndex, 0, item);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// open branch - insert as first child of target branch (after)\n\t\t\t\t\t\tif (targetItem.open) {\n\t\t\t\t\t\t\titems[i] = {\n\t\t\t\t\t\t\t\t...targetItem,\n\t\t\t\t\t\t\t\tdata: [item, ...targetItem.data],\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\titems.splice(insertIndex, 0, item);\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (items[i].data) {\n\t\t\t\titems[i] = {\n\t\t\t\t\t...items[i],\n\t\t\t\t\tdata: [...items[i].data],\n\t\t\t\t};\n\t\t\t\tif (this.insertItem(items[i].data, targetId, item, mode)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate moveItem(\n\t\tid: TID,\n\t\ttarget: TID,\n\t\tdata: any[],\n\t\tmode: IDataMethodsConfig[\"move-item\"][\"mode\"]\n\t) {\n\t\tconst items = [...data];\n\t\tconst movedItem = this.findAndRemove(items, id);\n\t\tthis.insertItem(items, target, movedItem, mode);\n\t\treturn items;\n\t}\n\n\tprivate copyColumns(columns: IColumn[]) {\n\t\tconst _columns: IRenderColumn[] = [];\n\t\tcolumns.forEach(col => {\n\t\t\tconst copy = { ...col } as IRenderColumn;\n\t\t\tthis.copyHeaderFooter(copy, \"header\");\n\t\t\tthis.copyHeaderFooter(copy, \"footer\");\n\t\t\t_columns.push(copy);\n\t\t});\n\t\treturn _columns;\n\t}\n\n\tprivate copyHeaderFooter(col: IColumn, type: TColumnType) {\n\t\tlet config: any = col[type];\n\n\t\tconfig = Array.isArray(config) ? [...config] : [config];\n\t\tconfig.forEach((text: any, i: number) => {\n\t\t\tconfig[i] = typeof text === \"string\" ? { text } : { ...text };\n\t\t});\n\n\t\tcol[type] = config;\n\t}\n\n\tprivate setCollapsibleColumns(\n\t\tcol: IRenderColumn,\n\t\tindex: number,\n\t\tcolumns: IRenderColumn[]\n\t) {\n\t\tlet header = col.header;\n\t\tfor (let r = 0; r < header.length; r++) {\n\t\t\tconst cell = header[r];\n\n\t\t\tif (cell.collapsible && cell.collapsed) {\n\t\t\t\tif (cell.collapsible !== \"first\") {\n\t\t\t\t\tcol.collapsed = true;\n\t\t\t\t\tcol.width = 36;\n\t\t\t\t\tcell.vertical = true;\n\n\t\t\t\t\tconst diff = header.length - r;\n\t\t\t\t\theader = header.slice(0, r + 1);\n\t\t\t\t\theader[r].rowspan = diff;\n\t\t\t\t}\n\n\t\t\t\tconst colspan = cell.colspan;\n\t\t\t\tif (colspan) {\n\t\t\t\t\tconst nextCell = header[r + 1];\n\t\t\t\t\tlet spanStart = 1;\n\n\t\t\t\t\tif (nextCell && nextCell.colspan && !nextCell.collapsed) {\n\t\t\t\t\t\tspanStart = nextCell.colspan;\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (let span = spanStart; span < colspan; span++) {\n\t\t\t\t\t\tconst curCol = columns[index + span];\n\t\t\t\t\t\tif (curCol) {\n\t\t\t\t\t\t\tcurCol.hidden = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate normalizeColumns(\n\t\tcolumns: IRenderColumn[],\n\t\tindex: number,\n\t\ttype: TColumnType,\n\t\trowsCount: number,\n\t\tsizes: IRenderSizes\n\t) {\n\t\tconst col = columns[index];\n\t\tif (!col.width) col.width = col.flexgrow ? 17 : sizes.columnWidth;\n\n\t\tcol._colindex = index + 1;\n\n\t\t// normalize header and footer config\n\t\tconst config: IRenderHeaderCell[] = col[type];\n\t\tconst rowHeights = sizes[`${type}RowHeights`];\n\n\t\tfor (let i = 0; i < rowsCount; i++) {\n\t\t\tconst row: IRenderHeaderCell = config[i];\n\n\t\t\trow.id = col.id;\n\n\t\t\t// stretch cells with no rowspan to fit available space or cut rowspan if it was set incorrectly\n\t\t\tif (i === config.length - 1) {\n\t\t\t\trow.rowspan = row.rowspan\n\t\t\t\t\t? Math.min(row.rowspan, rowsCount - i)\n\t\t\t\t\t: rowsCount - i;\n\t\t\t}\n\n\t\t\t// fill space covered by rowspans with empties so that rows are rendered column by column regardless of upper row overlap\n\t\t\tfor (let r = 1; r < row.rowspan; r++) {\n\t\t\t\t(config as any).splice(i + r, 0, { _hidden: true });\n\t\t\t\t// fill neighboring columns as well for headers with colspans and rowspans\n\t\t\t\tfor (let c = 1; c < row.colspan; c++) {\n\t\t\t\t\tconst nextColRows = columns[index + c][type];\n\t\t\t\t\t(nextColRows as any[]).splice(i + r, 0, {});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (row.rowspan) {\n\t\t\t\tconst rHeights =\n\t\t\t\t\trow.rowspan === rowsCount\n\t\t\t\t\t\t? rowHeights\n\t\t\t\t\t\t: rowHeights.slice(i, row.rowspan + i);\n\t\t\t\tconst height = rHeights.reduce((a, b) => a + b, 0);\n\t\t\t\trow.height = height;\n\t\t\t\tif (i + row.rowspan != rowsCount) row.height--; // -1px because of row border-bottom\n\t\t\t}\n\n\t\t\t// set widths for header cells\n\t\t\tif (row.colspan) {\n\t\t\t\tlet width = col.width;\n\t\t\t\tlet flexgrow = col.flexgrow || 0;\n\t\t\t\tconst colspan = row.colspan;\n\t\t\t\tfor (let span = 1; span < colspan; span++) {\n\t\t\t\t\tconst curCell = columns[index + span];\n\t\t\t\t\tif (curCell) {\n\t\t\t\t\t\tif (curCell.hidden) {\n\t\t\t\t\t\t\trow.colspan -= 1;\n\t\t\t\t\t\t} else if (curCell.flexgrow) {\n\t\t\t\t\t\t\tflexgrow += curCell.flexgrow;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twidth += curCell.width || sizes.columnWidth;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (flexgrow) {\n\t\t\t\t\t\trow.flexgrow = flexgrow;\n\t\t\t\t\t} else {\n\t\t\t\t\t\trow.width = width;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\trow.width = col.width;\n\t\t\t\trow.flexgrow = col.flexgrow;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\ttype === \"header\" &&\n\t\t\t\trow.filter &&\n\t\t\t\ttypeof row.filter === \"string\"\n\t\t\t) {\n\t\t\t\trow.filter = { type: row.filter };\n\t\t\t}\n\t\t}\n\n\t\tif (config.length > rowsCount) config.length = rowsCount;\n\t\tcol[type] = config;\n\n\t\t// #if [WX_PACKAGE_TYPE=trial]\n\t\tif (!isValid()) {\n\t\t\tif (\n\t\t\t\t(isExpired() || isBadLuck()) &&\n\t\t\t\tconfig.length &&\n\t\t\t\ttypeof config[0] === \"object\" &&\n\t\t\t\tconfig[0].text\n\t\t\t) {\n\t\t\t\tconfig[0].text = `[trial] ${config[0].text}`;\n\t\t\t}\n\t\t}\n\t\t// #endif\n\t}\n\n\tnormalizeRows(data: IRow[]): IRow[] {\n\t\tdata.forEach(row => {\n\t\t\tif (!row.id) row.id = uid();\n\t\t});\n\t\treturn data;\n\t}\n\n\tnormalizeTreeRows(data: IRow[], level?: number, parent?: TID): IRow[] {\n\t\tdata.forEach(row => {\n\t\t\tif (!row.id) row.id = uid();\n\n\t\t\trow.$level = level || 0;\n\t\t\trow.$parent = parent || 0;\n\n\t\t\tthis._branches[row.id] = row;\n\n\t\t\tif (row.data) {\n\t\t\t\tif (row.data.length) {\n\t\t\t\t\trow.$count = row.data.length;\n\t\t\t\t\tthis.normalizeTreeRows(row.data, row.$level + 1, row.id);\n\t\t\t\t} else {\n\t\t\t\t\tdelete row.data;\n\t\t\t\t\tdelete row.$count;\n\t\t\t\t\tdelete row.open;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn data;\n\t}\n\n\tsortTree(data: any[], sorter: (a: TSortValue, b: TSortValue) => number) {\n\t\tdata.sort(sorter);\n\t\tdata.forEach(item => {\n\t\t\tif (item.data) {\n\t\t\t\tthis.sortTree(item.data, sorter);\n\t\t\t}\n\t\t});\n\t}\n\n\tfilterTree(\n\t\tdata: IRow[],\n\t\tfilter: (row: IRow) => boolean,\n\t\tfilterIds: TID[]\n\t): TID[] {\n\t\tdata.forEach(row => {\n\t\t\tif (filter(row)) filterIds.push(row.id);\n\t\t\tif (row.data) this.filterTree(row.data, filter, filterIds);\n\t\t});\n\t\treturn filterIds;\n\t}\n\n\tflattenRows(data: IRow[], flatData: IRow[], filterIds: TID[]): IRow[] {\n\t\tconst res: IRow[] = flatData;\n\t\tdata.forEach(row => {\n\t\t\tif (!filterIds || filterIds.includes(row.id)) res.push(row);\n\t\t\tif (row.data?.length && row.open !== false) {\n\t\t\t\tthis.flattenRows(row.data, res, filterIds);\n\t\t\t}\n\t\t});\n\t\treturn res;\n\t}\n\n\tcreateFilter(filterValues: IFilterValues) {\n\t\tconst { _columns: columns } = this.getState();\n\t\tconst filters: ((obj: any) => boolean)[] = [];\n\n\t\tfor (const field in filterValues) {\n\t\t\tconst { config, type } = columns\n\t\t\t\t.find(c => c.id == field)\n\t\t\t\t.header.find(h => h.filter).filter;\n\t\t\tconst value = filterValues[field];\n\n\t\t\tfilters.push((obj: any) => {\n\t\t\t\tif (config?.handler) {\n\t\t\t\t\treturn config.handler(obj[field], value);\n\t\t\t\t}\n\n\t\t\t\treturn getFilterHandler(type)(obj[field], value);\n\t\t\t});\n\t\t}\n\n\t\treturn (obj: any) => {\n\t\t\tfor (let i = 0; i < filters.length; i++) {\n\t\t\t\tif (!filters[i](obj)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t};\n\t}\n\n\tprivate normalizeSizes(\n\t\tcolumns: IRenderColumn[],\n\t\tsizes: ISizeConfig,\n\t\theaderRowCount: number,\n\t\tfooterRowCount: number,\n\t\tskin: string\n\t): IRenderSizes {\n\t\tconst headerRowHeights = getHeaderFooterHeights(\n\t\t\tcolumns,\n\t\t\t\"header\",\n\t\t\theaderRowCount,\n\t\t\tsizes.headerHeight,\n\t\t\tskin\n\t\t);\n\t\tconst footerRowHeights = getHeaderFooterHeights(\n\t\t\tcolumns,\n\t\t\t\"footer\",\n\t\t\tfooterRowCount,\n\t\t\tsizes.footerHeight,\n\t\t\tskin\n\t\t);\n\n\t\t// need to recalculate header/footer height if header has rows or vertical text\n\t\tconst headerHeight = headerRowHeights.reduce((a, b) => a + b, 0);\n\t\tconst footerHeight = footerRowHeights.reduce((a, b) => a + b, 0);\n\n\t\treturn {\n\t\t\t...sizes,\n\t\t\theaderRowHeights,\n\t\t\tfooterRowHeights,\n\t\t\theaderHeight,\n\t\t\tfooterHeight,\n\t\t};\n\t}\n}\n\nlet base = new Date().valueOf();\nfunction uid() {\n\treturn \"temp://\" + base++;\n}\n\ninterface ISkipUndoAction {\n\tskipUndo?: boolean;\n}\n\ntype CombineTypes<T, N> = {\n\t[P in keyof T]: T[P] & N;\n};\n\nexport type IDataMethodsConfig = CombineTypes<\n\t{\n\t\t[\"update-cell\"]: {\n\t\t\tid: TID;\n\t\t\tcolumn: TID;\n\t\t\tvalue: string | number | Date;\n\t\t\teventSource?: string;\n\t\t};\n\t\t[\"add-row\"]: {\n\t\t\tid?: TID;\n\t\t\tbefore?: TID;\n\t\t\tafter?: TID;\n\t\t\trow: IRow;\n\t\t\tselect?: boolean;\n\t\t\teventSource?: string;\n\t\t};\n\t\t[\"delete-row\"]: { id: TID; eventSource?: string };\n\t\t[\"update-row\"]: {\n\t\t\tid: TID;\n\t\t\trow: Record<string, any>;\n\t\t\teventSource?: string;\n\t\t};\n\t\t[\"select-row\"]: {\n\t\t\tid: TID;\n\t\t\ttoggle?: boolean;\n\t\t\trange?: boolean;\n\t\t\tmode?: boolean;\n\t\t\tshow?: boolean;\n\t\t\tcolumn?: TID;\n\t\t};\n\t\t[\"resize-column\"]: {\n\t\t\tid: TID;\n\t\t\twidth?: number;\n\t\t\tauto?: boolean | \"data\" | \"header\";\n\t\t\tmaxRows?: number;\n\t\t\tinProgress?: boolean;\n\t\t\teventSource?: string;\n\t\t};\n\t\t[\"hide-column\"]: {\n\t\t\tid: string;\n\t\t\tmode?: boolean;\n\t\t\teventSource?: string;\n\t\t} & ISkipUndoAction;\n\t\t[\"sort-rows\"]: {\n\t\t\tkey: string;\n\t\t\torder?: \"asc\" | \"desc\";\n\t\t\tadd?: boolean;\n\t\t};\n\t\t[\"open-editor\"]: {\n\t\t\tid: string;\n\t\t\tcolumn?: string;\n\t\t};\n\t\t[\"close-editor\"]: {\n\t\t\tignore?: boolean;\n\t\t};\n\t\t[\"editor\"]: {\n\t\t\tvalue: any;\n\t\t};\n\t\t[\"filter-rows\"]: {\n\t\t\tfilter?: any;\n\t\t\tkey?: string;\n\t\t\tvalue?: any;\n\t\t};\n\t\t[\"collapse-column\"]: {\n\t\t\tid: TID;\n\t\t\trow?: number;\n\t\t\tmode?: boolean;\n\t\t\teventSource?: string;\n\t\t};\n\t\t[\"move-item\"]: {\n\t\t\tid: TID;\n\t\t\ttarget: TID;\n\t\t\tmode?: \"before\" | \"after\";\n\t\t\tinProgress?: boolean;\n\t\t\teventSource?: string;\n\t\t};\n\t\t[\"open-row\"]: {\n\t\t\tid: TID;\n\t\t\tnested?: boolean;\n\t\t\teventSource?: string;\n\t\t};\n\t\t[\"close-row\"]: {\n\t\t\tid: TID;\n\t\t\tnested?: boolean;\n\t\t\teventSource?: string;\n\t\t};\n\t\t[\"export\"]: {\n\t\t\toptions?: IExportOptions;\n\t\t\tresult?: any;\n\t\t};\n\t\t[\"scroll\"]: {\n\t\t\trow?: TID;\n\t\t\tcolumn?: TID;\n\t\t};\n\t\t[\"hotkey\"]: {\n\t\t\tkey: string;\n\t\t\tevent: any;\n\t\t\tisInput?: boolean;\n\t\t};\n\t\t[\"focus-cell\"]: {\n\t\t\trow?: TID;\n\t\t\tcolumn?: TID;\n\t\t\teventSource?: string;\n\t\t};\n\t\t[\"print\"]?: IPrintConfig;\n\t\t[\"undo\"]: void;\n\t\t[\"redo\"]: void;\n\t\t[\"request-data\"]: {\n\t\t\trow: {\n\t\t\t\tstart: number;\n\t\t\t\tend: number;\n\t\t\t};\n\t\t};\n\t},\n\t{\n\t\t[key: string]: any;\n\t}\n>;\n","// src/locate.ts\nfunction locate(el, attr = \"data-id\") {\n  let node = el;\n  if (!node.tagName && el.target)\n    node = el.target;\n  while (node) {\n    if (node.getAttribute) {\n      const id3 = node.getAttribute(attr);\n      if (id3) return node;\n    }\n    node = node.parentNode;\n  }\n  return null;\n}\nfunction locateAttr(el, attr = \"data-id\") {\n  const node = locate(el, attr);\n  if (node) return node.getAttribute(attr);\n  return null;\n}\nfunction locateID(el, attr = \"data-id\") {\n  const node = locate(el, attr);\n  if (node) {\n    return id(node.getAttribute(attr));\n  }\n  return null;\n}\nfunction locateNode(el, node) {\n  let n = el;\n  while (n) {\n    if (n === node) {\n      return true;\n    }\n    n = n?.parentNode;\n  }\n  return null;\n}\nfunction id(value) {\n  if (typeof value === \"string\") {\n    const t = value * 1;\n    if (!isNaN(t)) return t;\n  }\n  return value;\n}\n\n// src/env.ts\nfunction getEnv() {\n  return {\n    detect: () => true,\n    addEvent: function(node, event, handler) {\n      node.addEventListener(event, handler);\n      return () => node.removeEventListener(event, handler);\n    },\n    addGlobalEvent: function(event, handler) {\n      document.addEventListener(event, handler);\n      return () => document.removeEventListener(event, handler);\n    },\n    getTopNode: function() {\n      return window.document.body;\n    }\n  };\n}\nvar env = getEnv();\nfunction setEnv(update) {\n  Object.assign(env, update);\n}\n\n// src/delegateClick.ts\nfunction delegateEvent(node, handlers, event) {\n  function handleEvent(ev) {\n    const node2 = locate(ev);\n    if (!node2) return;\n    const id3 = id(node2.dataset.id);\n    if (typeof handlers === \"function\") return handlers(id3, ev);\n    let action;\n    let test = ev.target;\n    while (test != node2) {\n      action = test.dataset ? test.dataset.action : null;\n      if (action) {\n        if (handlers[action]) {\n          handlers[action](id3, ev);\n          return;\n        }\n      }\n      test = test.parentNode;\n    }\n    if (handlers[event]) handlers[event](id3, ev);\n  }\n  env.addEvent(node, event, handleEvent);\n}\nfunction delegateClick(node, handlers) {\n  delegateEvent(node, handlers, \"click\");\n  if (handlers.dblclick) delegateEvent(node, handlers.dblclick, \"dblclick\");\n}\n\n// src/array.ts\nfunction remove(items, node) {\n  for (let i = items.length - 1; i >= 0; i--) {\n    if (items[i] === node) {\n      items.splice(i, 1);\n      break;\n    }\n  }\n}\n\n// src/clickOutside.ts\nvar activationDate = /* @__PURE__ */ new Date();\nvar skipNext = false;\nvar outsideHandlers = [];\nvar outsideListners = [];\nvar handleOutsideClick = (event) => {\n  if (skipNext) {\n    skipNext = false;\n    return;\n  }\n  for (let i = outsideListners.length - 1; i >= 0; i--) {\n    const { node, date, props } = outsideListners[i];\n    if (date > activationDate) continue;\n    if (!node.contains(event.target) && node !== event.target) {\n      if (props.callback) props.callback(event);\n      if (props.modal || event.defaultPrevented) break;\n    }\n  }\n};\nvar handleMouseDown = (event) => {\n  activationDate = /* @__PURE__ */ new Date();\n  skipNext = true;\n  for (let i = outsideListners.length - 1; i >= 0; i--) {\n    const { node } = outsideListners[i];\n    if (!node.contains(event.target) && node !== event.target) {\n      skipNext = false;\n      break;\n    }\n  }\n};\nfunction clickOutside(node, props) {\n  if (!outsideHandlers.length) {\n    outsideHandlers = [\n      env.addGlobalEvent(\"click\", handleOutsideClick, node),\n      env.addGlobalEvent(\"contextmenu\", handleOutsideClick, node),\n      env.addGlobalEvent(\"mousedown\", handleMouseDown, node)\n    ];\n  }\n  if (typeof props !== \"object\") {\n    props = { callback: props };\n  }\n  const pack = { node, date: /* @__PURE__ */ new Date(), props };\n  outsideListners.push(pack);\n  return {\n    destroy() {\n      remove(outsideListners, pack);\n      if (!outsideListners.length) {\n        outsideHandlers.forEach((e) => e());\n        outsideHandlers = [];\n      }\n    }\n  };\n}\n\n// src/positioning.ts\nvar isBottom = (mode) => mode.indexOf(\"bottom\") !== -1;\nvar isLeft = (mode) => mode.indexOf(\"left\") !== -1;\nvar isRight = (mode) => mode.indexOf(\"right\") !== -1;\nvar isTop = (mode) => mode.indexOf(\"top\") !== -1;\nvar isFit = (mode) => mode.indexOf(\"fit\") !== -1;\nvar isOverlap = (mode) => mode.indexOf(\"overlap\") !== -1;\nvar isCenter = (mode) => mode.indexOf(\"center\") !== -1;\nfunction getMaxIndex(p, ap) {\n  let zi = 0;\n  const top = env.getTopNode(p);\n  while (p) {\n    if (p === top) break;\n    const pos2 = getComputedStyle(p)[\"position\"];\n    if (pos2 === \"absolute\" || pos2 === \"relative\" || pos2 === \"fixed\") {\n      zi = parseInt(getComputedStyle(p)[\"zIndex\"]) || 0;\n    }\n    p = p.parentNode;\n    if (p === ap) break;\n  }\n  return zi;\n}\nvar x;\nvar y;\nvar width;\nvar pos;\nfunction calculatePosition(self, parent, at = \"bottom\", left = 0, top = 0) {\n  if (!self) return null;\n  x = left;\n  y = top;\n  width = \"auto\";\n  let z = 0;\n  let fixLeft = 0;\n  const body = getAbsParent(self);\n  const cont = isOverlap(at) ? env.getTopNode(self) : body;\n  if (!body) return null;\n  const bodyRect = body.getBoundingClientRect();\n  const selfRect = self.getBoundingClientRect();\n  const contRect = cont.getBoundingClientRect();\n  if (parent) {\n    const zi = getMaxIndex(parent, body);\n    z = Math.max(zi + 1, 20);\n  }\n  if (parent) {\n    pos = parent.getBoundingClientRect();\n    if (isFit(at)) width = pos.width + \"px\";\n    if (at !== \"point\") {\n      if (isCenter(at)) {\n        if (isFit(at)) {\n          x = 0;\n        } else {\n          x = contRect.width / 2;\n          fixLeft = 1;\n        }\n        y = (contRect.height - selfRect.height) / 2;\n      } else {\n        const fix = isOverlap(at) ? 0 : 1;\n        x = isRight(at) ? pos.right + fix : pos.left - fix;\n        y = isBottom(at) ? pos.bottom + 1 : pos.top;\n      }\n    }\n  } else pos = { left, right: left, top, bottom: top };\n  if (isLeft(at)) {\n    x = pos.left;\n    fixLeft = 2;\n  }\n  if (isTop(at)) {\n    y = pos.top - selfRect.height;\n  }\n  const dy = y + selfRect.height - contRect.bottom;\n  if (dy > 0) y -= dy;\n  const dxR = x + selfRect.width - contRect.right;\n  if (dxR > 0) {\n    if (!isRight(at)) {\n      x = contRect.right - selfRect.width;\n    } else {\n      fixLeft = 2;\n    }\n  }\n  if (fixLeft) x = Math.round(x - selfRect.width * fixLeft / 2);\n  if (x < 0) {\n    if (at !== \"left\") {\n      x = 0;\n    } else {\n      x = pos.right;\n    }\n  }\n  x += cont.scrollLeft - bodyRect.left;\n  y += cont.scrollTop - bodyRect.top;\n  width = width || \"auto\";\n  return { x, y, z, width };\n}\nfunction getAbsParent(el) {\n  const top = env.getTopNode(el);\n  if (el) el = el.parentElement;\n  while (el) {\n    const pos2 = getComputedStyle(el)[\"position\"];\n    if (el === top || pos2 === \"relative\" || pos2 === \"absolute\" || pos2 === \"fixed\")\n      return el;\n    el = el.parentNode;\n  }\n  return null;\n}\n\n// src/common.ts\nvar id2 = (/* @__PURE__ */ new Date()).valueOf();\nfunction uid() {\n  id2 += 1;\n  return id2;\n}\n\n// src/dates.ts\nfunction toFixed(num) {\n  if (num < 10) return \"0\" + num;\n  return num.toString();\n}\nfunction toFixedMs(num) {\n  const temp = toFixed(num);\n  return temp.length == 2 ? \"0\" + temp : temp;\n}\nfunction getDuodecade(year) {\n  const start = Math.floor(year / 11) * 11;\n  return {\n    start,\n    end: start + 11\n  };\n}\nfunction getISOWeek(ndate) {\n  let nday = ndate.getDay();\n  if (nday === 0) {\n    nday = 7;\n  }\n  const first_thursday = new Date(ndate.valueOf());\n  first_thursday.setDate(ndate.getDate() + (4 - nday));\n  const year_number = first_thursday.getFullYear();\n  const ordinal_date = Math.floor(\n    (first_thursday.getTime() - new Date(year_number, 0, 1).getTime()) / 864e5\n  );\n  const weekNumber = 1 + Math.floor(ordinal_date / 7);\n  return weekNumber;\n}\nvar emptyAmPm = [\"\", \"\"];\nfunction date2str(mask, date, locale2) {\n  switch (mask) {\n    case \"%d\":\n      return toFixed(date.getDate());\n    case \"%m\":\n      return toFixed(date.getMonth() + 1);\n    case \"%j\":\n      return date.getDate();\n    case \"%n\":\n      return date.getMonth() + 1;\n    case \"%y\":\n      return toFixed(date.getFullYear() % 100);\n    case \"%Y\":\n      return date.getFullYear();\n    case \"%D\":\n      return locale2.dayShort[date.getDay()];\n    case \"%l\":\n      return locale2.dayFull[date.getDay()];\n    case \"%M\":\n      return locale2.monthShort[date.getMonth()];\n    case \"%F\":\n      return locale2.monthFull[date.getMonth()];\n    case \"%h\":\n      return toFixed((date.getHours() + 11) % 12 + 1);\n    case \"%g\":\n      return (date.getHours() + 11) % 12 + 1;\n    case \"%G\":\n      return date.getHours();\n    case \"%H\":\n      return toFixed(date.getHours());\n    case \"%i\":\n      return toFixed(date.getMinutes());\n    case \"%a\":\n      return ((date.getHours() > 11 ? locale2.pm : locale2.am) || emptyAmPm)[0];\n    case \"%A\":\n      return ((date.getHours() > 11 ? locale2.pm : locale2.am) || emptyAmPm)[1];\n    case \"%s\":\n      return toFixed(date.getSeconds());\n    case \"%S\":\n      return toFixedMs(date.getMilliseconds());\n    case \"%W\":\n      return toFixed(getISOWeek(date));\n    case \"%c\": {\n      let str = date.getFullYear() + \"\";\n      str += \"-\" + toFixed(date.getMonth() + 1);\n      str += \"-\" + toFixed(date.getDate());\n      str += \"T\";\n      str += toFixed(date.getHours());\n      str += \":\" + toFixed(date.getMinutes());\n      str += \":\" + toFixed(date.getSeconds());\n      return str;\n    }\n    default:\n      return mask;\n  }\n}\nvar formatFlags = /%[a-zA-Z]/g;\nfunction dateToString(format, locale2) {\n  if (typeof format == \"function\") return format;\n  return function(date) {\n    if (!date) return \"\";\n    if (!date.getMonth) date = new Date(date);\n    return format.replace(\n      formatFlags,\n      (s) => date2str(s, date, locale2)\n    );\n  };\n}\n\n// src/locale.ts\nfunction isObject(a) {\n  return a && typeof a === \"object\" && !Array.isArray(a);\n}\nfunction extend(a, b) {\n  for (const key in b) {\n    const from = b[key];\n    if (isObject(a[key]) && isObject(from)) {\n      a[key] = extend(\n        { ...a[key] },\n        b[key]\n      );\n    } else {\n      a[key] = b[key];\n    }\n  }\n  return a;\n}\nfunction locale(words) {\n  return {\n    getGroup(group) {\n      const block = words[group];\n      return (key) => {\n        return block ? block[key] || key : key;\n      };\n    },\n    getRaw() {\n      return words;\n    },\n    extend(values, optional) {\n      if (!values) return this;\n      let data;\n      if (optional) {\n        data = extend({ ...values }, words);\n      } else {\n        data = extend({ ...words }, values);\n      }\n      return locale(data);\n    }\n  };\n}\n\n// src/salesforce.ts\nvar salesForceEnv = {\n  detect() {\n    if (typeof window === \"undefined\") return false;\n    return (\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      !!window[\"Sfdc\"] || // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      !!window[\"$A\"] || // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      !!window[\"Aura\"] || \"$shadowResolver$\" in document.body\n    );\n  },\n  addGlobalEvent: function(event, handler, rel) {\n    const d = salesForceEnv.getTopNode(rel);\n    d.addEventListener(event, handler);\n    return () => d.removeEventListener(event, handler);\n  },\n  getTopNode: function(rel) {\n    return rel.closest('[data-wx-root=\"true\"]');\n  }\n};\n\nexport { calculatePosition, clickOutside, dateToString, delegateClick, delegateEvent, env, getAbsParent, getDuodecade, id, locale, locate, locateAttr, locateID, locateNode, salesForceEnv, setEnv, uid };\n//# sourceMappingURL=index.js.map\n//# sourceMappingURL=index.js.map","export type hotkeysConfig = { [key: string]: HotkeyHandler | boolean };\nexport type HotkeyHandler = (params: {\n\tkey: string;\n\tevent: KeyboardEvent;\n\tnode: HTMLElement;\n\tisInput: boolean;\n}) => void;\n\nimport { locate } from \"@wx/lib-dom\";\n\nexport function hotkeys(\n\tnode: HTMLElement,\n\t{ keys, exec }: { keys: hotkeysConfig; exec: HotkeyHandler }\n) {\n\tfor (const key in keys) {\n\t\tconst fixed = key.toLowerCase().replace(/ /g, \"\");\n\t\tif (fixed !== key) {\n\t\t\tkeys[fixed] = keys[key];\n\t\t}\n\t}\n\tfunction handleKeydown(event: any) {\n\t\tlet code = event.code.replace(\"Key\", \"\").toLowerCase();\n\t\tif (code === \" \") code = \"space\";\n\t\tconst key = `${event.ctrlKey || event.metaKey ? \"ctrl+\" : \"\"}${\n\t\t\tevent.shiftKey ? \"shift+\" : \"\"\n\t\t}${event.altKey ? \"alt+\" : \"\"}${code.replace(/^key/, \"\")}`;\n\t\tconst handler = keys[key];\n\n\t\tif (typeof handler !== \"undefined\") {\n\t\t\tconst isInput =\n\t\t\t\tevent.target.tagName === \"INPUT\" ||\n\t\t\t\tevent.target.tagName === \"TEXTAREA\" ||\n\t\t\t\tlocate(event.target, \"data-header-id\")?.classList.contains(\n\t\t\t\t\t\"wx-filter\"\n\t\t\t\t) ||\n\t\t\t\t!!event.target.closest(\".wx-cell.wx-editor\");\n\t\t\tif (typeof handler === \"function\") {\n\t\t\t\thandler({ key, event, node, isInput });\n\t\t\t} else if (handler) {\n\t\t\t\texec({ key, event, node, isInput });\n\t\t\t}\n\t\t}\n\t}\n\n\tnode.addEventListener(\"keydown\", handleKeydown);\n\treturn {\n\t\tdestroy: () => {\n\t\t\tnode.removeEventListener(\"keydown\", handleKeydown);\n\t\t},\n\t};\n}\n","import type { TScrollConfig } from \"./types\";\n\nexport function scrollTo(\n\tnode: HTMLElement,\n\tconfig: { scroll: any; getHeight: any; getWidth: any; getScrollMargin: any }\n) {\n\tlet prev: TScrollConfig = null;\n\tconfig.scroll.subscribe((v: TScrollConfig) => {\n\t\tif (!v || v === prev) return;\n\t\tprev = v;\n\n\t\tconst { left, top, height, width } = v;\n\t\tconst bHeight = config.getHeight();\n\t\tconst bWidth = config.getWidth();\n\t\tconst margin = config.getScrollMargin();\n\n\t\tif (top >= 0) {\n\t\t\tconst now = node.scrollTop;\n\t\t\tif (top < now) {\n\t\t\t\tnode.scrollTop = top;\n\t\t\t} else if (top + height > now + bHeight) {\n\t\t\t\tnode.scrollTop = top - bHeight + height;\n\t\t\t}\n\t\t}\n\t\tif (left >= 0) {\n\t\t\tconst now = node.scrollLeft;\n\t\t\tif (left < now) {\n\t\t\t\tnode.scrollLeft = left;\n\t\t\t} else if (left + width > now + bWidth - margin) {\n\t\t\t\tnode.scrollLeft = left - bWidth + width + margin;\n\t\t\t}\n\t\t}\n\t});\n}\n","export interface IDefaultMenuOption {\n\tid?: string;\n\ttext?: string;\n\ticon?: string;\n\tcomp?: \"separator\";\n}\n\nexport const defaultMenuOptions: IDefaultMenuOption[] = [\n\t{ id: \"add:before\", text: \"Add before\", icon: \"wxi-table-row-plus-before\" },\n\t{ id: \"add:after\", text: \"Add after\", icon: \"wxi-table-row-plus-after\" },\n\t{ id: \"copy\", text: \"Copy\", icon: \"wxi-content-copy\" },\n\t{ comp: \"separator\" },\n\t{ id: \"delete\", text: \"Delete\", icon: \"wxi-delete-outline\" },\n];\n"],"names":["iid","uid","isSameObject","left","right","key","v","nv","isSame","i","deepCopy","obj","out","STORE_SET_SILENT","Store","config","data","mode","signals","state","values","parent","os","ov","fullKey","fullKey2","signals2","val","ss","__triggerSync","fn","DataRouter","s","r","p","b","a","k","arr","h","_calckSize","cfg","next","parser","updates","ctx","keys","needExec","trgs","sources","prev","sizes","EventBus","name","handler","tag","stack","ev","res","rawGetter","rawSetter","getValue","row","col","getter","id","setValue","setter","getEditorConfig","columns","filter","editor","map","label","header","options","comp","type","download","blob","filename","document","createElement","href","URL","createObjectURL","body","appendChild","click","removeChild","getRenderValue","template","optionsMap","Array","isArray","x","get","getCsvData","reg","csv","rowSep","rows","colSep","cols","_columns","flatData","addCsvHeader","length","c","value","test","replace","push","join","footer","text","getExcelData","styles","cells","merged","colSizes","rowSizes","_sizes","width","flexgrow","columnWidth","rIndex","addExcelHeader","concat","headerRowHeights","height","dataRow","newStyle","cellStyle","cellTemplate","result","prepareCellValues","rowHeight","footerRowHeights","colspan","rowspan","from","column","to","headerCellStyle","headerCellTemplate","baseIndex","Date","getExcelDate","format","findIndex","style","getExportStyles","skin","fontColor","material","willow","bg","headerBg","border","headerBorderColor","color","hBorder","align","verticalAlign","headerStyles","fontWeight","background","borderBottom","borderRight","cell","date","getTime","getTimezoneOffset","MODE","PPI","PAPER","PAPERS","a3","a4","letter","getPrintColumns","tables","visibleColumns","hidden","maxWidth","getPaperWidth","forEach","index","getHeaderFooterPrintColumns","rowsHeights","hcell","nextCell","collapsed","colstubs","slice","reduce","y","rowstubs","rRow","currentCell","lastCell","findLast","ppi","paper","getPixels","inches","normalizePrintConfig","getPrintCellStyle","getPrintFilterValue","filterValues","find","COLUMNS_ACTIONS","DATA_ACTIONS","FLATDATA_ACTIONS","PROGRESS_ACTIONS","HistoryManager","undo","redo","progress","in","getState","setState","_previousValues","constructor","eventBus","stateGetter","stateSetter","setHandlers","resetStateHistory","getHandlers","action","source","getPrev","rowIndex","before","undefined","getRow","getColumn","prevValue","rowData","target","sourceIndex","nested","resetHistory","handlers","intercept","eventSource","skipUndo","includes","inProgress","setPrev","on","historyEntry","addToHistory","prop","entry","setStateHistory","handleUndo","pop","exec","handleRedo","history","tree","getTreeRow","getStamp","gen","isCommunity","community","sortAsc","sortDesc","sortBy","order","sortMethod","sortByMany","sortArray","sorts","item","BASE_CELL_OFFSET","SORT_EL_OFFSET","suggestSkin","querySelector","className","substring","getTextSize","css","offsets","basewidth","container","content","classList","add","cssText","innerText","rect","getBoundingClientRect","rectWidth","Math","ceil","rectHeight","max","remove","getHeaderFooterHeights","condition","rowsCount","defaultHeight","vertical","cellCss","count","prevHeight","sum","diff","getColumnWidth","colText","treetoggle","$level","$count","draggable","getHeaderColWidth","sortElOffset","sort","currWidth","filtersHandlers","toLowerCase","indexOf","richselect","getFilterHandler","DataStore","_router","_branches","_xlsxWorker","_historyManager","w","writable","async","defaultSizes","headerHeight","footerHeight","bind","_skin","copyColumns","headerRowCount","footerRowCount","setCollapsibleColumns","normalizeSizes","normalizeColumns","_filterIds","filterIds","flattenRows","d","inBus","ignore","getNextEditor","columnEditor","renderedValue","select","after","selectForce","splice","update","show","selectedRows","focusCell","isSelected","updateTreeRow","$parent","toggle","range","sindex","eindex","split","auto","maxRows","min","curData","sortMarks","fields","Object","fLength","sortArr","sorter","nextData","sortTree","filterFn","createFilter","filterTree","targetIndex","updatedData","moveItem","normalizeTreeRows","toggleBranch","Promise","resolve","reject","fileName","Blob","styleOps","stylesArr","lastHeaderCell","firstFooterCell","fill","cellStyles","path","cdn","xlsxWorker","getXlsxWorker","then","onmessage","e","postMessage","sheetName","event","isInput","preventDefault","colId","_getFirstVisibleColumn","rowId","getPrevRow","getNextRow","getNextColumn","getPrevColumn","getPrevEditor","open","_getLastVisibleColumn","at","dynamic","top","ind","scroll","_print","setStateAsync","initOnce","url","window","Worker","addEventListener","init","hasOwnProperty","Map","normalizeRows","getRowIndex","visible","start","isCellEditable","findLastIndex","toggleKids","parentRow","parentIndex","findAndRemove","items","copy","found","insertItem","targetId","targetItem","insertIndex","prevItem","movedItem","copyHeaderFooter","collapsible","spanStart","span","curCol","_colindex","rowHeights","_hidden","nextColRows","curCell","level","filters","field","base","valueOf","locate","el","attr","node","hotkeys","fixed","handleKeydown","code","ctrlKey","metaKey","shiftKey","altKey","tagName","contains","closest","destroy","removeEventListener","scrollTo","subscribe","bHeight","getHeight","bWidth","getWidth","margin","getScrollMargin","now","scrollTop","scrollLeft","defaultMenuOptions","icon"],"mappings":"AACA,IAAIA,KAAuB,oBAAI,KAAM,GAAE,QAAS,GAC5CC,IAAM,MAAMD;AAOhB,SAASE,EAAaC,GAAMC,GAAO;AACjC,MAAI,OAAO,KAAKD,CAAI,EAAE,WAAW,OAAO,KAAKC,CAAK,EAAE,OAAQ,QAAO;AACnE,aAAWC,KAAOD,GAAO;AACvB,UAAME,IAAIH,EAAKE,CAAG,GACZE,IAAKH,EAAMC,CAAG;AACpB,QAAI,CAACG,EAAOF,GAAGC,CAAE,EAAG,QAAO;AAAA,EAC/B;AACE,SAAO;AACT;AACA,SAASC,EAAOF,GAAGC,GAAI;AAErB,MADuB,OAAOD,KAAM,YAAY,OAAOA,KAAM,YAAY,OAAOA,KAAM,aAAaA,MAAM,KACrF,QAAOA,MAAMC;AAGjC,MAFI,OAAOD,KAAM,OAAOC,MACnBD,MAAM,QAAQC,MAAO,SAASD,MAAMC,KACrCD,aAAa,QAAQC,aAAc,QAAQD,EAAE,QAAO,MAAOC,EAAG,QAAS;AACzE,WAAO;AACT,MAAI,OAAOD,KAAM;AACf,QAAI,MAAM,QAAQA,CAAC,KAAK,MAAM,QAAQC,CAAE,GAAG;AACzC,UAAID,EAAE,WAAWC,EAAG,OAAQ,QAAO;AACnC,eAASE,IAAIH,EAAE,SAAS,GAAGG,KAAK,GAAGA;AACjC,YAAI,CAACD,EAAOF,EAAEG,CAAC,GAAGF,EAAGE,CAAC,CAAC,EAAG,QAAO;AAEnC,aAAO;AAAA,IACb;AACM,aAAOP,EAAaI,GAAGC,CAAE;AAG7B,SAAOD,MAAMC;AACf;AACA,SAASG,EAASC,GAAK;AAErB,MADI,OAAOA,KAAQ,YACfA,MAAQ,KAAM,QAAOA;AACzB,MAAIA,aAAe,KAAM,QAAO,IAAI,KAAKA,CAAG;AAC5C,MAAIA,aAAe,MAAO,QAAOA,EAAI,IAAID,CAAQ;AACjD,QAAME,IAAM,CAAE;AACd,aAAWP,KAAOM;AAChB,IAAAC,EAAIP,CAAG,IAAIK,EAASC,EAAIN,CAAG,CAAC;AAE9B,SAAOO;AACT;AAsNA,IAAIC,IAAmB,GACnBC,IAAQ,MAAM;AAAA,EAChB,YAAYC,GAAQ;AAClB,IAAIA,MACF,KAAK,YAAYA,EAAO,UACxB,KAAK,SAASA,EAAO,QAEvB,KAAK,UAAU,CAAE,GACjB,KAAK,SAAS,CAAE;AAAA,EACpB;AAAA,EACE,SAASC,GAAMC,IAAO,GAAG;AACvB,UAAMC,IAAU,CAAE;AAClB,gBAAK;AAAA,MACHF;AAAA,MACA,KAAK;AAAA,MACL,KAAK;AAAA,MACL;AAAA,MACAE;AAAA,MACAD;AAAA,IACD,GACMC;AAAA,EACX;AAAA,EACE,WAAW;AACT,WAAO,KAAK;AAAA,EAChB;AAAA,EACE,cAAc;AACZ,WAAO,KAAK;AAAA,EAChB;AAAA,EACE,gBAAgBF,GAAMG,GAAOC,GAAQC,GAAQH,GAASD,GAAM;AAC1D,eAAWZ,KAAOW,GAAM;AACtB,YAAMM,IAAKH,EAAMd,CAAG,GACdkB,IAAKH,EAAOf,CAAG,GACfE,IAAKS,EAAKX,CAAG;AACnB,UAAIiB,MACEC,MAAOhB,KAAM,OAAOA,KAAO,YAC3BA,aAAc,QACZgB,aAAc,QAAQA,EAAG,QAAO,MAAOhB,EAAG;AAAW;AAG7D,YAAMiB,IAAUH,KAAUA,IAAS,MAAM,MAAMhB;AAC/C,MAAIiB,KACEA,EAAG,QAAQf,GAAIiB,GAASN,GAASD,CAAI,MAAGG,EAAOf,CAAG,IAAIE,IACtDU,IAAOJ,IAAkBK,EAAQM,CAAO,IAAIF,EAAG,YAC9CA,EAAG,UAAW,MAEff,KAAMA,EAAG,aACXY,EAAMd,CAAG,IAAI,KAAK,YAAYE,GAAIA,GAAIiB,GAASN,CAAO,IAEtDC,EAAMd,CAAG,IAAI,KAAK,cAAcE,CAAE,GAEpCa,EAAOf,CAAG,IAAIE,IAEhBW,EAAQM,CAAO,IAAIN,EAAQM,CAAO,KAAK;AAAA,IAC7C;AAAA,EACA;AAAA,EACE,YAAYR,GAAMI,GAAQI,GAASN,GAAS;AAC1C,UAAMC,IAAQ,KAAK,cAAcH,CAAI;AACrC,gBAAK,gBAAgBA,GAAMG,GAAOC,GAAQI,GAASN,GAAS,CAAC,GAC7DC,EAAM,UAAU,CAACb,GAAGmB,GAAUC,GAAUT,OACtC,KAAK,gBAAgBX,GAAGa,GAAOC,GAAQK,GAAUC,GAAUT,CAAI,GACxD,KAEFE;AAAA,EACX;AAAA;AAAA,EAEE,cAAcQ,GAAK;AACjB,UAAMC,IAAK,CAAE,GACPC,IAAgB,WAAW;AAC/B,eAASpB,IAAI,GAAGA,IAAImB,EAAG,QAAQnB;AAC7B,QAAAmB,EAAGnB,CAAC,EAAEkB,CAAG;AAAA,IAEZ;AAoBD,WAAO;AAAA,MACL,WAdgB,CAACG,OACjBF,EAAG,KAAKE,CAAE,GACN,KAAK,SAAQ,WAAWA,GAAI,GAAGH,CAAG,IACjCG,EAAGH,CAAG,GACJ,MAAM;AACX,cAAMlB,IAAImB,EAAG,QAAQE,CAAE;AACvB,QAAIrB,KAAK,KAAGmB,EAAG,OAAOnB,GAAG,CAAC;AAAA,MAC3B;AAAA,MAQD,WArBgB,MAAM;AACtB,QAAImB,EAAG,WACD,KAAK,SAAQ,WAAWC,GAAe,CAAC,IACvCA,EAAe;AAAA,MAEvB;AAAA,MAiBC,SAPc,SAASvB,GAAG;AAC1B,eAAAqB,IAAMrB,GACC;AAAA,MACR;AAAA,IAKA;AAAA,EACL;AACA,GAmBIyB,IAAa,MAAM;AAAA,EACrB,YAAYC,GAAGC,GAAGC,GAAGC,GAAG;AACtB,IAAI,OAAOH,KAAM,aAAY,KAAK,UAAUA,IACvC,KAAK,UAAUA,EAAE,SAAS,KAAKA,CAAC,GACrC,KAAK,UAAUC,GACf,KAAK,WAAWC,GAChB,KAAK,QAAQ,CAAE,GACf,KAAK,YAA4B,oBAAI,IAAK,GAC1C,KAAK,WAA2B,oBAAI,IAAK,GACzC,KAAK,QAAQ,QAAQ,CAACE,MAAM;AAC1B,MAAAA,EAAE,GAAG,QAAQ,CAACC,MAAM;AAClB,cAAMC,IAAM,KAAK,UAAU,IAAID,CAAC,KAAK,CAAE;AACvC,QAAAC,EAAI,KAAKF,CAAC,GACV,KAAK,UAAU,IAAIC,GAAGC,CAAG;AAAA,MACjC,CAAO,GACDF,EAAE,IAAI,QAAQ,CAACC,MAAM;AACnB,cAAME,IAAI,KAAK,SAAS,IAAIF,CAAC,KAAK,CAAE;AACpC,QAAAD,EAAE,GAAG,QAAQ,CAAC3B,MAAM8B,EAAE9B,CAAC,IAAI,EAAI,GAC/B,KAAK,SAAS,IAAI4B,GAAGE,CAAC;AAAA,MAC9B,CAAO;AAAA,IACP,CAAK,GACD,KAAK,QAAQ,QAAQ,CAACH,MAAM;AAC1B,MAAAA,EAAE,SAAS,KAAK;AAAA,QACd,GAAGA,EAAE,GAAG,IAAI,CAAC/B,MAAQmC,EAAWnC,GAAK,KAAK,UAAU,CAAC,CAAC;AAAA,MACvD;AAAA,IACP,CAAK,GACD,KAAK,OAAO8B;AAAA,EAChB;AAAA,EACE,KAAKM,GAAK;AACR,UAAMC,IAAO,CAAE;AACf,eAAWrC,KAAOoC;AAChB,UAAI,KAAK,MAAMpC,CAAG,MAAMoC,EAAIpC,CAAG,GAAG;AAChC,cAAMsC,IAAS,KAAK,SAAStC,CAAG;AAChC,QAAAqC,EAAKrC,CAAG,IAAIsC,IAASA,EAAOF,EAAIpC,CAAG,CAAC,IAAIoC,EAAIpC,CAAG;AAAA,MACvD;AAEI,SAAK,QAAQ,KAAK,QAAQ,EAAE,GAAG,KAAK,OAAO,GAAGoC,MAAQ,EAAE,GAAGA,EAAK,GAChE,KAAK,SAASC,CAAI,GACd,KAAK,QAAM,KAAK,KAAK,KAAK,cAAcA,CAAI;AAAA,EACpD;AAAA,EACE,cAAcE,GAAS;AACrB,UAAM1B,IAAU,KAAK,QAAQ0B,GAAS/B,CAAgB;AACtD,WAAI,KAAK,SACP,OAAO,OAAO,KAAK,OAAO,SAASK,CAAO,IAE1C,KAAK,SAAS;AAAA,MACZ,SAAAA;AAAA,MACA,OAAO,WAAW,KAAK,YAAY,KAAK,IAAI,GAAG,CAAC;AAAA,IACjD,GAEIA;AAAA,EACX;AAAA,EACE,cAAc;AACZ,UAAMP,IAAM,KAAK;AACjB,QAAKA,GACL;AAAA,WAAK,SAAS,MACd,KAAK,gBAAgBA,EAAI,SAAS,CAAA,CAAE;AACpC,iBAAWN,KAAOM,EAAI,SAAS;AAC7B,cAAM4B,IAAI5B,EAAI,QAAQN,CAAG;AACzB,QAAIkC,KAAGA,EAAG;AAAA,MAChB;AAAA;AAAA,EACA;AAAA,EACE,SAASK,GAASC,IAAM,IAAI;AAC1B,UAAM3B,IAAU,KAAK,QAAQ0B,CAAO;AACpC,gBAAK,gBAAgB1B,GAAS2B,CAAG,GAC1B3B;AAAA,EACX;AAAA,EACE,gBAAgBA,GAAS2B,GAAK;AAC5B,UAAMC,IAAO,OAAO,KAAK5B,CAAO,GAC1B6B,IAAW,CAACF,EAAI;AACtB,IAAAA,IAAMA,KAAO,CAAE;AACf,aAASpC,IAAI,GAAGA,IAAIqC,EAAK,QAAQrC,KAAK;AACpC,YAAMJ,IAAMyC,EAAKrC,CAAC,GACZuC,IAAO,KAAK,UAAU,IAAI3C,CAAG;AACnC,MAAI2C,KACFA,EAAK,QAAQ,CAACZ,MAAM;AAClB,QAAIS,EAAI,QAAQT,CAAC,KAAK,MACpBS,EAAI,KAAKT,CAAC;AAAA,MAEtB,CAAS;AAAA,IAET;AACI,IAAIW,KACF,KAAK,UAAUF,CAAG;AAAA,EAExB;AAAA,EACE,UAAUA,GAAK;AACb,WAAOA,EAAI,UAAQ;AACjB,MAAAA,EAAI,KAAK,CAACT,GAAGD,MAAMC,EAAE,SAASD,EAAE,SAAS,IAAI,EAAE;AAC/C,YAAMO,IAAOG,EAAIA,EAAI,SAAS,CAAC;AAC/B,MAAAA,EAAI,OAAOA,EAAI,SAAS,CAAC,GACzBH,EAAK,KAAKG,CAAG;AAAA,IACnB;AAAA,EACA;AACA;AACA,SAASL,EAAWnC,GAAK4C,GAASC,GAAM;AACtC,QAAMR,IAAOO,EAAQ,IAAI5C,CAAG;AAC5B,MAAI,CAACqC,EAAM,QAAOQ;AAClB,QAAMC,IAAQ,OAAO,KAAKT,CAAI,EAAE,IAAI,CAACN,MAAMI,EAAWJ,GAAGa,GAASC,IAAO,CAAC,CAAC;AAC3E,SAAO,KAAK,IAAI,GAAGC,CAAK;AAC1B;AAGA,IAAIC,IAAW,MAAM;AAAA,EACnB,cAAc;AACZ,SAAK,eAAe,MACpB,KAAK,YAAY,CAAE,GACnB,KAAK,OAAuB,oBAAI,QAAS,GACzC,KAAK,OAAO,KAAK,KAAK,KAAK,IAAI;AAAA,EACnC;AAAA,EACE,GAAGC,GAAMC,GAASvC,GAAQ;AACxB,QAAImC,IAAO,KAAK,UAAUG,CAAI;AAC9B,IAAKH,IAGCnC,KAAUA,EAAO,YAAWmC,EAAK,QAAQI,CAAO,IAC/CJ,EAAK,KAAKI,CAAO,IAHtBJ,IAAO,KAAK,UAAUG,CAAI,IAAI,CAACC,CAAO,GAKpCvC,KAAUA,EAAO,OAAK,KAAK,KAAK,IAAIuC,GAASvC,EAAO,GAAG;AAAA,EAC/D;AAAA,EACE,UAAUsC,GAAMC,GAASvC,GAAQ;AAC/B,SAAK,GAAGsC,GAAMC,GAAS,EAAE,GAAGvC,GAAQ,WAAW,IAAM;AAAA,EACzD;AAAA,EACE,OAAOwC,GAAK;AACV,eAAWlD,KAAO,KAAK,WAAW;AAChC,YAAMmD,IAAQ,KAAK,UAAUnD,CAAG;AAChC,eAASI,IAAI+C,EAAM,SAAS,GAAG/C,KAAK,GAAGA;AACrC,QAAI,KAAK,KAAK,IAAI+C,EAAM/C,CAAC,CAAC,MAAM8C,KAC9BC,EAAM,OAAO/C,GAAG,CAAC;AAAA,IAG3B;AAAA,EACA;AAAA,EACE,MAAM,KAAK4C,GAAMI,GAAI;AACnB,UAAMD,IAAQ,KAAK,UAAUH,CAAI;AACjC,QAAIG;AACF,eAAS/C,IAAI,GAAGA,IAAI+C,EAAM,QAAQ/C,KAAK;AACrC,cAAMiD,IAAMF,EAAM/C,CAAC,EAAEgD,CAAE;AAEvB,YADIC,MAAQ,MACRA,KAAOA,EAAI,QACA,MAAMA,MACN;AAAO;AAAA,MAE9B;AAEI,WAAI,KAAK,gBAAc,MAAM,KAAK,aAAa,KAAKL,GAAMI,CAAE,GACrDA;AAAA,EACX;AAAA,EACE,QAAQf,GAAM;AACZ,WAAO,KAAK,eAAeA;AAAA,EAC/B;AACA;AC7gBA,SAASiB,EAAUtD,GAA0B;AACrCM,SAAAA,CAAAA,MAAOA,EAAIN,CAAG;AACtB;AACA,SAASuD,EAAUvD,GAA0B;AAC5C,SAAO,CAACM,GAAKL,MAAOK,EAAIN,CAAG,IAAIC;AAChC;AAEgBuD,SAAAA,EAASC,GAAWC,GAAmB;AACtD,UAAQA,EAAIC,UAAUL,EAAUI,EAAIE,EAAE,GAAGH,CAAG;AAC7C;AAEgBI,SAAAA,EAASJ,GAAWC,GAAczD,GAAe;AAChE,UAAQyD,EAAII,UAAUP,EAAUG,EAAIE,EAAE,GAAGH,GAAKxD,CAAC;AAChD;AAEO,SAAS8D,GAAgBC,GAAoB;AAC5CA,SAAAA,EACLC,OAAOlC,CAAKA,MAAA,CAAC,CAACA,EAAEmC,MAAM,EACtBC,IAAIT,CAAOA,MAAA;AACX,QAAIpD,IAAW;AAAA,MACdN,KAAK0D,EAAIE,MAAMhE,EAAI;AAAA,MACnBwE,OAAOV,EAAIW;AAAAA,IACZ;AACA,IAAIX,EAAIY,YAAaA,EAAAA,UAAUZ,EAAIY;AACnC,QAAIJ,IAASR,EAAIQ;AACjB,WAAI,OAAOA,KAAW,eAAYA,IAASA,EAAO,IAC9C,OAAOA,KAAW,YACf5D,IAAA;AAAA,MAAE,GAAGA;AAAAA,MAAK,GAAG4D;AAAAA,IAAO,GAC1B5D,EAAIiE,OAAOL,EAAOM,UACRD,OAAOL,GAEX5D;AAAAA,EAAAA,CACP;AACH;ACnCgBmE,SAAAA,EAASC,GAAWC,GAAkB;AAC/C5C,QAAAA,IAAI6C,SAASC,cAAc,GAAG;AAClCC,EAAAA,EAAAA,OAAOC,IAAIC,gBAAgBN,CAAI,GACjC3C,EAAE0C,WAAWE,GACJM,SAAAA,KAAKC,YAAYnD,CAAC,GAC3BA,EAAEoD,MAAM,GACCF,SAAAA,KAAKG,YAAYrD,CAAC;AAC5B;AAEgBsD,SAAAA,EAAe5B,GAAWC,GAAsB;AAC/D,MAAIzD,IAAIuD,EAASC,GAAKC,CAAG,KAAK;AAC9B,SAAIA,EAAI4B,aAAUrF,IAAIyD,EAAI4B,SAASrF,GAAGwD,GAAKC,CAAG,IAC1CA,EAAI6B,eACHC,MAAMC,QAAQxF,CAAC,IAAOA,IAAAA,EAAEkE,IAAIuB,CAAAA,MAAKhC,EAAI6B,WAAWI,IAAID,CAAC,CAAC,IACjDhC,IAAAA,EAAI6B,WAAWI,IAAI1F,CAAC,IAEvB,OAAOA,IAAM,MAAc,KAAKA,IAAI;AAC5C;AChBgB2F,SAAAA,EAAW9E,GAAuBwD,GAAyB;AAC1E,QAAMuB,IAAM;AACZ,MAAIC,IAAM;AAEJC,QAAAA,IAASzB,EAAQ0B,QAAQ;AAAA,GACzBC,IAAS3B,EAAQ4B,QAAQ,KAEzBA,IAAOpF,EAAMqF,UACbxF,IAAOG,EAAMsF;AAEnB,EAAI9B,EAAQD,WAAW,MAAS6B,EAAK,CAAC,EAAE7B,WACvCyB,IAAMO,EAAa,UAAUH,GAAMJ,GAAKG,GAAQF,CAAM;AAEvD,WAASnE,IAAI,GAAGA,IAAIjB,EAAK2F,QAAQ1E,KAAK;AACrC,UAAM6B,IAAqB,CAAE;AAC7B,aAAS8C,IAAI,GAAGA,IAAIL,EAAKI,QAAQC,KAAK;AACrC,UAAIC,IAAQnB,EAAe1E,EAAKiB,CAAC,GAAGsE,EAAKK,CAAC,CAAC;AAEvCV,MAAAA,EAAIY,KAAKD,CAAK,MAAGA,IAAQ,MAAMA,EAAME,QAAQ,MAAM,IAAI,IAAI,MAE/DjD,EAAIkD,KAAKH,CAAK;AAAA,IAAA;AAEfV,IAAAA,MAAQA,IAAMC,IAAS,MAAMtC,EAAImD,KAAKX,CAAM;AAAA,EAAA;AAG7C,SAAI3B,EAAQuC,WAAW,MAASX,EAAK,CAAC,EAAEW,WACvCf,IAAMO,EAAa,UAAUH,GAAMJ,GAAKG,GAAQF,CAAM,IAEhDD;AACR;AAEA,SAASO,EACR7B,GACA0B,GACAJ,GACAG,GACAF,GACC;AACD,QAAMF,IAAM;AACHjE,WAAAA,IAAI,GAAGA,IAAIsE,EAAK,CAAC,EAAE1B,CAAqB,EAAE8B,QAAQ1E,KAAK;AAC/D,UAAM6B,IAAqB,CAAE;AAC7B,aAAS8C,IAAI,GAAGA,IAAIL,EAAKI,QAAQC,KAAK;AAEjCC,UAAAA,KADWN,EAAKK,CAAC,EAAE/B,CAAqB,EAAE5C,CAAC,EAC3BkF,QAAQ,MAAM;AAC9BjB,MAAAA,EAAIY,KAAKD,CAAK,MAAGA,IAAQ,MAAMA,EAAME,QAAQ,MAAM,IAAI,IAAI,MAC/DjD,EAAIkD,KAAKH,CAAK;AAAA,IAAA;AAEfV,IAAAA,MAAQA,IAAMC,IAAS,MAAMtC,EAAImD,KAAKX,CAAM;AAAA,EAAA;AAEtCH,SAAAA;AACR;ACpCgBiB,SAAAA,EACfjG,GACAwD,GACA0C,GACC;AACD,QAAMC,IAAyB,CAAE,GAC3BC,IAA0B,CAAE,GAC5BC,IAA6B,CAAE;AACrC,MAAIC,IAA6B,CAAE;AACnC,QAAMlB,IAAOpF,EAAMqF,UACbxF,IAAOG,EAAMsF,UACbtD,IAAQhC,EAAMuG;AAETd,aAAAA,KAAKL,EACfiB,CAAAA,EAASR,KAAK;AAAA,IACbW,OAAOf,EAAEgB,WAAWzE,EAAM0E,cAAcjB,EAAEe;AAAAA,EAAAA,CAC1C;AAEF,MAAIG,IAAS;AAEb,EAAInD,EAAQD,WAAW,MAAS6B,EAAK,CAAC,EAAE7B,WACvCqD,EAAe,UAAUxB,GAAMe,GAAOC,GAAQO,GAAQnD,GAAS0C,CAAM,GAErEI,IAAWA,EAASO,OACnB7E,EAAM8E,iBAAiBzD,IAAI0D,CAAWA,OAAA;AAAA,IAAEA,QAAAA;AAAAA,IAAS,CAClD,GACgB3B,KAAAA,EAAK,CAAC,EAAE7B,OAAQiC;AAGjC,WAAS1E,IAAI,GAAGA,IAAIjB,EAAK2F,QAAQ1E,KAAK;AACrC,UAAMkG,IAAyB,CAAE;AACjC,aAASvB,IAAI,GAAGA,IAAIL,EAAKI,QAAQC,KAAK;AAC/B9C,YAAAA,IAAM9C,EAAKiB,CAAC,GACZ8B,IAAMwC,EAAKK,CAAC,GACZC,IAAQhD,EAASC,GAAKC,CAAG,KAAK;AAChCoD,UAAAA,IAAOzB,EAAe5B,GAAKC,CAAG,GAC9BqE;AACJ,MAAIzD,EAAQ0D,cACXD,IAAWzD,EAAQ0D,UAAUxB,GAAO/C,GAAKC,CAAG,IAEzCY,EAAQ2D,iBACXnB,IAAOxC,EAAQ2D,aAAazB,GAAO/C,GAAKC,CAAG,KAAKoD;AAGjD,YAAMoB,IAASC,EAAkBrB,GAAM,GAAGiB,GAAUf,CAAM;AAE1Dc,MAAAA,EAAQnB,KAAKuB,CAAM;AAAA,IAAA;AAGpBjB,IAAAA,EAAMN,KAAKmB,CAAO,GAClBV,EAAST,KAAK;AAAA,MAAEkB,QAAQ/E,EAAMsF;AAAAA,IAAAA,CAAW;AAAA,EAAA;AAE1CX,SAAAA,KAAU9G,EAAK2F,QAEXhC,EAAQuC,WAAW,MAASX,EAAK,CAAC,EAAEW,WACvCa,EAAe,UAAUxB,GAAMe,GAAOC,GAAQO,GAAQnD,GAAS0C,CAAM,GACrEI,IAAWA,EAASO,OACnB7E,EAAMuF,iBAAiBlE,IAAI0D,CAAWA,OAAA;AAAA,IAAEA,QAAAA;AAAAA,IAAS,CAClD,IAEM;AAAA,IAAEZ,OAAAA;AAAAA,IAAOC,QAAAA;AAAAA,IAAQE,UAAAA;AAAAA,IAAUD,UAAAA;AAAAA,IAAUH,QAAAA;AAAAA,EAAO;AACpD;AAEA,SAASU,EACRlD,GACA0B,GACAe,GACAC,GACAO,GACAnD,GACA0C,GACC;AACQpF,WAAAA,IAAI,GAAGA,IAAIsE,EAAK,CAAC,EAAE1B,CAAqB,EAAE8B,QAAQ1E,KAAK;AAC/D,UAAM6B,IAAqB,CAAE;AAC7B,aAAS8C,IAAI,GAAGA,IAAIL,EAAKI,QAAQC,KAAK;AACrC,YAAMlC,IAAS6B,EAAKK,CAAC,EAAE/B,CAAqB,EAAE5C,CAAC,GACzC0G,IAAUjE,EAAOiE,UAAUjE,EAAOiE,UAAU,IAAI,GAChDC,IAAUlE,EAAOkE,UAAUlE,EAAOkE,UAAU,IAAI;AACtD,OAAID,KAAWC,MACdrB,EAAOP,KAAK;AAAA,QACX6B,MAAM;AAAA,UAAE/E,KAAK7B,IAAI6F;AAAAA,UAAQgB,QAAQlC;AAAAA,QAAE;AAAA,QACnCmC,IAAI;AAAA,UAAEjF,KAAK7B,IAAI6F,IAASc;AAAAA,UAASE,QAAQlC,IAAI+B;AAAAA,QAAAA;AAAAA,MAAQ,CACrD;AAGErI,UAAAA,IAAIoE,EAAOyC,QAAQ,IACnBiB;AAEAzD,MAAAA,EAAQqE,oBACXZ,IAAWzD,EAAQqE,gBAAgB1I,GAAGoE,GAAQ6B,EAAKK,CAAC,GAAG/B,CAAI,IAExDF,EAAQsE,uBACX3I,IAAIqE,EAAQsE,mBAAmB3I,GAAGoE,GAAQ6B,EAAKK,CAAC,GAAG/B,CAAI,KAAKvE;AAEzD0B,UAAAA;AACJ,MAAI6C,KAAQ,WACP5C,KAAKsE,EAAK,CAAC,EAAE1B,CAAqB,EAAE8B,SAAS,IAAO3E,IAAA,IAC/CA,IAAA,IACCC,IAAOD,IAAA,IACTA,IAAA;AAET,YAAMuG,IAASC,EAAkBlI,GAAG0B,GAAGoG,GAAUf,CAAM;AACvDvD,MAAAA,EAAIkD,KAAKuB,CAAM;AAAA,IAAA;AAEhBjB,IAAAA,EAAMN,KAAKlD,CAAG;AAAA,EAAA;AAEhB;AAEA,SAAS0E,EACRlI,GACA4I,GACAd,GACAf,GACC;AACD,MAAIrF,IAAIkH;AAMR,MALI5I,KAAKA,aAAa6I,SACrB7I,IAAI8I,EAAa9I,CAAC,GAClB8H,IAAWA,KAAY,CAAC,GACfiB,EAAAA,SAASjB,EAASiB,UAAU,eAElCjB,GAAU;AACF,IAAAA,IAAA;AAAA,MAAE,GAAGf,EAAO6B,CAAS;AAAA,MAAG,GAAGd;AAAAA,IAAS;AAC/C,UAAM3H,IAAI4G,EAAOiC,UAAUC,OAAS/I,EAAO+I,GAAOnB,CAAQ,CAAC;AAC3D,IAAI3H,IAAI,KACP4G,EAAOL,KAAKoB,CAAQ,GACpBpG,IAAIqF,EAAOV,SAAS,KACVlG,IAAAA;AAAAA,EAAAA;AAEL,SAAA;AAAA,IAAEH,GAAGA,IAAI;AAAA,IAAI0B;AAAAA,EAAE;AACvB;AAEO,SAASwH,EAAgBC,GAAgC;AAC/D,QAAMC,IAAY;AAAA,IACjBC,UAAU;AAAA,IACVC,QAAQ;AAAA,IACR,eAAe;AAAA,EAChB,GAEMC,IAAK;AAAA,IACVF,UAAU;AAAA,IACVC,QAAQ;AAAA,IACR,eAAe;AAAA,EAChB,GACME,IAAW;AAAA,IAChBH,UAAU;AAAA,IACVC,QAAQ;AAAA,IACR,eAAe;AAAA,EAChB,GAEMG,IAAS;AAAA,IACdJ,UAAU;AAAA,IACVC,QAAQ;AAAA,IACR,eAAe;AAAA,EAChB,GAEMI,IAAoB;AAAA,IACzBL,UAAU;AAAA,IACVC,QAAQ;AAAA,IACR,eAAe;AAAA,EAChB,GAEMK,IAAQP,EAAUD,CAAI,GACtBS,IAAU,iBAAiBF,EAAkBP,CAAI,GACjDU,IAAQ;AAAA,IACbC,eAAe;AAAA,IACfD,OAAO;AAAA,EACR,GACME,IAAe;AAAA,IACpBC,YAAY;AAAA,IACZL,OAAAA;AAAAA,IACAM,YAAYT,EAASL,CAAI;AAAA,IACzB,GAAGU;AAAAA,IACHK,cAAcN;AAAAA,IACdO,aAAaP;AAAAA,EACd;AAaO7C,SAXQ;AAAA,IACdqD,MAAM;AAAA,MACLT,OAAAA;AAAAA,MACAM,YAAYV,EAAGJ,CAAI;AAAA,MACnBe,cAAcT,EAAON,CAAI;AAAA,MACzBgB,aAAaV,EAAON,CAAI;AAAA,MACxB,GAAGU;AAAAA,IACJ;AAAA,IACAzF,QAAQ;AAAA,MAAE,GAAG2F;AAAAA,IAAa;AAAA,IAC1BnD,QAAQ;AAAA,MAAE,GAAGmD;AAAAA,IAAAA;AAAAA,EACd;AAED;AAEA,SAASjB,EAAauB,GAAoB;AACrC,SAACA,IAEJ,SACCA,EAAKC,QAAAA,IAAYD,EAAKE,kBAAsB,IAAA,QAAU,QAAQ,OAH9C;AAKnB;AC5MA,MAAMC,IAAO,YACPC,IAAM,KACNC,IAAQ,MACRC,KAAS;AAAA,EACdC,IAAI;AAAA,IAAEvD,OAAO;AAAA,IAAMO,QAAQ;AAAA,EAAK;AAAA,EAChCiD,IAAI;AAAA,IAAExD,OAAO;AAAA,IAAMO,QAAQ;AAAA,EAAK;AAAA,EAChCkD,QAAQ;AAAA,IAAEzD,OAAO;AAAA,IAAKO,QAAQ;AAAA,EAAA;AAC/B;AAEgBmD,SAAAA,GACfhH,GACAtD,GACC;AACD,QAAMuK,IAA4B,CAAE;AAEpC,MAAI/E,IAAwB,CAAE,GAC1BoB,IAAgB;AAEpB,QAAM4D,IAAiBlH,EAAQC,OAAOP,CAAOA,MAAA,CAACA,EAAIyH,MAAM,GAElDC,IAAWC,GAAc3K,CAAM;AAEtB4K,SAAAA,EAAAA,QAAQ,CAACrL,GAAGsL,MAAU;AAChCjE,IAAAA,IAAQrH,EAAEqH,SAAS8D,KACtB9D,KAASrH,EAAEqH,OACXpB,EAAKS,KAAK1G,CAAC,MAEPiG,EAAKI,UAAeK,EAAAA,KAAKT,CAAI,GAEjCA,IAAO,CAACjG,CAAC,GACTqH,IAAQrH,EAAEqH,QAGPiE,MAAUL,EAAe5E,SAAS,KAAKJ,EAAKI,UAC/C2E,EAAOtE,KAAKT,CAAI;AAAA,EACjB,CACA,GAEM+E;AACR;AAEgBO,SAAAA,GACfxH,GACAQ,GACAiH,GACwB;AACxB,QAAMvD,IAAgC,CAAE;AAEhCoD,SAAAA,EAAAA,QAAQ,CAAC5H,GAAK6C,MAAM;AACrBlC,UAAAA,IAASX,EAAIc,CAAI;AAEvB,aAAS5C,IAAI,GAAGA,IAAI6J,EAAYnF,QAAQ1E,KAAK;AAC5C,MAAKsG,EAAOtG,CAAC,MAAUA,EAAAA,CAAC,IAAI,CAAE;AAC9B,YAAM8J,IAAQ;AAAA,QAAE,GAAGrH,EAAOzC,CAAC;AAAA,MAAE;AAE7B,UAAIsG,EAAOtG,CAAC,EAAE2E,CAAC,MAAM,MAAM;AAE1B,YAAI,CAACA,KAAK,CAACmF,EAAMnD,WAAW,CAACmD,EAAMpD,SAAS;AAC3C,cAAIA,IAAU,GACVqD,IAAW3H,EAAQuC,IAAI+B,CAAO,EAAE9D,CAAI,EAAE5C,CAAC,GACvC0F,IAAQoE,EAAMpE;AAClB,iBAAO,CAACqE,EAASpD,WAAW,CAACoD,EAASrD;AACrCA,YAAAA,KACAqD,IAAW3H,EAAQuC,IAAI+B,CAAO,EAAE9D,CAAI,EAAE5C,CAAC,GACvC0F,KAASqE,EAASrE;AAEnBoE,UAAAA,EAAMpD,UAAUA,GAChBoD,EAAMpE,QAAQA,GACRO,EAAAA,SAAS4D,EAAY7J,CAAC;AAAA,QAAA;AAI7B,YAFOA,EAAAA,CAAC,EAAE+E,KAAK+E,CAAK,GAEhB,CAACA,EAAME,aAAaF,EAAMpD,UAAU,GAAG;AACtCuD,cAAAA,IAAWH,EAAMpD,UAAU;AAE/B,cAAIoD,EAAMpD,UAAU/B,IAAIvC,EAAQsC,QAAQ;AACvC,kBAAMgC,IACLoD,EAAMpD,WACLoD,EAAMpD,UAAU/B,IAAIvC,EAAQsC;AAE9BoF,YAAAA,EAAMpD,UAAUA,GAChBoD,EAAMpE,QAAQtD,EACZ8H,MAAMvF,GAAGA,IAAIsF,IAAW,CAAC,EACzBE,OAAO,CAAChK,GAAGD,MAAMC,IAAID,EAAEwF,OAAO,CAAC,GAE7BgB,IAAU,MAAGuD,IAAWvD,IAAU;AAAA,UAAA;AAE9B0D,mBAAAA,IAAI,GAAGA,IAAIH,GAAUG,IAAYpK,CAAAA,EAAAA,CAAC,EAAE+E,KAAK,IAAI;AAAA,QAAA;AAEnD+E,YAAAA,EAAMnD,UAAU,GAAG;AACtB,gBAAM0D,IAAWP,EAAMnD;AACvB,mBAASyD,IAAI,GAAGA,IAAIC,GAAUD;AACzB,YAAC9D,EAAOtG,IAAIoK,CAAC,MAAUpK,EAAAA,IAAIoK,CAAC,IAAI,CAAE,IACtC9D,EAAOtG,IAAIoK,CAAC,EAAErF,KAAK,IAAI;AAAA,QACxB;AAAA,MACD;AAAA,IACD;AAGD,QAAIjD,EAAIkI;AACP,eAASxL,IAAI,GAAGA,IAAI8H,EAAO5B,QAAQlG,KAAK;AACjC8L,cAAAA,IAAOhE,EAAO9H,CAAC,GACf+L,IAAcD,EAAK3F,CAAC;AAEtB4F,YAAAA,KAAeA,EAAYP;AAE9B,cADAM,EAAK3F,CAAC,IAAI,MACN,CAACnG,EAAG;AAAA,eACF;AACN,gBAAMgM,IACLD,KACAD,EAAKG,SAAShC,CAAQA,MAAAA,GAAM/B,WAAW,CAAC;AACzC,UAAI8D,MACM9D,EAAAA,UAAU8D,EAAS9D,UAAU,GAC7BhB,EAAAA,QAAQ8E,EAAS9E,QAAQ5D,EAAI4D;AAAAA,QACvC;AAAA,MACD;AAAA,EAEF,CACA,GAEMY,EAAO/D,IAAIV,CAAAA,MAAOA,EAAIQ,OAAOsC,OAAKA,KAAKA,EAAE+B,YAAY,CAAC,CAAC;AAC/D;AAEA,SAAS+C,GAAc3K,GAAsB;AACtC,QAAA;AAAA,IAAEE,MAAAA;AAAAA,IAAM0L,KAAAA;AAAAA,IAAKC,OAAAA;AAAAA,EAAAA,IAAU7L,GACvB;AAAA,IAAE4G,OAAAA;AAAAA,IAAOO,QAAAA;AAAAA,EAAAA,IAAW+C,GAAO2B,CAAK;AAEtC,SAAOC,GAAU5L,MAAS,aAAa0G,IAAQO,GAAQyE,CAAG;AAC3D;AAEA,SAASE,GAAUC,GAAgBH,GAAa;AAC/C,SAAOG,IAASH;AACjB;AAEgBI,SAAAA,GAAqBhM,IAAuB,IAAI;AACzD,QAAA;AAAA,IAAEE,MAAAA;AAAAA,IAAM0L,KAAAA;AAAAA,IAAKC,OAAAA;AAAAA,EAAAA,IAAU7L;AAEtB,SAAA;AAAA,IACNE,MAAMA,KAAQ6J;AAAAA,IACd6B,KAAKA,KAAO5B;AAAAA,IACZ6B,OAAOA,KAAS5B;AAAAA,EACjB;AACD;AAEgBgC,SAAAA,GACftC,GACA7C,GACC;AACD,SAAI6C,EAAK9C,WAAiB,aAAaC,CAAW,kBAC3C,SAAS6C,EAAK/C,KAAK,iBAAiB+C,EAAK/C,KAAK,cAAc+C,EAAKxC,MAAM;AAC/E;AAEgB+E,SAAAA,GACfC,GACA7I,GACAqG,GACC;AACG7D,MAAAA,IAAQqG,EAAaxC,EAAKzG,EAAE;AAChC,MAAIyG,EAAKpG,OAAOO,SAAS,gBAAgBgC,GAAO;AAC/C,UAAMlC,IACL+F,EAAKpG,OAAOvD,QAAQ4D,WACpBN,EAAQ8I,KAAK,CAAC;AAAA,MAAElJ,IAAAA;AAAAA,IAASA,MAAAA,KAAMyG,EAAKzG,EAAE,EAAEU;AACzC,IAAIA,MACKA,IAAAA,EAAQwI,KAAK,CAAC;AAAA,MAAElJ,IAAAA;AAAAA,IAAAA,MAASA,KAAM4C,CAAK,EAAEpC;AAAAA,EAC/C;AAED,SAAOoC,KAAS;AACjB;ACjKA,MAAMuG,IAAkB,CAAC,iBAAiB,eAAe,aAAa,GAChEC,KAAe,CAAC,cAAc,cAAc,aAAa,GACzDC,KAAmB,CAAC,WAAW,GAC/BC,KAAmB,CAAC,iBAAiB,WAAW;AAE/C,MAAMC,GAAe;AAAA,EACnBC,OAAuB,CAAE;AAAA,EACzBC,OAAuB,CAAE;AAAA,EACzBC,WAAiD,CAAC;AAAA,EAClDC;AAAAA,EACAC;AAAAA,EACAC;AAAAA,EACAC,kBAAkC,CAAC;AAAA,EAE3CC,YACCC,GACAC,GACAC,GACC;AACD,SAAKP,KAAKK,GACV,KAAKJ,WAAWK,GAChB,KAAKJ,WAAWK,GAChB,KAAKC,YAAY,GAEjB,KAAKC,kBAAkB;AAAA,EAAA;AAAA,EAGxBC,cAAyE;AACjE,WAAA;AAAA,MACN,WAAW;AAAA,QACVhL,SAASA,CAACG,OACF;AAAA,UACN8K,QAAQ;AAAA,UACRvN,MAAM;AAAA,YAAEiD,IAAIR,EAAGQ;AAAAA,UAAG;AAAA,UAClBuK,QAAQ;AAAA,YAAED,QAAQ;AAAA,YAAWvN,MAAMyC;AAAAA,UAAAA;AAAAA,QACpC;AAAA,MAEF;AAAA,MACA,cAAc;AAAA,QACbH,SAASA,CAACG,MAAyC;AAC5C,gBAAA;AAAA,YAAEQ,IAAAA;AAAAA,UAAAA,IAAOR,GAET;AAAA,YAAEzC,MAAAA;AAAAA,UAAAA,IAAS,KAAKyN,QAAQ,GACxBC,IAAW1N,EAAKsI,UAAUlH,CAAKA,MAAAA,EAAE6B,MAAMA,CAAE;AAExC,iBAAA;AAAA,YACNsK,QAAQ;AAAA,YACRvN,MAAM;AAAA,cACLiD,IAAAA;AAAAA,cACAH,KAAK9C,EAAK0N,CAAQ;AAAA,cAClBC,QACCD,IAAW1N,EAAK2F,SAAS,IACtB3F,EAAK0N,IAAW,CAAC,EAAEzK,KACnB2K;AAAAA,YACL;AAAA,YACAJ,QAAQ;AAAA,cAAED,QAAQ;AAAA,cAAcvN,MAAMyC;AAAAA,YAAAA;AAAAA,UACvC;AAAA,QAAA;AAAA,MAEF;AAAA,MACA,eAAe;AAAA,QACdH,SAASA,CAACG,MAA0C;AAC7C,gBAAA;AAAA,YAAEQ,IAAAA;AAAAA,YAAI6E,QAAAA;AAAAA,UAAAA,IAAWrF,GAEjBK,IAAM,KAAK+K,OAAO5K,CAAE,GACpBF,IAAM,KAAK+K,UAAUhG,CAAM,GAE3BiG,IAAYlL,EAASC,GAAKC,CAAG;AAEnC,iBAAQvD,EAAOuO,GAAWtL,EAAGoD,KAAK,IAM/B,OALA;AAAA,YACA0H,QAAQ;AAAA,YACRvN,MAAM;AAAA,cAAEiD,IAAAA;AAAAA,cAAI6E,QAAAA;AAAAA,cAAQjC,OAAOkI;AAAAA,YAAU;AAAA,YACrCP,QAAQ;AAAA,cAAED,QAAQ;AAAA,cAAevN,MAAMyC;AAAAA,YAAAA;AAAAA,UAAG;AAAA,QAE1C;AAAA,MAEL;AAAA,MACA,cAAc;AAAA,QACbH,SAASA,CAACG,MAAyC;AAC5C,gBAAA;AAAA,YAAEQ,IAAAA;AAAAA,UAAAA,IAAOR,GAETuL,IAAU,KAAKH,OAAO5K,CAAE;AAEvB,iBAAA;AAAA,YACNsK,QAAQ;AAAA,YACRvN,MAAM;AAAA,cAAEiD,IAAAA;AAAAA,cAAIH,KAAKkL;AAAAA,YAAQ;AAAA,YACzBR,QAAQ;AAAA,cAAED,QAAQ;AAAA,cAAcvN,MAAMyC;AAAAA,YAAAA;AAAAA,UACvC;AAAA,QAAA;AAAA,MAEF;AAAA,MACA,iBAAiB;AAAA,QAChBH,SAASA,CAACG,MAA4C;AAC/C,gBAAA;AAAA,YAAEQ,IAAAA;AAAAA,YAAI0D,OAAAA;AAAAA,UAAAA,IAAUlE,GAChBqF,IAAS,KAAKgG,UAAU7K,CAAE,GAC1B;AAAA,YAAEyD,QAAQvE;AAAAA,UAAAA,IAAU,KAAK0K,SAAS;AAEjC,iBAAA;AAAA,YACNU,QAAQ;AAAA,YACRvN,MAAM;AAAA,cAAEiD,IAAAA;AAAAA,cAAI0D,OAAOmB,EAAOnB,SAASxE,EAAM0E;AAAAA,YAAY;AAAA,YACrD2G,QAAQ;AAAA,cACPD,QAAQ;AAAA,cACRvN,MAAM;AAAA,gBAAEiD,IAAAA;AAAAA,gBAAI0D,OAAAA;AAAAA,cAAAA;AAAAA,YAAM;AAAA,UAEpB;AAAA,QAAA;AAAA,MAEF;AAAA,MACA,eAAe;AAAA,QACdrE,SAASA,CAACG,MAA0C;AAC7C,gBAAA;AAAA,YAAEQ,IAAAA;AAAAA,UAAAA,IAAOR,GACTqF,IAAS,KAAKgG,UAAU7K,CAAE;AAEzB,iBAAA;AAAA,YACNsK,QAAQ;AAAA,YACRvN,MAAM;AAAA,cAAEiD,IAAAA;AAAAA,cAAIhD,MAAM6H,EAAO0C;AAAAA,YAAO;AAAA,YAChCgD,QAAQ;AAAA,cACPD,QAAQ;AAAA,cACRvN,MAAMyC;AAAAA,YAAAA;AAAAA,UAER;AAAA,QAAA;AAAA,MAEF;AAAA,MACA,mBAAmB;AAAA,QAClBH,SAASA,CAACG,MAA8C;AACjD,gBAAA;AAAA,YAAEQ,IAAAA;AAAAA,YAAIH,KAAAA;AAAAA,YAAK7C,MAAAA;AAAAA,UAAAA,IAASwC;AAEnB,iBAAA;AAAA,YACN8K,QAAQ;AAAA,YACRvN,MAAM;AAAA,cACLiD,IAAAA;AAAAA,cACAH,KAAAA;AAAAA,cACA7C,MAAM,OAAOA,KAAS,YAAY,CAACA,IAAOA;AAAAA,YAC3C;AAAA,YACAuN,QAAQ;AAAA,cAAED,QAAQ;AAAA,cAAmBvN,MAAMyC;AAAAA,YAAAA;AAAAA,UAC5C;AAAA,QAAA;AAAA,MAEF;AAAA,MACA,aAAa;AAAA,QACZH,SAASA,CAACG,MAAwC;AAC3C,gBAAA;AAAA,YAAEQ,IAAAA;AAAAA,YAAIgL,QAAAA;AAAAA,YAAQhO,MAAAA;AAAAA,UAAAA,IAASwC,GACvB;AAAA,YAAEgD,UAAAA;AAAAA,UAAAA,IAAa,KAAKgI,QAAQ,GAE5BS,IAAczI,EAAS6C,UAAUlH,CAAKA,MAAAA,EAAE6B,MAAMA,CAAE;AAE/C,iBAAA;AAAA,YACNsK,QAAQ;AAAA,YACRvN,MAAM;AAAA,cACLiD,IAAAA;AAAAA,cACAgL,QAAQxI,EACPyI,KAAeA,IAAc,KAAK,EAAE,EACnCjL;AAAAA,cACFhD,MAAMiO,IAAc,UAAU;AAAA,YAC/B;AAAA,YACAV,QAAQ;AAAA,cACPD,QAAQ;AAAA,cACRvN,MAAM;AAAA,gBAAEiD,IAAAA;AAAAA,gBAAIgL,QAAAA;AAAAA,gBAAQhO,MAAAA;AAAAA,cAAAA;AAAAA,YAAK;AAAA,UAE3B;AAAA,QAAA;AAAA,MAEF;AAAA,MACA,YAAY;AAAA,QACXqC,SAASA,CAACG,MAAuC;AAC1C,gBAAA;AAAA,YAAEQ,IAAAA;AAAAA,YAAIkL,QAAAA;AAAAA,UAAAA,IAAW1L;AAChB,iBAAA;AAAA,YACN8K,QAAQ;AAAA,YACRvN,MAAM;AAAA,cAAEiD,IAAAA;AAAAA,cAAIkL,QAAAA;AAAAA,YAAO;AAAA,YACnBX,QAAQ;AAAA,cAAED,QAAQ;AAAA,cAAYvN,MAAMyC;AAAAA,YAAAA;AAAAA,UACrC;AAAA,QAAA;AAAA,MAEF;AAAA,MACA,aAAa;AAAA,QACZH,SAASA,CAACG,MAAwC;AAC3C,gBAAA;AAAA,YAAEQ,IAAAA;AAAAA,YAAIkL,QAAAA;AAAAA,UAAAA,IAAW1L;AAEhB,iBAAA;AAAA,YACN8K,QAAQ;AAAA,YACRvN,MAAM;AAAA,cAAEiD,IAAAA;AAAAA,cAAIkL,QAAAA;AAAAA,YAAO;AAAA,YACnBX,QAAQ;AAAA,cAAED,QAAQ;AAAA,cAAavN,MAAMyC;AAAAA,YAAAA;AAAAA,UACtC;AAAA,QAAA;AAAA,MACD;AAAA,IAEF;AAAA,EAAA;AAAA,EAGD2L,eAAe;AACd,SAAK3B,OAAO,CAAE,GACd,KAAKC,OAAO,CAAE,GACd,KAAKC,WAAW,CAAC,GAEjB,KAAKU,kBAAkB;AAAA,EAAA;AAAA,EAGhBI,UAAU;AACjB,WAAO,KAAKV;AAAAA,EAAAA;AAAAA,EAGLK,cAAc;AACfiB,UAAAA,IAAW,KAAKf,YAAY;AAElC,eAAWC,KAAUc;AACpB,WAAKzB,GAAG0B,UAAUf,GAAsB,CAAC9K,MAAY;AACpD,YACCA,EAAAA,EAAG8L,gBAAgB,UACnB9L,EAAG8L,gBAAgB,UACnB9L,EAAG+L,WAIAjC;AAAAA,cAAAA,GAAiBkC,SAASlB,CAAM,GAAG;AAEpC9K,aAAAA,EAAGiM,cACH,CAAC,KAAK/B,SAASY,CAAoB,KACpC,OAAO9K,EAAGiM,cAAe,eAErBpC,GAAiBmC,SAASlB,CAAM,KACnC,KAAKoB,QAAQ,UAAU,GACpBvC,EAAgBqC,SAASlB,CAAM,KAClC,KAAKoB,QAAQ,SAAS,IAEnBhC,KAAAA,SAASY,CAAoB,IAAI9K,EAAGiM;AACzC;AAAA,UAAA;AAGD,UAAIrC,GAAaoC,SAASlB,CAAM,KAAG,KAAKoB,QAAQ,MAAM,GAClDvC,EAAgBqC,SAASlB,CAAM,KAAG,KAAKoB,QAAQ,SAAS;AAAA;AAAA,MAAA,CAC5D,GAED,KAAK/B,GAAGgC,GAAGrB,GAAsB,CAAC9K,MAAY;AAE5CA,YAAAA,EAAG8L,gBAAgB,UACnB9L,EAAG8L,gBAAgB,UACnB9L,EAAG+L,YACH/L,EAAGiM,WAEH;AAED,cAAMG,IAAeR,EAASd,CAAM,EAAEjL,QAAQG,CAAE;AAC5CoM,QAAAA,KAAmBC,KAAAA,aAAaD,CAAY;AAAA,MAAA,CAChD;AAAA,EACF;AAAA,EAGOF,QAAQI,GAAmB;AACjC,SAAKhC,gBAAwBgC,CAAI,IAAIrP,EAAS,KAAKmN,SAAAA,EAAWkC,CAAI,CAAC;AAAA,EAAA;AAAA,EAG7DD,aAAaE,GAAqB;AACpCvC,SAAAA,KAAKzG,KAAKgJ,CAAK,GACpB,KAAKtC,OAAO,CAAE,GAEd,KAAKuC,gBAAgB;AAAA,EAAA;AAAA,EAGtBC,aAAa;AACR,QAAA,CAAC,KAAKzC,KAAK9G,OAAQ;AAEjB4H,UAAAA,IAAS,KAAKd,KAAK0C,IAAI;AAC7B,SAAKzC,KAAK1G,KAAK;AAAA,MAAE,GAAGuH,EAAOC;AAAAA,MAAQA,QAAQD;AAAAA,IAAAA,CAAQ,GAE9CX,KAAAA,GAAGwC,KAAK7B,EAAOA,QAAQ;AAAA,MAC3B,GAAGA,EAAOvN;AAAAA,MACVuO,aAAa;AAAA,IAAA,CACN,GAER,KAAKU,gBAAgB;AAAA,EAAA;AAAA,EAGtBI,aAAa;AACR,QAAA,CAAC,KAAK3C,KAAK/G,OAAQ;AAEjB4H,UAAAA,IAAS,KAAKb,KAAKyC,IAAI;AAC7B,SAAK1C,KAAKzG,KAAK;AAAA,MAAE,GAAGuH,EAAOC;AAAAA,MAAQA,QAAQD;AAAAA,IAAAA,CAAQ,GAE9CX,KAAAA,GAAGwC,KAAK7B,EAAOA,QAAQ;AAAA,MAC3B,GAAGA,EAAOvN;AAAAA,MACVuO,aAAa;AAAA,IAAA,CACN,GAER,KAAKU,gBAAgB;AAAA,EAAA;AAAA,EAGd5B,oBAAoB;AAC3B,SAAKP,SAAS;AAAA,MAAEwC,SAAS;AAAA,QAAE7C,MAAM;AAAA,QAAGC,MAAM;AAAA,MAAA;AAAA,IAAE,CAAG;AAAA,EAAA;AAAA,EAGxCuC,kBAAkB;AACzB,SAAKnC,SAAS;AAAA,MACbwC,SAAS;AAAA,QACR7C,MAAM,KAAKA,KAAK9G;AAAAA,QAChB+G,MAAM,KAAKA,KAAK/G;AAAAA,MAAAA;AAAAA,IACjB,CACA;AAAA,EAAA;AAAA,EAGMkI,OAAO5K,GAAe;AACvB,UAAA;AAAA,MAAEjD,MAAAA;AAAAA,IAAAA,IAAS,KAAKyN,QAAQ;AAE1B,WAAA,KAAKZ,WAAW0C,OAAa,KAAKC,WAAWxP,GAAMiD,CAAE,IAElDjD,EAAKmM,KAAK/K,CAAKA,MAAAA,EAAE6B,MAAMA,CAAE;AAAA,EAAA;AAAA,EAGzBuM,WAAWxP,GAAciD,GAAe;AAC/C,aAASxD,IAAI,GAAGA,IAAIO,EAAK2F,QAAQlG,KAAK;AACrC,UAAIO,EAAKP,CAAC,EAAEwD,MAAMA,EAAI,QAAOjD,EAAKP,CAAC;AAC/BO,UAAAA,EAAKP,CAAC,EAAEO,MAAM;AACjB,cAAM0C,IAAM,KAAK8M,WAAWxP,EAAKP,CAAC,EAAEO,MAAMiD,CAAE;AAC5C,YAAIP,EAAYA,QAAAA;AAAAA,MAAAA;AAAAA,IACjB;AAEM,WAAA;AAAA,EAAA;AAAA,EAGAoL,UAAU7K,GAAkB;AAC7B,UAAA;AAAA,MAAEI,SAAAA;AAAAA,IAAAA,IAAY,KAAKoK,QAAQ;AACjC,WAAOpK,EAAQ8I,KAAK/K,CAAKA,MAAAA,EAAE6B,MAAMA,CAAE;AAAA,EAAA;AAErC;AC3UO,SAASwM,KAAW;AACnB,SAAA;AAAA,IAAEC,KAAK;AAAA,EAAE;AACjB;AAEO,SAASC,KAAc;AAC7B,MAAIC,IAAY;AAEJ,SAAAA,IAAA,IACNA;AACP;ACNA,SAASC,EAAQzO,GAAeD,GAAuB;AACtD,SAAI,OAAOC,IAAM,OAAeA,MAAM,OAAa,KAC/C,OAAOD,IAAM,OAAeA,MAAM,OAAa,IAC5CC,MAAMD,IAAI,IAAIC,IAAID,IAAI,IAAI;AAClC;AAEA,SAAS2O,GAAS1O,GAAeD,GAAuB;AAChD,SAAA,CAAC0O,EAAQzO,GAAGD,CAAC;AACrB;AAEA,SAAS4O,GAAOC,GAAelI,GAAiB;AACzCmI,QAAAA,IAAaD,MAAU,QAAQH,IAAUC;AACxC,SAAA,SAAU1O,GAAgBD,GAAgB;AACzC8O,WAAAA,EAAWpN,EAASzB,GAAG0G,CAAM,GAAGjF,EAAS1B,GAAG2G,CAAM,CAAC;AAAA,EAC3D;AACD;AAEgBoI,SAAAA,GAAWC,GAA0B9M,GAAoB;AACxE,MAAI,CAAC8M,KAAa,CAACA,EAAUxK,OAAQ;AAErC,QAAMyK,IAAQD,EAAU3M,IAAI6M,CAAAA,MAC3BN,GACCM,EAAKL,OACL3M,EAAQ8I,KAAKvG,OAAKA,EAAE3C,MAAMoN,EAAKhR,GAAG,CACnC,CACD;AACA,SAAI8Q,EAAUxK,WAAW,IAAUyK,EAAM,CAAC,IAEnC,SAAUhP,GAAgBD,GAAgB;AAChD,aAAS1B,IAAI,GAAGA,IAAI2Q,EAAMzK,QAAQlG,KAAK;AACtC,YAAMiD,IAAM0N,EAAM3Q,CAAC,EAAE2B,GAAGD,CAAC;AACrBuB,UAAAA,MAAQ,EAAUA,QAAAA;AAAAA,IAAAA;AAEhB,WAAA;AAAA,EACR;AACD;AC5BA,MAAM4N,IAAmB,IACnBC,KAAiB;AAEhB,SAASC,KAAc;AAEzB,MAAA,OAAOvM,WAAa,IAAoB,QAAA;AAEtCwE,QAAAA,IAAOxE,SAASwM,cAAc,+BAA+B;AAC/D,SAAChI,IAEEA,EAAKiI,UAAUC,UAAU,GAAGlI,EAAKiI,UAAU/K,SAAS,CAAC,IAF1C;AAGnB;AAEA,SAASiL,EACRzK,GACA0K,GACApI,GACAqI,GACAC,GACoC;AAC9BC,QAAAA,IAAY/M,SAASC,cAAc,KAAK,GACxC+M,IAAUhN,SAASC,cAAc,KAAK,GAEtC+J,IAAShK,SAASK;AACZyM,EAAAA,IAAAA,IAAY,GAAGA,CAAS,OAAO;AACvCpK,MAAAA,GACAO;AAEJ+J,EAAAA,EAAQP,YAAYG,GACpBG,EAAUE,UAAUC,IAAI,MAAM1I,CAAI,QAAQ,GAChCF,EAAAA,MAAM6I,UAAU,0EAA0EL,CAAS,wBAE7GC,EAAUzM,YAAY0M,CAAO,GAC7BhD,EAAO1J,YAAYyM,CAAS,GAExB,OAAO7K,KAAQ,aAAUA,IAAO,CAACA,CAAI;AAEzC,WAAS1G,IAAI,GAAGA,IAAI0G,EAAKR,QAAQlG,KAAK;AAC7B4R,IAAAA,EAAAA,YAAYlL,EAAK1G,CAAC,IAAI;AAExB6R,UAAAA,IAAON,EAAUO,sBAAsB,GACvCC,IACLC,KAAKC,KAAKJ,EAAK3K,KAAK,KACnBmK,KAAWA,EAAQnL,SAASmL,EAAQrR,CAAC,IAAI,IACrCkS,IAAaF,KAAKC,KAAKJ,EAAKpK,MAAM;AAExCP,IAAAA,IAAQ8K,KAAKG,IAAIjL,KAAS,GAAG6K,CAAS,GACtCtK,IAASuK,KAAKG,IAAI1K,KAAU,GAAGyK,CAAU;AAAA,EAAA;AAG1CX,SAAAA,EAAUa,OAAO,GAEV;AAAA,IAAElL,OAAAA;AAAAA,IAAOO,QAAAA;AAAAA,EAAO;AACxB;AAEO,SAAS4K,EACfzO,GACA0O,GACAC,GACAC,GACAxJ,GACC;AACD,QAAMxB,IAA6B,CAAE;AAErC,WAASrB,IAAI,GAAGA,IAAIvC,EAAQsC,QAAQC,KAAK;AACxC,UAAMkC,IAASzE,EAAQuC,CAAC,EAAEmM,CAAS,GAC7BpM,IAASmC,EAAOnC;AAEtB,aAAS1E,IAAI,GAAGA,IAAI0E,GAAQ1E,KAAK;AAC1B,YAAA;AAAA,QAAEkF,MAAAA;AAAAA,QAAM+L,UAAAA;AAAAA,QAAUjH,WAAAA;AAAAA,QAAWrD,SAAAA;AAAAA,QAASiJ,KAAAA;AAAAA,MAAAA,IAAQ/I,EAAO7G,CAAC;AAE5D,UAAI,CAACkF,GAAM;AACOlF,QAAAA,EAAAA,CAAC,IAAIwQ,KAAKG,IAC1B3K,EAAiBhG,CAAC,KAAK,GACvBgR,CACD;AACA;AAAA,MAAA;AAGD,UAAI/K,IAAS;AAETgL,UAAAA,KAAY,CAACjH,GAAW;AACvBkH,YAAAA,IAAU,mBAAmBJ,CAAS;AAMrCnK,YALMiJ,KAAAA,IAAM,IAAIA,CAAG,KAAK,IAE7B3J,IAAS0J,EAAYzK,GAAMgM,GAAS1J,CAAI,EAAE9B,QAGrCiB,IAAU,KAAK,CAACE,EAAO7G,IAAI,CAAC,MAAM+Q,IAAY/Q,IAAI,GAAG;AAGnDmR,gBAAAA,IAAQxK,KAAWoK,IAAY/Q,GAC/BoR,IAAapL,EACjBkE,MAAMlK,GAAGA,IAAImR,CAAK,EAClBhH,OAAO,CAACkH,GAAKzM,MAAUyM,IAAMzM,GAAO,CAAC;AAEvC,cAAIwM,IAAanL,GAAQ;AACxB,kBAAMqL,IAAOd,KAAKC,MAAMxK,IAASmL,KAAcD,CAAK;AACpD,qBAAS3S,IAAIwB,GAAGxB,IAAIwB,IAAImR,GAAO3S,IACbA,CAAAA,EAAAA,CAAC,KAChBwH,EAAiBxH,CAAC,KAAKwS,KAAiBM;AAAAA,UAAAA;AAG5C;AAAA,QAAA;AAAA,MACD;AAGgBtR,MAAAA,EAAAA,CAAC,IAAIwQ,KAAKG,IAC1B3K,EAAiBhG,CAAC,KAAKgR,GACvB/K,CACD;AAAA,IAAA;AAAA,EACD;AAGMD,SAAAA;AACR;AAEgBuL,SAAAA,GAAezP,GAAc/C,GAAcyI,GAAc;AACxE,QAAMtC,IAAO,CAAE,GACT2K,IAAU,CAAE;AAElB,MAAID,IAAM;AAEVA,EAAAA,KAAO9N,EAAI8N,MAAM,IAAI9N,EAAI8N,GAAG,KAAK;AAEjC,WAASpR,IAAI,GAAGA,IAAIO,EAAK2F,QAAQlG,KAAK;AAC/BqD,UAAAA,IAAM9C,EAAKP,CAAC,GACZgT,IAAU/N,EAAe5B,GAAKC,CAAG;AAEvC,IAAI0P,MACHtM,EAAKH,KAAKyM,CAAO,GAEb1P,EAAI2P,aACP5B,EAAQ9K,KACPhG,EAAKP,CAAC,EAAEkT,SAASrC,KACftQ,EAAKP,CAAC,EAAEmT,SAAStC,IAAmB,MACpCvN,EAAI8P,YAAYvC,IAAmB,EACtC,IACUvN,EAAI8P,aACd/B,EAAQ9K,KAAKsK,CAAgB;AAAA,EAE/B;AAGD,SAAOM,EAAYzK,GAAM0K,GAAKpI,GAAMqI,CAAO,EAAEnK;AAC9C;AAEgBmM,SAAAA,GAAkBhL,GAAiBW,GAAsB;AACxE,QAAMoI,IAAM,0BACNkC,IAAejL,EAAOkL,OAAOzC,KAAiB;AACpD,MAAI7M,IAASoE,EAAOpE;AAChB,MAAA,OAAOA,KAAW,SACrB,QAAOkN,EAAYlN,GAAQmN,GAAKpI,CAAI,EAAE9B,QAAQoM;AAE3CpM,MAAAA;AAEJ,EAAK9B,MAAMC,QAAQpB,CAAM,MAAGA,IAAS,CAACA,CAAM;AAE5C,WAASjE,IAAI,GAAGA,IAAIiE,EAAOiC,QAAQlG,KAAK;AACjCiK,UAAAA,IAAOhG,EAAOjE,CAAC,GACf0G,IAAO,OAAOuD,KAAS,WAAWA,IAAOA,EAAKvD,MAC9CoC,IAAQsI,KAAO,OAAOnH,KAAS,WAAW,KAAK,IAAIA,EAAKmH,GAAG;AACjE,QAAIoC,IAAYrC,EAAYzK,GAAMoC,GAAOE,CAAI,EAAE9B;AAC/C,IAAIlH,MAAMiE,EAAOiC,SAAS,MAAgBoN,KAAAA,IAE1CpM,IAAQ8K,KAAKG,IAAIjL,KAAS,GAAGsM,CAAS;AAAA,EAAA;AAGhCtM,SAAAA;AACR;ACjLO,MAAMuM,KAAqD;AAAA,EACjE/M,MAAMA,CAAC/E,GAAWD,MACbC,IAAUA,EAAE+R,YAAAA,EAAcC,QAAQjS,EAAEgS,YAAa,CAAA,MAAM,KACpD,CAAChS;AAAAA,EAETkS,YAAYA,CAACjS,GAAoBD,MAC5B,OAAOA,KAAM,YAAY,CAACA,IAAU,KACjCC,KAAKD;AAEd;AAEO,SAASmS,GAAiBzP,GAAmC;AACnE,SAAOqP,GAAgBrP,CAAI;AAC5B;ACqBA,MAAqB0P,WAAkBzT,EAAa;AAAA,EAC5C8M;AAAAA,EACC4G;AAAAA,EACAC;AAAAA,EACAC;AAAAA,EACAC;AAAAA,EAER3G,YAAY4G,GAAqB;AAC1B,UAAA;AAAA,MAAEC,UAAUD;AAAAA,MAAGE,OAAO;AAAA,IAAA,CAAO;AAEnC,UAAMC,IAAe;AAAA,MACpBtM,WAAW;AAAA,MACXZ,aAAa;AAAA,MACbmN,cAAc;AAAA,MACdC,cAAc;AAAA,IACf;AAEA,SAAKT,UAAU,IAAIzS;AAAAA,MAClB,MAAM+L,SAASoH,KAAK,IAAI;AAAA;AAAA,MAExB;AAAA;AAAA,QAEC;AAAA,UACCtH,IAAI,CAAC,WAAW,SAAS,OAAO;AAAA,UAChChN,KAAK,CAAC,YAAY,QAAQ;AAAA,UAC1BwP,MAAMA,CAACvN,MAAqB;AACrB,kBAAA;AAAA,cAAEwB,SAAAA;AAAAA,cAASlB,OAAAA;AAAAA,cAAOgS,OAAAA;AAAAA,YAAAA,IAAU,KAAKtH,SAAS,GAC1CrH,IACL,KAAK4O,YAAY/Q,CAAO,GAEnBgR,IAAiB7O,EAAS4F,OAC/B,CAAChK,GAAGD,MAAMsQ,KAAKG,IAAIzQ,EAAEuC,OAAOiC,QAAQvE,CAAC,GACrC,CACD,GACMkT,IAAiB9O,EAAS4F,OAC/B,CAAChK,GAAGD,MAAMsQ,KAAKG,IAAIzQ,EAAE+E,OAAOP,QAAQvE,CAAC,GACrC,CACD;AAESuJ,YAAAA,EAAAA,QAAQ,KAAK4J,qBAAqB;AAE3C,kBAAM7N,IAAuB,KAAK8N,eACjChP,GACArD,GACAkS,GACAC,GACAH,CACD;AAESxJ,YAAAA,EAAAA,QAAQ,CAAC5H,GAAKtD,MAAM;AAC5B,mBAAKgV,iBACJjP,GACA/F,GACA,UACA4U,GACA3N,CACD,GACA,KAAK+N,iBACJjP,GACA/F,GACA,UACA6U,GACA5N,CACD;AAAA,YAAA,CACA,GAED,KAAKoG,SAAS;AAAA,cAAEtH,UAAAA;AAAAA,cAAUkB,QAAAA;AAAAA,eAAU7E,CAAG;AAAA,UAAA;AAAA,QAEzC;AAAA,QACA;AAAA,UACC+K,IAAI,CAAC,QAAQ,QAAQ,YAAY;AAAA,UACjChN,KAAK,CAAC,UAAU;AAAA,UAChBwP,MAAMA,CAACvN,MAAqB;AACrB,kBAAA;AAAA,cACL7B,MAAAA;AAAAA,cACAuP,MAAAA;AAAAA,cACAmF,YAAYC;AAAAA,YAAAA,IACT,KAAK9H,SAAS,GACZpH,IAAW8J,IACd,KAAKqF,YAAY5U,GAAM,CAAA,GAAI2U,CAAS,IACpC3U,EAAKsD,OACLuR,OAAK,CAACF,KAAaA,EAAUlG,SAASoG,EAAE5R,EAAE,CAC3C;AACF,iBAAK6J,SAAS;AAAA,cAAErH,UAAAA;AAAAA,eAAY5D,CAAG;AAAA,UAAA;AAAA,QAChC;AAAA,MACA;AAAA,MAEF;AAAA;AAAA,QAECM,OAAOA,CAAC7C,OAAoB;AAAA,UAAE,GAAGyU;AAAAA,UAAc,GAAGzU;AAAAA,QAAE;AAAA,MAAA;AAAA,IAEtD;AAEA,UAAMwV,IAAS,KAAKlI,KAAK,IAAIxK,EAAS;AAEhCwM,IAAAA,EAAAA,GACL,gBACA,CAAC;AAAA,MAAEmG,QAAAA;AAAAA,IAAAA,MAAiD;AAC7C,YAAA;AAAA,QAAExR,QAAAA;AAAAA,MAAAA,IAAW,KAAKsJ,SAAS;AACjC,MAAItJ,MACEwR,KACE3F,EAAAA,KAAK,eAAe7L,CAAM,GAEjC,KAAKuJ,SAAS;AAAA,QAAEvJ,QAAQ;AAAA,MAAA,CAAM;AAAA,IAC/B,CAEF,GACMqL,EAAAA,GACL,eACA,CAAC;AAAA,MAAE3L,IAAAA;AAAAA,MAAI6E,QAAAA;AAAAA,IAAAA,MAAgD;AAClDvE,UAAAA,IAAS,KAAKsJ,SAAAA,EAAWtJ;AAC7B,MAAIA,KAAQuR,EAAM1F,KAAK,gBAAgB,CAAA,CAAE;AAEnCtM,YAAAA,IAAM,KAAK+K,OAAO5K,CAAE,GACpBF,IAAM+E,IACT,KAAKgG,UAAUhG,CAAM,IACrB,KAAKkN,cAAclS,CAAG;AAEzB,UAAIC,GAAKQ,QAAQ;AAChB,YAAI0R,IAAelS,EAAIQ;AAGvB,YAFI,OAAO0R,KAAiB,eACZA,IAAAA,EAAanS,GAAKC,CAAG,IACjC,CAACkS,EAAc;AAEV,QAAA1R,IAAA;AAAA,UACRuE,QAAQ/E,EAAIE;AAAAA,UACZA,IAAAA;AAAAA,UACA4C,OAAOhD,EAASC,GAAKC,CAAG,KAAK;AAAA,UAC7BmS,eAAexQ,EAAe5B,GAAKC,CAAG;AAAA,QACvC,GAGC,OAAOkS,KAAiB,YACxBA,EAAalV,WAEbwD,EAAOxD,SAASkV,EAAalV,QACzBkV,EAAalV,OAAO4D,YAChBA,EAAAA,UAAUsR,EAAalV,OAAO4D,WAGnCZ,EAAIY,WAAW,CAACJ,EAAOI,YAC1BJ,EAAOI,UAAUZ,EAAIY,UAEtB,KAAKmJ,SAAS;AAAA,UAAEvJ,QAAAA;AAAAA,QAAAA,CAAQ;AAAA,MAAA;AAAA,IACzB,CAEF,GACMqL,EAAAA,GAAG,UAAU,CAAC;AAAA,MAAE/I,OAAAA;AAAAA,IAAAA,MAA0C;AACzDtC,YAAAA,IAAS,KAAKsJ,SAAAA,EAAWtJ;AAC/B,MAAIA,MACHA,EAAOsC,QAAQA,GACf,KAAKiH,SAAS;AAAA,QAAEvJ,QAAAA;AAAAA,MAAAA,CAAQ;AAAA,IACzB,CACA,GACKqL,EAAAA,GAAG,WAAW,CAACnM,MAAsC;AACpDtC,YAAAA,IAAQ,KAAK0M,SAAS;AACxB,UAAA;AAAA,QAAE7M,MAAAA;AAAAA,MAAAA,IAASG;AACT,YAAA;AAAA,QAAEgV,QAAAA;AAAAA,QAAQT,YAAYC;AAAAA,MAAAA,IAAcxU,GACpC;AAAA,QAAE2C,KAAAA;AAAAA,QAAK6K,QAAAA;AAAAA,QAAQyH,OAAAA;AAAAA,QAAOD,QAAQE;AAAAA,MAAAA,IAAgB5S;AAGpD,UAFAA,EAAGQ,KAAKH,EAAIG,KAAKR,EAAGQ,MAAMH,EAAIG,MAAMhE,EAAI,GAEpC0O,KAAUyH,GAAO;AACpB,cAAMnS,IAAK0K,KAAUyH,GACfxK,IAAQ5K,EAAKsI,UAAUlH,CAAKA,MAAAA,EAAE6B,OAAOA,CAAE;AAC7CjD,QAAAA,EAAKsV,OAAO1K,KAASwK,IAAQ,IAAI,IAAI,GAAG3S,EAAGK,GAAG,GACvC9C,IAAA,CAAC,GAAGA,CAAI;AAAA,MAAA;AAEfA,QAAAA,IAAO,CAAC,GAAGA,GAAMyC,EAAGK,GAAG;AAGxB,YAAMyS,IAAyB;AAAA,QAAEvV,MAAAA;AAAAA,MAAK;AAMtC,MAJI2U,MAAkBD,EAAAA,aAAa,CAAC,GAAGC,GAAWlS,EAAGQ,EAAE,IAEvD,KAAK6J,SAASyI,CAAM,GAEhB,SAAOF,KAAgB,aAAa,CAACA,OACrCA,KAAeF,MACZ/F,EAAAA,KAAK,cAAc;AAAA,QAAEnM,IAAIH,EAAIG;AAAAA,QAAIuS,MAAM;AAAA,MAAA,CAAM;AAAA,IAAA,CACpD,GACK5G,EAAAA,GAAG,cAAc,CAACnM,MAAyC;AAC1D,YAAA;AAAA,QAAEzC,MAAAA;AAAAA,QAAMyV,cAAAA;AAAAA,QAAcC,WAAAA;AAAAA,MAAAA,IAAc,KAAK7I,SAAS,GAClD;AAAA,QAAE5J,IAAAA;AAAAA,MAAAA,IAAOR,GAET8S,IAAyB;AAAA,QAC9BvV,MAAMA,EAAKsD,OAAOlC,CAAKA,MAAAA,EAAE6B,OAAOA,CAAE;AAAA,MACnC;AAEI,MAAA,KAAK0S,WAAW1S,CAAE,MACrBsS,EAAOE,eAAeA,EAAanS,OAAOlC,CAAAA,MAAKA,MAAM6B,CAAE,IAGxD,KAAK6J,SAASyI,CAAM,GAEhBG,GAAW5S,QAAQG,KACjB2J,KAAAA,GAAGwC,KAAK,cAAc;AAAA,QAAEb,aAAa;AAAA,MAAA,CAAc;AAAA,IACzD,CACA,GACKK,EAAAA,GAAG,eAAe,CAACnM,MAA0C;AAC5DtC,YAAAA,IAAQ,KAAK0M,SAAS;AACxB,UAAA;AAAA,QAAE7M,MAAAA;AAAAA,MAAAA,IAASG;AACR,MAAAH,IAAA,CAAC,GAAGA,CAAI;AAET,YAAA;AAAA,QAAEuP,MAAAA;AAAAA,MAAAA,IAASpP,GACX;AAAA,QAAE8C,IAAAA;AAAAA,QAAI6E,QAAAA;AAAAA,QAAQjC,OAAAA;AAAAA,MAAAA,IAAUpD,GAExBM,IAAM,KAAK+K,UAAUhG,CAAM;AAEjC,UAAIyH,GAAM;AACT,cAAM5P,IAAM;AAAA,UAAE,GAAG,KAAK8T,UAAUxQ,CAAE;AAAA,QAAE;AAC3BtD,QAAAA,EAAAA,GAAKoD,GAAK8C,CAAK;AAElB0P,cAAAA,IAAS,KAAKK,cAAcjW,CAAG;AACjCA,QAAAA,EAAIkW,YAAY,MACZN,IAAAA;AAAAA,MACR,OACM;AACN,cAAM3K,IAAQ5K,EAAKsI,UAAUlH,CAAKA,MAAAA,EAAE6B,MAAMA,CAAE,GACtCtD,IAAM;AAAA,UAAE,GAAGK,EAAK4K,CAAK;AAAA,QAAE;AACpBjL,QAAAA,EAAAA,GAAKoD,GAAK8C,CAAK,GAExB7F,EAAK4K,CAAK,IAAIjL;AAAAA,MAAAA;AAGf,WAAKmN,SAAS;AAAA,QAAE9M,MAAAA;AAAAA,MAAAA,CAAM;AAAA,IAAA,CACtB,GACK4O,EAAAA,GAAG,cAAc,CAACnM,MAAyC;AAC5D,UAAA;AAAA,QAAEzC,MAAAA;AAAAA,MAAAA,IAAS,KAAK6M,SAAS;AACvB,YAAA;AAAA,QAAE5J,IAAAA;AAAAA,QAAIH,KAAAA;AAAAA,MAAAA,IAAQL,GAEdmI,IAAQ5K,EAAKsI,UAAUlH,CAAKA,MAAAA,EAAE6B,MAAMA,CAAE;AACrC,MAAAjD,IAAA,CAAC,GAAGA,CAAI,GACfA,EAAK4K,CAAK,IAAI;AAAA,QAAE,GAAG5K,EAAK4K,CAAK;AAAA,QAAG,GAAG9H;AAAAA,MAAI,GACvC,KAAKgK,SAAS;AAAA,QAAE9M,MAAAA;AAAAA,MAAAA,CAAM;AAAA,IAAA,CACtB,GACK4O,EAAAA,GACL,cACA,CAAC;AAAA,MACA3L,IAAAA;AAAAA,MACA6S,QAAAA;AAAAA,MACAC,OAAAA;AAAAA,MACA9V,MAAAA;AAAAA,MACAuV,MAAAA;AAAAA,MACA1N,QAAAA;AAAAA,IAAAA,MACuC;AACjC3H,YAAAA,IAAQ,KAAK0M,SAAS,GACtB;AAAA,QAAE6I,WAAAA;AAAAA,MAAAA,IAAcvV;AAClB,UAAA;AAAA,QAAEsV,cAAAA;AAAAA,MAAAA,IAAiBtV;AAIvB,UAFKsV,EAAa9P,WAAQoQ,IAAQD,IAAS,KAEvCC,GAAO;AACJ,cAAA;AAAA,UAAE/V,MAAAA;AAAAA,QAAAA,IAAS,KAAK6M,SAAS;AAE3BmJ,YAAAA,IAAShW,EAAKsI,UACjBlH,CAAKA,MAAAA,EAAE6B,MAAMwS,EAAaA,EAAa9P,SAAS,CAAC,CAClD,GACIsQ,IAASjW,EAAKsI,UAAUlH,CAAKA,MAAAA,EAAE6B,MAAMA,CAAE;AACvC+S,QAAAA,IAASC,MAASD,CAAAA,GAAQC,CAAM,IAAI,CAACA,GAAQD,CAAM,IAEvDhW,EAAKmL,MAAM6K,GAAQC,IAAS,CAAC,EAAEtL,QAAQvJ,CAAKA,MAAA;AACvCqU,UAAAA,EAAarC,QAAQhS,EAAE6B,EAAE,MAAM,MAClCwS,EAAazP,KAAK5E,EAAE6B,EAAE;AAAA,QAAA,CACvB;AAAA,MACS6S,WAAAA,KAAU,KAAKH,WAAW1S,CAAE,GAAG;AACzC,YAAIhD,MAAS,GAAM;AACnBwV,QAAAA,IAAeA,EAAanS,OAAOlC,CAAKA,MAAAA,MAAM6B,CAAE;AAAA,MAAA,WAE5C6S,GAAQ;AACX,YAAI7V,MAAS,GAAO;AACpBwV,QAAAA,EAAazP,KAAK/C,CAAE;AAAA,MAAA,MACC,CAAAwS,IAAA,CAACxS,CAAE;AAG1B,WAAK6J,SAAS;AAAA,QAAE2I,cAAAA;AAAAA,MAAAA,CAAc,GAE1BC,GAAW5S,QAAQG,KACjB2J,KAAAA,GAAGwC,KAAK,cAAc;AAAA,QAAEb,aAAa;AAAA,MAAA,CAAc,GAErDiH,KAAM,KAAK5I,GAAGwC,KAAK,UAAU;AAAA,QAAEtM,KAAKG;AAAAA,QAAI6E,QAAAA;AAAAA,MAAAA,CAAQ;AAAA,IAAA,CAEtD,GACA,KAAK8E,GAAGgC,GAAG,cAAc,CAACnM,MAAyC;AAC5D,YAAA;AAAA,QAAEK,KAAAA;AAAAA,QAAKgF,QAAAA;AAAAA,QAAQyG,aAAAA;AAAAA,MAAAA,IAAgB9L,GAC/B;AAAA,QAAE+C,UAAAA;AAAAA,QAAU0Q,OAAAA;AAAAA,MAAAA,IAAU,KAAKrJ,SAAS;AAE1C,MAAI/J,KAAOgF,KACV,KAAKgF,SAAS;AAAA,QAAE4I,WAAW;AAAA,UAAE5S,KAAAA;AAAAA,UAAKgF,QAAAA;AAAAA,QAAAA;AAAAA,MAAO,CAAG,GACxCyG,MAAgB,aAEjB,CAAC2H,EAAM/W,QACPqG,EAAS8C,UAAUlH,CAAKA,MAAAA,EAAE6B,MAAMR,EAAGqF,MAAM,KACxCoO,EAAM/W,UACP,CAAC+W,EAAM9W,SACPoG,EAAS8C,UAAUlH,CAAAA,MAAKA,EAAE6B,MAAMR,EAAGqF,MAAM,IACxCtC,EAASG,SAASuQ,EAAM9W,SAErBwN,KAAAA,GAAGwC,KAAK,UAAU;AAAA,QAAEtM,KAAAA;AAAAA,QAAKgF,QAAAA;AAAAA,MAAAA,CAAQ,IAChC,KAAK8E,GAAGwC,KAAK,UAAU;AAAA,QAAEtM,KAAAA;AAAAA,MAAAA,CAAK,WAE3BgK,SAAS;AAAA,QAAE4I,WAAW;AAAA,MAAA,CAAM;AAAA,IAAA,CACxC,GACK9G,EAAAA,GAAG,iBAAiB,CAACnM,MAA4C;AAChE,YAAA;AAAA,QAAEQ,IAAAA;AAAAA,QAAIkT,MAAAA;AAAAA,QAAMC,SAAAA;AAAAA,QAAS1H,YAAAA;AAAAA,MAAAA,IAAejM;AAC1C,UAAIiM,MAAe;AAElB;AAEG/H,UAAAA,IAAQlE,EAAGkE,SAAS;AACxB,YAAMtD,IAAU,CAAC,GAAG,KAAKwJ,SAAAA,EAAWxJ,OAAO,GACrCyE,IAASzE,EAAQ8I,KAAK/K,CAAKA,MAAAA,EAAE6B,MAAMA,CAAE;AAE3C,UAAIkT,GAAM;AACLA,YAAAA,KAAQ,UAAUA,MAAS,IAAM;AAC9B,gBAAA;AAAA,YAAE1Q,UAAAA;AAAAA,YAAU0O,OAAAA;AAAAA,UAAAA,IAAU,KAAKtH,SAAS;AAC1C,cAAI+E,IAAMnM,EAASE;AAEnB,UAAIyQ,MAASxE,IAAMH,KAAK4E,IAAID,GAASxE,CAAG;AAExC,gBAAM0E,IAAU7Q,EAAS0F,MAAM,GAAGyG,CAAG;AAC7BY,UAAAA,IAAAA,GAAe1K,GAAQwO,GAASnC,CAAK;AAAA,QAAA;AAG1CgC,YAAAA,KAAQ,YAAYA,MAAS,IAAM;AAChC,gBAAA;AAAA,YAAEhC,OAAAA;AAAAA,UAAAA,IAAU,KAAKtH,SAAS;AAEhClG,UAAAA,IAAQ8K,KAAKG,IAAIkB,GAAkBhL,GAAQqM,CAAK,GAAGxN,CAAK;AAAA,QAAA;AAAA,MACzD;AAGDmB,MAAAA,EAAOnB,QAAQ8K,KAAKG,IAAI,IAAIjL,CAAK,GACjC,OAAOmB,EAAOlB,UACd,KAAKkG,SAAS;AAAA,QAAEzJ,SAAAA;AAAAA,MAAAA,CAAS;AAAA,IAAA,CACzB,GACKuL,EAAAA,GAAG,eAAe,CAACnM,MAA0C;AAC5D,YAAA;AAAA,QAAEQ,IAAAA;AAAAA,QAAIhD,MAAAA;AAAAA,MAAAA,IAASwC,GACfY,IAAU,CAAC,GAAG,KAAKwJ,SAAAA,EAAWxJ,OAAO,GACrCyE,IAASzE,EAAQ8I,KAAK/K,CAAKA,MAAAA,EAAE6B,MAAMA,CAAE,GACrCsH,IAAiBlH,EAAQ+H,OAC9B,CAAClK,GAAG5B,MAAM4B,KAAK5B,EAAEkL,SAAS,IAAI,IAC9B,CACD;AACI,MAAA,CAACvK,KAAQsK,IAAiB,KACtBC,EAAAA,SAAS,CAAC1C,EAAO0C,QACxB,KAAKsC,SAAS;AAAA,QAAEzJ,SAAAA;AAAAA,MAAAA,CAAS,OAChBmL,WAAW;AAAA,IAAA,CACrB,GACKI,EAAAA,GAAG,aAAa,CAACnM,MAAwC;AACxD,YAAA;AAAA,QAAEpD,KAAAA;AAAAA,QAAK8R,KAAAA;AAAAA,MAAAA,IAAQ1O;AACjB,UAAA;AAAA,QAAEuN,OAAAA,IAAQ;AAAA,MAAA,IAAUvN;AAElBtC,YAAAA,IAAQ,KAAK0M,SAAS;AAC5B,UAAI0J,IAAYpW,EAAMoW;AAChB,YAAA;AAAA,QAAElT,SAAAA;AAAAA,QAASrD,MAAAA;AAAAA,QAAMuP,MAAAA;AAAAA,MAAAA,IAASpP,GAC1BqW,IAASC,OAAO3U,KAAKyU,CAAS,GAC9BG,IAAUF,EAAO7Q;AAEnB4Q,MAAAA,EAAUlX,CAAG,MAChB2Q,IAAQuG,EAAUlX,CAAG,EAAE2Q,UAAU,QAAQ,SAAS,QAE/C,CAACmB,KAAO,CAACuF,KAAYA,MAAY,KAAKH,EAAUlX,CAAG,IAC1CkX,IAAA;AAAA,QAAE,CAAClX,CAAG,GAAG;AAAA,UAAE2Q,OAAAA;AAAAA,QAAAA;AAAAA,MAAQ,KAE3B0G,MAAY,MAELF,EAAAA,EAAO,CAAC,CAAC,IAAI;AAAA,QACtB,GAAGD,EAAUC,EAAO,CAAC,CAAC;AAAA,QACtB5L,OAAO;AAAA,MACR,IAEW2L,IAAA;AAAA,QACX,GAAGA;AAAAA,QACH,CAAClX,CAAG,GAAG;AAAA,UACN2Q,OAAAA;AAAAA,UACApF,OAAO2L,EAAUlX,CAAG,GAAGuL,SAAS8L;AAAAA,QAAAA;AAAAA,MAElC;AAGD,YAAMC,IAAUF,OAAO3U,KAAKyU,CAAS,EACnCvD,KAAK,CAAC5R,GAAGD,MAAMoV,EAAUnV,CAAC,EAAEwJ,QAAQ2L,EAAUpV,CAAC,EAAEyJ,KAAK,EACtDpH,IAAInC,CAAMA,OAAA;AAAA,QAAEhC,KAAKgC;AAAAA,QAAG2O,OAAOuG,EAAUlV,CAAC,EAAE2O;AAAAA,MAAAA,EAAQ;AAElD,WAAKlD,SAAS;AAAA,QAAEyJ,WAAAA;AAAAA,MAAAA,CAAW;AAErBK,YAAAA,IAAS1G,GAAWyG,GAAStT,CAAO;AAC1C,UAAIuT,GAAQ;AACLC,cAAAA,IAAW,CAAC,GAAG7W,CAAI;AAEzB,QAAIuP,IACEuH,KAAAA,SAASD,GAAUD,CAAM,IACf5D,EAAAA,KAAK4D,CAAM,GAE3B,KAAK9J,SAAS;AAAA,UAAE9M,MAAM6W;AAAAA,QAAAA,CAAU;AAAA,MAAA;AAAA,IACjC,CACA,GAEKjI,EAAAA,GAAG,eAAe,CAACnM,MAA0C;AAC5D,YAAA;AAAA,QAAEoD,OAAAA;AAAAA,QAAOxG,KAAAA;AAAAA,QAAKiE,QAAAA;AAAAA,MAAAA,IAAWb;AAG/B,UAAI,CAACgU,OAAO3U,KAAKW,CAAE,EAAEkD,QAAQ;AAC5B,aAAKmH,SAAS;AAAA,UAAEZ,cAAc,CAAC;AAAA,UAAGwI,YAAY;AAAA,QAAA,CAAM;AACpD;AAAA,MAAA;AAGKvU,YAAAA,IAAQ,KAAK0M,SAAS,GACtB;AAAA,QAAE7M,MAAAA;AAAAA,QAAMuP,MAAAA;AAAAA,MAAAA,IAASpP;AACvB,UAAI+L,IAAe/L,EAAM+L;AAEzB,YAAMqJ,IAAyB,CAAC;AAChC,MAAIlW,MACY6M,IAAA;AAAA,QACd,GAAGA;AAAAA,QACH,CAAC7M,CAAG,GAAGwG;AAAAA,MACR,GACA0P,EAAOrJ,eAAeA;AAGvB,YAAM6K,IAAWzT,KAAU,KAAK0T,aAAa9K,CAAY;AAEzD,UAAIyI,IAAmB,CAAE;AACzB,MAAIpF,IACHoF,IAAY,KAAKsC,WAAWjX,GAAM+W,GAAUpC,CAAS,IAEhDhK,EAAAA,QAAQkK,CAAKA,MAAA;AACjB,QAAIkC,EAASlC,CAAC,KAAa7O,EAAAA,KAAK6O,EAAE5R,EAAE;AAAA,MAAA,CACpC,GACFsS,EAAOb,aAAaC,GAEpB,KAAK7H,SAASyI,CAAM;AAAA,IAAA,CACpB,GAEK3G,EAAAA,GACL,mBACA,CAACnM,MAA8C;AACxC,YAAA;AAAA,QAAEQ,IAAAA;AAAAA,QAAIH,KAAAA;AAAAA,QAAK7C,MAAAA;AAAAA,MAAAA,IAASwC,GACpBY,IAAU,CAAC,GAAG,KAAKwJ,SAAAA,EAAWxJ,OAAO,GACrCK,IAAS,KAAKoK,UAAU7K,CAAE,EAAES,QAC5BgG,IAAO7E,MAAMC,QAAQpB,CAAM,IAAIA,EAAOZ,CAAG,IAAIY;AAE/C,MAAA,OAAOgG,KAAS,aACduB,EAAAA,YAAYhL,KAAQ,CAACyJ,EAAKuB,WAC/B,KAAK6B,SAAS;AAAA,QAAEzJ,SAAAA;AAAAA,MAAAA,CAAS;AAAA,IAC1B,CAEF,GAEMuL,EAAAA,GAAG,aAAa,CAACnM,MAAwC;AACxD,YAAA;AAAA,QAAEQ,IAAAA;AAAAA,QAAIgL,QAAAA;AAAAA,QAAQhO,MAAAA,IAAO;AAAA,QAASyO,YAAAA;AAAAA,MAAAA,IAAejM,GAC7C;AAAA,QAAEzC,MAAAA;AAAAA,QAAMyF,UAAAA;AAAAA,QAAU8J,MAAAA;AAAAA,MAAAA,IAAS,KAAK1C,SAAS,GACzCqB,IAAczI,EAAS6C,UAAUlH,CAAKA,MAAAA,EAAE6B,MAAMA,CAAE,GAChDiU,IAAczR,EAAS6C,UAAUlH,CAAKA,MAAAA,EAAE6B,MAAMgL,CAAM;AAE1D,UACCC,MAAgB,MAChBgJ,MAAgB,MAChBxI,MAAe;AAGf;AAGGyI,UAAAA;AACJ,MAAI5H,IAEH4H,IAAc,KAAKC,SAASnU,GAAIgL,GAAQjO,GAAMC,CAAI,IAElDkX,IAAc,KAAKC,SAASnU,GAAIgL,GAAQjO,GAAMC,CAAI,GAGnD,KAAK6M,SAAS;AAAA,QACb9M,MAAMuP,IAAO,KAAK8H,kBAAkBF,CAAW,IAAIA;AAAAA,MAAAA,CACnD;AAAA,IAAA,CACD,GAEKvI,EAAAA,GAAG,YAAY,CAACnM,MAAuC;AACtD,YAAA;AAAA,QAAEQ,IAAAA;AAAAA,QAAIkL,QAAAA;AAAAA,MAAAA,IAAW1L;AAClB6U,WAAAA,aAAarU,GAAI,IAAMkL,CAAM;AAAA,IAAA,CAClC,GAEKS,EAAAA,GAAG,aAAa,CAACnM,MAAwC;AACxD,YAAA;AAAA,QAAEQ,IAAAA;AAAAA,QAAIkL,QAAAA;AAAAA,MAAAA,IAAW1L;AAClB6U,WAAAA,aAAarU,GAAI,IAAOkL,CAAM;AAAA,IAAA,CACnC,GAEKS,EAAAA,GAAG,UAAU,CAACnM,MACZ,IAAI8U,QAAQ,CAACC,GAASC,MAAW;AACjC9T,YAAAA,IAAUlB,EAAGkB,WAAW,CAAC,GAEzBK,IAAW,GAAGL,EAAQ+T,YAAY,MAAM,IAAI/T,EAAQ0E,MAAM;AAE5D1E,UAAAA,EAAQ0E,UAAU,OAAO;AAC5B,cAAMlD,IAAMF,EAAW,KAAK4H,SAAAA,GAAYlJ,CAAO;AAC3CA,QAAAA,EAAQG,aAAa,KACxBA,EACC,IAAI6T,KAAK,CAAC,WAAWxS,CAAG,GAAG;AAAA,UAAEtB,MAAM;AAAA,QAAY,CAAA,GAC/CG,CACD,MACOuD,SAASpC,GACjBqS,EAAQ,EAAI;AAAA,MAAA,WACF7T,EAAQ0E,UAAU,QAAQ;AAEpC,YAAIuP,IAAWjU,EAAQ0C;AACnB,QAAA,CAACuR,KAAYA,MAAa,OAC7BA,IAAWpP,EAAgB,KAAKqE,SAAS,EAAEsH,KAAK;AAEjD,cAAM9N,IAASuR,GACTC,IAAYxR,IACf,CACA;AAAA,UAAE,GAAGA,EAAO3C;AAAAA,QAAAA,GACZ;AAAA,UAAE,GAAI2C,EAAOyR,kBAAkBzR,EAAO3C;AAAAA,QAAAA,GACtC;AAAA,UAAE,GAAG2C,EAAOqD;AAAAA,QAAAA,GACZ;AAAA,UACC,GAAIrD,EAAO0R,mBACV1R,EAAOH;AAAAA,QAAAA,GAET;AAAA,UAAE,GAAGG,EAAOH;AAAAA,QAAQ,CAAA,IAEpBrB,MAAM,CAAC,EAAEmT,KAAK,CAAA,CAAE,GAGb;AAAA,UACL1R,OAAAA;AAAAA,UACAC,QAAAA;AAAAA,UACAE,UAAAA;AAAAA,UACAD,UAAAA;AAAAA,UACAH,QAAQ4R;AAAAA,YACL7R,EAAa,KAAKyG,SAAS,GAAGlJ,GAASkU,CAAS,GAE9CK,IACLvU,EAAQwU,OACR;AAGDC,QAFmB,KAAKC,cAAcH,CAAI,EAE/BI,KAAKvT,CAAKA,MAAA;AAClBwT,UAAAA,EAAAA,YAAY,CAACC,MAAW;AACrBA,gBAAAA,EAAExY,KAAK6D,QAAQ,SAAS;AACrBE,oBAAAA,IAAOyU,EAAExY,KAAK+D;AACpB,cAAIJ,EAAQG,aAAa,KACxBA,EAASC,GAAMC,CAAQ,MAChBuD,SAASxD,GACjByT,EAAQ,EAAI;AAAA,YAAA;AAAA,UAEd,GAEAzS,EAAE0T,YAAY;AAAA,YACb5U,MAAM;AAAA,YACN7D,MAAM;AAAA,cACLA,MAAM,CACL;AAAA,gBACCqC,MAAMsB,EAAQ+U,aAAa;AAAA,gBAC3BpS,OAAAA;AAAAA,gBACAf,MAAMiB;AAAAA,gBACNnB,MAAMoB;AAAAA,gBACNF,QAAAA;AAAAA,cAAAA,CACA;AAAA,cAEFF,QAAQ4R;AAAAA,YAAAA;AAAAA,UACT,CACA;AAAA,QAAA,CACD;AAAA,YACY,CAAAR,EAAA;AAAA,IAAA,CACd,CACD,GACG7I,EAAAA,GACH,UACA,CAAC;AAAA,MAAEvP,KAAAA;AAAAA,MAAKsZ,OAAAA;AAAAA,MAAOC,SAAAA;AAAAA,IAAAA,MAA4C;AAC1D,cAAQvZ,GAAG;AAAA,QACV,KAAK,WAAW;AACT,gBAAA;AAAA,YACLoG,UAAUzF;AAAAA,YACV0V,WAAAA;AAAAA,YACAP,QAAAA;AAAAA,UAAAA,IACG,KAAKtI,SAAS;AAElB,cADA8L,EAAME,eAAe,GACjBD,EAAS;AAEb,gBAAME,IAAQpD,IACXA,EAAU5N,SACV,KAAKiR,0BAA0B9V,IAC5B+V,IAAQtD,IACX,KAAKuD,WAAWvD,EAAU5S,GAAG,GAAGG,KAChCjD,EAAKA,EAAK2F,SAAS,CAAC,GAAG1C;AAC1B,UAAI6V,KAASE,MACPpM,KAAAA,GAAGwC,KAAK,cAAc;AAAA,YAC1BtM,KAAKkW;AAAAA,YACLlR,QAAQgR;AAAAA,YACRvK,aAAa;AAAA,UAAA,CACb,GACG4G,KACH,KAAKvI,GAAGwC,KAAK,cAAc;AAAA,YAAEnM,IAAI+V;AAAAA,UAAAA,CAAO;AAE1C;AAAA,QAAA;AAAA,QAED,KAAK,aAAa;AACX,gBAAA;AAAA,YACLvT,UAAUzF;AAAAA,YACV0V,WAAAA;AAAAA,YACAP,QAAAA;AAAAA,UAAAA,IACG,KAAKtI,SAAS;AAElB,cADA8L,EAAME,eAAe,GACjBD,EAAS;AAEb,gBAAME,IAAQpD,IACXA,EAAU5N,SACV,KAAKiR,0BAA0B9V,IAC5B+V,IAAQtD,IACX,KAAKwD,WAAWxD,EAAU5S,GAAG,GAAGG,KAChCjD,EAAK,CAAC,GAAGiD;AACZ,UAAI6V,KAASE,MACPpM,KAAAA,GAAGwC,KAAK,cAAc;AAAA,YAC1BtM,KAAKkW;AAAAA,YACLlR,QAAQgR;AAAAA,YACRvK,aAAa;AAAA,UAAA,CACb,GACG4G,KACH,KAAKvI,GAAGwC,KAAK,cAAc;AAAA,YAAEnM,IAAI+V;AAAAA,UAAAA,CAAO;AAE1C;AAAA,QAAA;AAAA,QAED,KAAK,cAAc;AACZ,gBAAA;AAAA,YAAEtD,WAAAA;AAAAA,UAAAA,IAAc,KAAK7I,SAAS;AACpC,cAAI+L,EAAS;AAGb,cADAD,EAAME,eAAe,GACjBnD,GAAW;AACd,kBAAMoD,IAAQ,KAAKK,cAClBzD,EAAU5N,QACV,EACD,GAAG7E;AACH,YAAI6V,KACElM,KAAAA,GAAGwC,KAAK,cAAc;AAAA,cAC1BtM,KAAK4S,EAAU5S;AAAAA,cACfgF,QAAQgR;AAAAA,cACRvK,aAAa;AAAA,YAAA,CACb;AAAA,UACF;AAED;AAAA,QAAA;AAAA,QAED,KAAK,aAAa;AACX,gBAAA;AAAA,YAAEmH,WAAAA;AAAAA,UAAAA,IAAc,KAAK7I,SAAS;AACpC,cAAI+L,EAAS;AAGb,cADAD,EAAME,eAAe,GACjBnD,GAAW;AACd,kBAAMoD,IAAQ,KAAKM,cAClB1D,EAAU5N,QACV,EACD,GAAG7E;AACH,YAAI6V,KACElM,KAAAA,GAAGwC,KAAK,cAAc;AAAA,cAC1BtM,KAAK4S,EAAU5S;AAAAA,cACfgF,QAAQgR;AAAAA,cACRvK,aAAa;AAAA,YAAA,CACb;AAAA,UACF;AAED;AAAA,QAAA;AAAA,QAED,KAAK,OAAO;AACL,gBAAA;AAAA,YAAEhL,QAAAA;AAAAA,YAAQmS,WAAAA;AAAAA,YAAWP,QAAAA;AAAAA,UAAAA,IAAW,KAAKtI,SAAS;AACpD,cAAItJ,GAAQ;AACXoV,YAAAA,EAAME,eAAe;AAErB,kBAAM/Q,IAASvE,EAAOuE;AACtB,gBAAI7E,IAAKM,EAAON,IACZF,IAAM,KAAKiS,cACd,KAAKnH,OAAO5K,CAAE,GACd,KAAK6K,UAAUhG,CAAM,CACtB;AACA,gBAAI,CAAC/E,GAAK;AACHD,oBAAAA,IAAM,KAAKoW,WAAWjW,CAAE;AAC9B,cAAIH,MACHG,IAAKH,EAAIG,IACHF,IAAA,KAAKiS,cAAclS,CAAG;AAAA,YAC7B;AAGD,YAAIC,MACE6J,KAAAA,GAAGwC,KAAK,eAAe;AAAA,cAC3BnM,IAAAA;AAAAA,cACA6E,QAAQ/E,EAAIE;AAAAA,YAAAA,CACZ,GACI2J,KAAAA,GAAGwC,KAAK,cAAc;AAAA,cAC1BtM,KAAKG;AAAAA,cACL6E,QAAQ/E,EAAIE;AAAAA,cACZsL,aAAa;AAAA,YAAA,CACb,GACG4G,KAAU,CAAC,KAAKQ,WAAW1S,CAAE,KAChC,KAAK2J,GAAGwC,KAAK,cAAc;AAAA,cAAEnM,IAAAA;AAAAA,YAAAA,CAAI;AAAA,iBAEzByS,KACL9I,KAAAA,GAAGwC,KAAK,cAAc;AAAA,YAAEb,aAAa;AAAA,UAAA,CAAO;AAElD;AAAA,QAAA;AAAA,QAED,KAAK,aAAa;AACX,gBAAA;AAAA,YAAEhL,QAAAA;AAAAA,YAAQmS,WAAAA;AAAAA,YAAWP,QAAAA;AAAAA,UAAAA,IAAW,KAAKtI,SAAS;AACpD,cAAItJ,GAAQ;AACXoV,YAAAA,EAAME,eAAe;AAErB,kBAAM/Q,IAASvE,EAAOuE;AACtB,gBAAI7E,IAAKM,EAAON,IACZF,IAAM,KAAKsW,cACd,KAAKxL,OAAO5K,CAAE,GACd,KAAK6K,UAAUhG,CAAM,CACtB;AACA,gBAAI,CAAC/E,GAAK;AACHD,oBAAAA,IAAM,KAAKmW,WAAWhW,CAAE;AAC9B,cAAIH,MACHG,IAAKH,EAAIG,IACHF,IAAA,KAAKsW,cAAcvW,CAAG;AAAA,YAC7B;AAGD,YAAIC,MACE6J,KAAAA,GAAGwC,KAAK,eAAe;AAAA,cAC3BnM,IAAAA;AAAAA,cACA6E,QAAQ/E,EAAIE;AAAAA,YAAAA,CACZ,GACI2J,KAAAA,GAAGwC,KAAK,cAAc;AAAA,cAC1BtM,KAAKG;AAAAA,cACL6E,QAAQ/E,EAAIE;AAAAA,cACZsL,aAAa;AAAA,YAAA,CACb,GACG4G,KAAU,CAAC,KAAKQ,WAAW1S,CAAE,KAChC,KAAK2J,GAAGwC,KAAK,cAAc;AAAA,cAAEnM,IAAAA;AAAAA,YAAAA,CAAI;AAAA,iBAEzByS,KACL9I,KAAAA,GAAGwC,KAAK,cAAc;AAAA,YAAEb,aAAa;AAAA,UAAA,CAAO;AAElD;AAAA,QAAA;AAAA,QAED,KAAK,UAAU;AACR,gBAAA;AAAA,YAAEhL,QAAAA;AAAAA,UAAAA,IAAW,KAAKsJ,SAAS;AACjC,UAAItJ,MACEqJ,KAAAA,GAAGwC,KAAK,gBAAgB;AAAA,YAAE2F,QAAQ;AAAA,UAAA,CAAM,GACxCnI,KAAAA,GAAGwC,KAAK,cAAc;AAAA,YAC1BtM,KAAKS,EAAON;AAAAA,YACZ6E,QAAQvE,EAAOuE;AAAAA,YACfyG,aAAa;AAAA,UAAA,CACb;AAEF;AAAA,QAAA;AAAA,QAED,KAAK,MAAM;AACJ,gBAAA;AAAA,YAAEhL,QAAAA;AAAAA,YAAQmS,WAAAA;AAAAA,UAAAA,IAAc,KAAK7I,SAAS;AACxC,UAAA,CAACtJ,KAAUmS,KACT9I,KAAAA,GAAGwC,KAAK,eAAe;AAAA,YAC3BnM,IAAIyS,EAAU5S;AAAAA,YACdgF,QAAQ4N,EAAU5N;AAAAA,UAAAA,CAClB;AAEF;AAAA,QAAA;AAAA,QAED,KAAK,SAAS;AACP,gBAAA;AAAA,YAAE4N,WAAAA;AAAAA,YAAWnG,MAAAA;AAAAA,UAAAA,IAAS,KAAK1C,SAAS;AACtC,cAAA,CAAC+L,KAAWrJ,KAAQmG,KACR,KAAK5H,UAAU4H,EAAU5N,MAAM,EACnC4K,YAAY;AACtB,kBAAM5P,IAAM,KAAK+K,OAAO6H,EAAU5S,GAAG;AACjC,gBAAA,CAACA,EAAI9C,KAAM;AACf,iBAAK4M,GAAGwC,KACPtM,EAAIwW,OAAO,cAAc,YACzB;AAAA,cACCrW,IAAIyS,EAAU5S;AAAAA,cACdqL,QAAQ;AAAA,YAAA,CAEV;AAAA,UAAA;AAGF;AAAA,QAAA;AAAA,QAED,KAAK,QAAQ;AACN,gBAAA;AAAA,YAAE5K,QAAAA;AAAAA,YAAQmS,WAAAA;AAAAA,UAAAA,IAAc,KAAK7I,SAAS;AACxC,cAAA,CAACtJ,KAAUmS,GAAW;AACzBiD,YAAAA,EAAME,eAAe;AACfC,kBAAAA,IAAQ,KAAKC,uBAAAA,GAA0B9V;AACxC2J,iBAAAA,GAAGwC,KAAK,cAAc;AAAA,cAC1BtM,KAAK4S,EAAU5S;AAAAA,cACfgF,QAAQgR;AAAAA,cACRvK,aAAa;AAAA,YAAA,CACb;AAAA,UAAA;AAEF;AAAA,QAAA;AAAA,QAED,KAAK,aAAa;AACX,gBAAA;AAAA,YACLhL,QAAAA;AAAAA,YACAmS,WAAAA;AAAAA,YACAjQ,UAAUzF;AAAAA,YACVmV,QAAAA;AAAAA,UAAAA,IACG,KAAKtI,SAAS;AACd,cAAA,CAACtJ,KAAUmS,GAAW;AACzBiD,YAAAA,EAAME,eAAe;AACfG,kBAAAA,IAAQhZ,EAAK,CAAC,GAAGiD,IACjB6V,IAAQ,KAAKC,uBAAAA,GAA0B9V;AAC7C,YAAI+V,KAASF,MACPlM,KAAAA,GAAGwC,KAAK,cAAc;AAAA,cAC1BtM,KAAKkW;AAAAA,cACLlR,QAAQgR;AAAAA,cACRvK,aAAa;AAAA,YAAA,CACb,GACG4G,KAAU,CAAC,KAAKQ,WAAWqD,CAAK,KACnC,KAAKpM,GAAGwC,KAAK,cAAc;AAAA,cAAEnM,IAAI+V;AAAAA,YAAAA,CAAO;AAAA,UAC1C;AAED;AAAA,QAAA;AAAA,QAED,KAAK,OAAO;AACL,gBAAA;AAAA,YAAEzV,QAAAA;AAAAA,YAAQmS,WAAAA;AAAAA,UAAAA,IAAc,KAAK7I,SAAS;AACxC,cAAA,CAACtJ,KAAUmS,GAAW;AACzBiD,YAAAA,EAAME,eAAe;AACfC,kBAAAA,IAAQ,KAAKS,sBAAAA,GAAyBtW,IACtC+V,IAAQtD,EAAU5S;AACnB8J,iBAAAA,GAAGwC,KAAK,cAAc;AAAA,cAC1BtM,KAAKkW;AAAAA,cACLlR,QAAQgR;AAAAA,cACRvK,aAAa;AAAA,YAAA,CACb;AAAA,UAAA;AAEF;AAAA,QAAA;AAAA,QAED,KAAK,YAAY;AACV,gBAAA;AAAA,YACLhL,QAAAA;AAAAA,YACAmS,WAAAA;AAAAA,YACAjQ,UAAUzF;AAAAA,YACVmV,QAAAA;AAAAA,UAAAA,IACG,KAAKtI,SAAS;AACd,cAAA,CAACtJ,KAAUmS,GAAW;AACzBiD,YAAAA,EAAME,eAAe;AACrB,kBAAMG,IAAQhZ,EAAKwZ,GAAG,EAAE,EAAEvW,IACpB6V,IAAQ,KAAKS,sBAAAA,GAAyBtW;AAC5C,YAAI+V,KAASF,MACPlM,KAAAA,GAAGwC,KAAK,cAAc;AAAA,cAC1BtM,KAAKkW;AAAAA,cACLlR,QAAQgR;AAAAA,cACRvK,aAAa;AAAA,YAAA,CACb,GACG4G,KAAU,CAAC,KAAKQ,WAAWqD,CAAK,KACnC,KAAKpM,GAAGwC,KAAK,cAAc;AAAA,cAAEnM,IAAI+V;AAAAA,YAAAA,CAAO;AAAA,UAC1C;AAED;AAAA,QAAA;AAAA,QAED,KAAK,UAAU;AACd,eAAKpM,GAAGwC,KAAK,QAAQ,CAAA,CAAE;AACvB;AAAA,QAAA;AAAA,QAED,KAAK,UAAU;AACd,eAAKxC,GAAGwC,KAAK,QAAQ,CAAA,CAAE;AACvB;AAAA,QAAA;AAAA,MACD;AAAA,IACD,CAEF,GAEMR,EAAAA,GAAG,UAAU,CAACnM,MAAqC;AAClD,YAAA;AAAA,QACL+C,UAAAA;AAAAA,QACA0Q,OAAAA;AAAAA,QACAxP,QAAAA;AAAAA,QACAjB,UAAUzF;AAAAA,QACVyZ,SAAAA;AAAAA,MAAAA,IACG,KAAK5M,SAAS;AAElB,UAAI1N,IAAO,IACVua,IAAM,IACN/S,IAAQ;AACT,UAAIlE,EAAGqF,QAAQ;AACP,QAAA3I,IAAA;AACP,cAAMwa,IAAMnU,EAAS8C,UAAUlH,OAAKA,EAAE6B,MAAMR,EAAGqF,MAAM;AAC7CtC,QAAAA,IAAAA,EAASmU,CAAG,EAAEhT;AACtB,iBAASlH,IAAIyW,EAAM/W,QAAQ,GAAGM,IAAIka,GAAKla,KAAK;AACrCsD,gBAAAA,IAAMyC,EAAS/F,CAAC;AACtB,UAAIsD,EAAIyH,WACRrL,KAAQ4D,EAAI4D;AAAAA,QAAAA;AAAAA,MACb;AAEGlE,UAAAA,EAAGK,OAAO,CAAC2W,GAAS;AACvB,cAAM7O,IAAQ5K,EAAKsI,UAAUlH,OAAKA,EAAE6B,OAAOR,EAAGK,GAAG;AACjD,QAAI8H,KAAS,MAASlE,IAAAA,EAAOe,YAAYmD;AAAAA,MAAAA;AAG1C,WAAKkC,SAAS;AAAA,QACb8M,QAAQ;AAAA,UACPF,KAAAA;AAAAA,UACAva,MAAAA;AAAAA,UACAwH,OAAAA;AAAAA,UACAO,QAAQR,EAAOe;AAAAA,QAAAA;AAAAA,MAChB,CACA;AAAA,IAAA,CACD,GAEKmH,EAAAA,GAAG,SAAS,CAACnM,MAAoC;AAChD1C,YAAAA,IAASgM,GAAqBtJ,CAAE;AACtC,WAAKqK,SAAS;AAAA,QAAE+M,QAAQ9Z;AAAAA,MAAAA,CAAQ,GAChC,KAAK+Z,cAAc;AAAA,QAAED,QAAQ;AAAA,MAAA,CAAM;AAAA,IAAA,CACnC,GAEKjL,EAAAA,GAAG,QAAQ,MAAM;AACtB,WAAK+E,iBAAiBzE,WAAW;AAAA,IAAA,CACjC,GAEKN,EAAAA,GAAG,QAAQ,MAAM;AACtB,WAAK+E,iBAAiBtE,WAAW;AAAA,IAAA,CACjC,GAED,KAAK0K,SAAS;AAAA,EAAA;AAAA,EAGP1B,cAAcH,GAA4B;AAC7C,QAAA,CAAC,KAAKxE,aAAa;AAChBsG,YAAAA,IAAMC,OAAO7V,IAAIC,gBACtB,IAAIsT,KAAK,CAAC,kBAAkBO,CAAI,KAAK,GAAG;AAAA,QACvCrU,MAAM;AAAA,MAAA,CACN,CACF;AAEK6P,WAAAA,cAAc,IAAI6D,QAAQ7U,CAAOA,MAAA;AAC/B0V,cAAAA,IAAa,IAAI8B,OAAOF,CAAG;AACtBG,QAAAA,EAAAA,iBAAiB,WAAW3B,CAAKA,MAAA;AAC3C,UAAIA,EAAExY,KAAK6D,SAAS,YAAYuU,CAAU;AAAA,QAAA,CAC1C;AAAA,MAAA,CACD;AAAA,IAAA;AAEF,WAAO,KAAK1E;AAAAA,EAAAA;AAAAA,EAGbqG,WAAW;AACV,UAAM5Z,IAA8B;AAAA,MACnCoW,WAAW,CAAC;AAAA,MACZ7B,YAAY;AAAA,MACZ1U,MAAM,CAAE;AAAA,MACRkM,cAAc,CAAC;AAAA,MACf0N,QAAQ;AAAA,MACRrW,QAAQ;AAAA,MACRmS,WAAW;AAAA,MACXmE,QAAQ;AAAA,MACRvK,SAAS;AAAA,QAAE7C,MAAM;AAAA,QAAGC,MAAM;AAAA,MAAA;AAAA,IAC3B;AACK8G,SAAAA,QAAQ4G,KAAKja,CAAK;AAAA,EAAA;AAAA,EAGxBia,KAAKja,GAA6B;AAEjC,IAAIA,EAAMka,eAAe,OAAO,KAAK,CAAEla,EAAgBgU,UACrDhU,EAAgBgU,QAAQ3D,GAAY,IAElCrQ,EAAMkD,WACHA,EAAAA,QAAQsH,QAAQvJ,CAAKA,MAAA;AAC1B,MAAIA,EAAEuC,YACLvC,EAAEwD,aAAa,IAAI0V,IAAIlZ,EAAEuC,QAAQH,IAAIuB,CAAKA,MAAA,CAACA,EAAE9B,IAAI8B,EAAEtB,KAAK,CAAC,CAAC;AAAA,IAC3D,CACA,GAEGjE,EAAO,KAAKqN,WAAW7M,MAAMG,EAAMH,IAAI,MACvCG,EAAMoP,QACT,KAAKkE,YAAY;AAAA,MAAE,GAAG;AAAA,QAAEzT,MAAMG,EAAMH;AAAAA,MAAAA;AAAAA,IAAO,GAC3CG,EAAMH,OAAO,KAAKqX,kBAAkBlX,EAAMH,IAAI,KAClCA,EAAAA,OAAO,KAAKua,cAAcpa,EAAMH,IAAI,GAEjD,KAAK8M,SAAS;AAAA,MACb4H,YAAY;AAAA,MACZxI,cAAc,CAAC;AAAA,MACfqK,WAAW,CAAA;AAAA,IAAC,CACZ,GACG,KAAK5C,mBAAsBA,KAAAA,gBAAgBvF,aAAa,IAGzDuB,SACCxP,EAAMoP,SAAMpP,EAAMsM,OAAO,KACzBtM,EAAM+V,OAAO9W,UAAOe,EAAM+V,MAAM9W,QAAQ,KAGzCe,EAAMsM,QAAQ,CAAC,KAAKkH,oBACvB,KAAKA,kBAAkB,IAAInH,GAC1B,KAAKI,IACL,KAAKC,SAASqH,KAAK,IAAI,GACvB,KAAKpH,SAASoH,KAAK,IAAI,CACxB,IAGD,KAAKV,QAAQ4G,KAAK;AAAA,MACjB,GAAGja;AAAAA,IAAAA,CACH;AAAA,EAAA;AAAA,EAGF2M,SAAS3M,GAAuB0B,GAAmB;AAClD,WAAO,KAAK2R,QAAQ1G,SAAS3M,GAAO0B,CAAG;AAAA,EAAA;AAAA,EAGxCiY,cAAc3Z,GAAuB;AAC/BqT,SAAAA,QAAQsG,cAAc3Z,CAAK;AAAA,EAAA;AAAA,EAGjC0N,OAAO5K,GAAe;AACf,UAAA;AAAA,MAAEsM,MAAAA;AAAAA,IAAAA,IAAS,KAAK1C,SAAS;AAC/B,WAAI0C,IAAa,KAAKkE,UAAUxQ,CAAE,IAC3B,KAAK4J,SAAW7M,EAAAA,KAAKmM,KAAK/K,CAAKA,MAAAA,EAAE6B,MAAMA,CAAE;AAAA,EAAA;AAAA,EAGjDuX,YAAYvX,GAASjD,GAAsB;AAC1C,WAAKA,MAAaA,IAAA,KAAK6M,SAAWpH,EAAAA,WAC3BzF,EAAKsI,UAAUlH,CAAKA,MAAAA,EAAE6B,MAAMA,CAAE;AAAA,EAAA;AAAA,EAGtCiW,WAAWjW,GAAe;AACnBjD,UAAAA,IAAO,KAAK6M,SAAAA,EAAWpH,UACvBmF,IAAQ,KAAK4P,YAAYvX,GAAIjD,CAAI;AAChCA,WAAAA,EAAK4K,IAAQ,CAAC;AAAA,EAAA;AAAA,EAGtBqO,WAAWhW,GAAe;AACnBjD,UAAAA,IAAO,KAAK6M,SAAAA,EAAWpH,UACvBmF,IAAQ,KAAK4P,YAAYvX,GAAIjD,CAAI;AAChCA,WAAAA,EAAK4K,IAAQ,CAAC;AAAA,EAAA;AAAA,EAGtBkD,UAAU7K,GAAkB;AACpB,WAAA,KAAK4J,SAAWxJ,EAAAA,QAAQ8I,KAAK/K,CAAKA,MAAAA,EAAE6B,MAAMA,CAAE;AAAA,EAAA;AAAA,EAGpDkW,cAAclW,GAASwX,GAAkC;AAClDpX,UAAAA,IAAU,KAAKwJ,SAAAA,EAAWrH,UAC1BoF,IAAQvH,EAAQiF,UAAU,CAAC1C,MAAqBA,EAAE3C,MAAMA,CAAE;AAEhE,WAAIwX,IACI,KAAK1B,uBAAuBnO,IAAQ,CAAC,IAGtCvH,EAAQuH,IAAQ,CAAC;AAAA,EAAA;AAAA,EAGzBwO,cAAcnW,GAASwX,GAAkC;AAClDpX,UAAAA,IAAU,KAAKwJ,SAAAA,EAAWrH,UAC1BoF,IAAQvH,EAAQiF,UAAU,CAAC1C,MAAqBA,EAAE3C,MAAMA,CAAE;AAEhE,WAAIwX,IACI,KAAKlB,sBAAsB3O,IAAQ,CAAC,IAGrCvH,EAAQuH,IAAQ,CAAC;AAAA,EAAA;AAAA,EAGzBmO,uBAAuBnO,GAA+B;AAC/CvH,UAAAA,IAAU,KAAKwJ,SAAAA,EAAWrH;AAChC,QAAIkV,IAAQ9P,KAAS;AAGpB8P,WAAAA,IAAQrX,EAAQsC,WACftC,EAAQqX,CAAK,GAAGlQ,UAAUnH,EAAQqX,CAAK,GAAGzP;AAE3CyP,MAAAA;AAGD,WAAOrX,EAAQqX,CAAK;AAAA,EAAA;AAAA,EAGrBnB,sBAAsB3O,GAA+B;AAC9CvH,UAAAA,IAAU,KAAKwJ,SAAAA,EAAWrH;AAE5BkV,QAAAA,IAAQ9P,KAASvH,EAAQsC,SAAS;AAGrC+U,WAAAA,IAAQrX,EAAQsC,WACftC,EAAQqX,CAAK,GAAGlQ,UAAUnH,EAAQqX,CAAK,GAAGzP;AAE3CyP,MAAAA;AAGD,WAAOrX,EAAQqX,CAAK;AAAA,EAAA;AAAA,EAGrBC,eAAe7X,GAAWgF,GAAiB;AACpC,UAAA;AAAA,MAAEvE,QAAAA;AAAAA,MAAQiH,QAAAA;AAAAA,IAAAA,IAAW1C;AACvB,WAAA,CAACvE,KAAUiH,IAAe,KAC1B,OAAOjH,KAAW,aAAmBA,EAAOT,GAAKgF,CAAM,IACpD;AAAA,EAAA;AAAA,EAGRkN,cAAclS,GAAWgF,GAA2B;AAC/CzE,QAAAA,IAAU,KAAKwJ,SAAAA,EAAWxJ;AAC9B,QAAIyE,GAAQ;AACX,YAAM8C,IAAQvH,EAAQiF,UAAU1C,OAAKA,EAAE3C,MAAM6E,EAAO7E,EAAE;AAC5CI,MAAAA,IAAAA,EAAQ8H,MAAMP,IAAQ,CAAC;AAAA,IAAA;AAElC,WAAOvH,EAAQ8I,KAAKvG,CAAAA,MAAK,KAAK+U,eAAe7X,GAAK8C,CAAC,CAAC;AAAA,EAAA;AAAA,EAGrDyT,cAAcvW,GAAWgF,GAA2B;AAC/CzE,QAAAA,IAAU,KAAKwJ,SAAAA,EAAWxJ;AAC9B,QAAIyE,GAAQ;AACX,YAAM8C,IAAQvH,EAAQuX,cAAchV,OAAKA,EAAE3C,MAAM6E,EAAO7E,EAAE;AAChDI,MAAAA,IAAAA,EAAQ8H,MAAM,GAAGP,CAAK;AAAA,IAAA;AAEjC,WAAOvH,EAAQqI,SAAS9F,CAAAA,MAAK,KAAK+U,eAAe7X,GAAK8C,CAAC,CAAC;AAAA,EAAA;AAAA,EAGzD0R,aAAarU,GAASqW,GAAenL,GAAkB;AAClDkC,QAAAA,IAAO,KAAKoD,UAAUxQ,CAAE,GAExB;AAAA,MAAEjD,MAAAA;AAAAA,IAAAA,IAAS,KAAK6M,SAAS;AAG7B,QAFO7M,IAAA,CAAC,GAAGA,CAAI,GAEXiD,MAAO,GAAG;AACN,MAAAoN,IAAA;AAAA,QAAE,GAAGA;AAAAA,QAAMiJ,MAAAA;AAAAA,MAAK;AACjB/D,YAAAA,IAAS,KAAKK,cAAcvF,CAAI;AAClCA,MAAAA,EAAKwF,YAAY,MAAUN,IAAAA;AAAAA,IAAAA;AAG5BpH,IAAAA,KAAUkC,EAAKrQ,MAAM2F,UACnB3F,EAAAA,KAAK2K,QAAQ,CAAC7H,MAAc;AAChC,YAAMyS,IAAS,KAAKsF,WAAW/X,GAAKwW,GAAMnL,CAAM;AAC5ClL,MAAAA,MAAO,MAAUsS,IAAAA;AAAAA,IAAAA,CACrB,GAEF,KAAKzI,SAAS;AAAA,MAAE9M,MAAAA;AAAAA,IAAAA,CAAM;AAAA,EAAA;AAAA,EAGvB6a,WAAWxK,GAAYiJ,GAAenL,GAAkB;AAChD,IAAAkC,IAAA;AAAA,MAAE,GAAGA;AAAAA,MAAMiJ,MAAAA;AAAAA,IAAK;AAEjBtZ,UAAAA,IAAO,KAAK4V,cAAcvF,CAAI;AAEhClC,WAAAA,KAAUkC,EAAKrQ,MAAM2F,UACnB3F,EAAAA,KAAK2K,QAAQ,CAAC7H,MAAc;AAC3B+X,WAAAA,WAAW/X,GAAKwW,GAAMnL,CAAM;AAAA,IAAA,CACjC,GAEKnO;AAAAA,EAAAA;AAAAA,EAGA4V,cAAcvF,GAAY;AACjC,UAAMpN,IAAKoN,EAAKpN;AAEXwQ,SAAAA,UAAUxQ,CAAE,IAAIoN;AAErB,UAAMyK,IAAY,KAAKrH,UAAUpD,EAAKwF,OAAO,GACvCkF,IAAcD,EAAU9a,KAAKsI,UAAU,CAAClH,MAAYA,EAAE6B,MAAMA,CAAE;AAEpE6X,WAAAA,EAAU9a,OAAO,CAAC,GAAG8a,EAAU9a,IAAI,GACzBA,EAAAA,KAAK+a,CAAW,IAAI1K,GAEvByK,EAAU9a;AAAAA,EAAAA;AAAAA,EAGV2V,WAAW1S,GAAkB;AACpC,WAAO,KAAK4J,SAAS,EAAE4I,aAAarC,QAAQnQ,CAAE,MAAM;AAAA,EAAA;AAAA,EAG7C+X,cAAcC,GAAchY,GAAc;AACjD,aAASxD,IAAI,GAAGA,IAAIwb,EAAMtV,QAAQlG,KAAK;AACtC,UAAIwb,EAAMxb,CAAC,EAAEwD,MAAMA;AAClB,eAAOgY,EAAM3F,OAAO7V,GAAG,CAAC,EAAE,CAAC;AAExBwb,UAAAA,EAAMxb,CAAC,EAAEO,MAAM;AAClB,cAAMkb,IAAO,CAAC,GAAGD,EAAMxb,CAAC,EAAEO,IAAI,GACxBmb,IAAQ,KAAKH,cAAcE,GAAMjY,CAAE;AACzC,YAAIkY;AACHF,iBAAAA,EAAMxb,CAAC,IAAI;AAAA,YACV,GAAGwb,EAAMxb,CAAC;AAAA,YACVO,MAAMkb;AAAAA,UACP,GACOC;AAAAA,MACR;AAAA,IACD;AAEM,WAAA;AAAA,EAAA;AAAA,EAGAC,WACPH,GACAI,GACAhL,GACApQ,GACU;AACV,aAASR,IAAI,GAAGA,IAAIwb,EAAMtV,QAAQlG,KAAK;AACtC,UAAIwb,EAAMxb,CAAC,EAAEwD,MAAMoY,GAAU;AACtBC,cAAAA,IAAaL,EAAMxb,CAAC,GACpB8b,IAActb,MAAS,WAAWR,IAAIA,IAAI;AAGhD,YAAI6b,EAAWtb;AACd,cAAIC,MAAS,UAAU;AACtB,kBAAMub,IAAW/b,IAAI,IAAIwb,EAAMxb,IAAI,CAAC,IAAI;AAGpC+b,mBAAAA,GAAUxb,QAAQwb,EAASlC,OACxB7Z,EAAAA,IAAI,CAAC,IAAI;AAAA,cACd,GAAG+b;AAAAA,cACHxb,MAAM,CAAC,GAAGwb,EAASxb,MAAMqQ,CAAI;AAAA,YAC9B,IAEMiF,EAAAA,OAAOiG,GAAa,GAAGlL,CAAI,GAG3B;AAAA,UAAA,WAGHiL,EAAWhC;AACd2B,mBAAAA,EAAMxb,CAAC,IAAI;AAAA,cACV,GAAG6b;AAAAA,cACHtb,MAAM,CAACqQ,GAAM,GAAGiL,EAAWtb,IAAI;AAAA,YAChC,GACO;AAAA;AAKJsV,eAAAA,EAAAA,OAAOiG,GAAa,GAAGlL,CAAI,GAC1B;AAAA,MAAA;AAGJ4K,UAAAA,EAAMxb,CAAC,EAAEO,SACZib,EAAMxb,CAAC,IAAI;AAAA,QACV,GAAGwb,EAAMxb,CAAC;AAAA,QACVO,MAAM,CAAC,GAAGib,EAAMxb,CAAC,EAAEO,IAAI;AAAA,MACxB,GACI,KAAKob,WAAWH,EAAMxb,CAAC,EAAEO,MAAMqb,GAAUhL,GAAMpQ,CAAI;AAC/C,eAAA;AAAA,IAET;AAEM,WAAA;AAAA,EAAA;AAAA,EAGAmX,SACPnU,GACAgL,GACAjO,GACAC,GACC;AACKgb,UAAAA,IAAQ,CAAC,GAAGjb,CAAI,GAChByb,IAAY,KAAKT,cAAcC,GAAOhY,CAAE;AAC9C,gBAAKmY,WAAWH,GAAOhN,GAAQwN,GAAWxb,CAAI,GACvCgb;AAAAA,EAAAA;AAAAA,EAGA7G,YAAY/Q,GAAoB;AACvC,UAAMmC,IAA4B,CAAE;AACpCnC,WAAAA,EAAQsH,QAAQ5H,CAAOA,MAAA;AACtB,YAAMmY,IAAO;AAAA,QAAE,GAAGnY;AAAAA,MAAI;AACjB2Y,WAAAA,iBAAiBR,GAAM,QAAQ,GAC/BQ,KAAAA,iBAAiBR,GAAM,QAAQ,GACpC1V,EAASQ,KAAKkV,CAAI;AAAA,IAAA,CAClB,GACM1V;AAAAA,EAAAA;AAAAA,EAGAkW,iBAAiB3Y,GAAcc,GAAmB;AACrD9D,QAAAA,IAAcgD,EAAIc,CAAI;AAEjBgB,IAAAA,IAAAA,MAAMC,QAAQ/E,CAAM,IAAI,CAAC,GAAGA,CAAM,IAAI,CAACA,CAAM,GAC/C4K,EAAAA,QAAQ,CAACxE,GAAW1G,MAAc;AACxCM,MAAAA,EAAON,CAAC,IAAI,OAAO0G,KAAS,WAAW;AAAA,QAAEA,MAAAA;AAAAA,MAAAA,IAAS;AAAA,QAAE,GAAGA;AAAAA,MAAK;AAAA,IAAA,CAC5D,GAEDpD,EAAIc,CAAI,IAAI9D;AAAAA,EAAAA;AAAAA,EAGLwU,sBACPxR,GACA6H,GACAvH,GACC;AACD,QAAIK,IAASX,EAAIW;AACjB,aAASzC,IAAI,GAAGA,IAAIyC,EAAOiC,QAAQ1E,KAAK;AACjCyI,YAAAA,IAAOhG,EAAOzC,CAAC;AAEjByI,UAAAA,EAAKiS,eAAejS,EAAKuB,WAAW;AACnCvB,YAAAA,EAAKiS,gBAAgB,SAAS;AACjC5Y,UAAAA,EAAIkI,YAAY,IAChBlI,EAAI4D,QAAQ,IACZ+C,EAAKwI,WAAW;AAEVK,gBAAAA,IAAO7O,EAAOiC,SAAS1E;AAC7ByC,UAAAA,IAASA,EAAOyH,MAAM,GAAGlK,IAAI,CAAC,GACvBA,EAAAA,CAAC,EAAE2G,UAAU2K;AAAAA,QAAAA;AAGrB,cAAM5K,IAAU+B,EAAK/B;AACrB,YAAIA,GAAS;AACNqD,gBAAAA,IAAWtH,EAAOzC,IAAI,CAAC;AAC7B,cAAI2a,IAAY;AAEhB,UAAI5Q,KAAYA,EAASrD,WAAW,CAACqD,EAASC,cAC7C2Q,IAAY5Q,EAASrD;AAGtB,mBAASkU,IAAOD,GAAWC,IAAOlU,GAASkU,KAAQ;AAC5CC,kBAAAA,IAASzY,EAAQuH,IAAQiR,CAAI;AACnC,YAAIC,MACHA,EAAOtR,SAAS;AAAA,UACjB;AAAA,QACD;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAAA,EAGOiK,iBACPpR,GACAuH,GACA/G,GACAmO,GACA7P,GACC;AACKY,UAAAA,IAAMM,EAAQuH,CAAK;AACrB,IAAC7H,EAAI4D,UAAO5D,EAAI4D,QAAQ5D,EAAI6D,WAAW,KAAKzE,EAAM0E,cAEtD9D,EAAIgZ,YAAYnR,IAAQ;AAGlB7K,UAAAA,IAA8BgD,EAAIc,CAAI,GACtCmY,IAAa7Z,EAAM,GAAG0B,CAAI,YAAY;AAE5C,aAASpE,IAAI,GAAGA,IAAIuS,GAAWvS,KAAK;AAC7BqD,YAAAA,IAAyB/C,EAAON,CAAC;AAEvCqD,MAAAA,EAAIG,KAAKF,EAAIE,IAGTxD,MAAMM,EAAO4F,SAAS,MACrBiC,EAAAA,UAAU9E,EAAI8E,UACf6J,KAAK4E,IAAIvT,EAAI8E,SAASoK,IAAYvS,CAAC,IACnCuS,IAAYvS;AAIhB,eAASwB,IAAI,GAAGA,IAAI6B,EAAI8E,SAAS3G,KAAK;AACpClB,QAAAA,EAAeuV,OAAO7V,IAAIwB,GAAG,GAAG;AAAA,UAAEgb,SAAS;AAAA,QAAA,CAAM;AAElD,iBAASrW,IAAI,GAAGA,IAAI9C,EAAI6E,SAAS/B;AAE/BsW,UADmB7Y,EAAQuH,IAAQhF,CAAC,EAAE/B,CAAI,EACpByR,OAAO7V,IAAIwB,GAAG,GAAG,CAAA,CAAE;AAAA,MAC3C;AAGD,UAAI6B,EAAI8E,SAAS;AAKVV,cAAAA,KAHLpE,EAAI8E,YAAYoK,IACbgK,IACAA,EAAW7Q,MAAM1L,GAAGqD,EAAI8E,UAAUnI,CAAC,GACf2L,OAAO,CAAChK,GAAGD,MAAMC,IAAID,GAAG,CAAC;AACjD2B,QAAAA,EAAIoE,SAASA,GACTzH,IAAIqD,EAAI8E,WAAWoK,KAAe9K,EAAAA;AAAAA,MAAAA;AAIvC,UAAIpE,EAAI6E,SAAS;AAChB,YAAIhB,IAAQ5D,EAAI4D,OACZC,IAAW7D,EAAI6D,YAAY;AAC/B,cAAMe,IAAU7E,EAAI6E;AACpB,iBAASkU,IAAO,GAAGA,IAAOlU,GAASkU,KAAQ;AACpCM,gBAAAA,IAAU9Y,EAAQuH,IAAQiR,CAAI;AACpC,UAAIM,MACCA,EAAQ3R,SACX1H,EAAI6E,WAAW,IACLwU,EAAQvV,WAClBA,KAAYuV,EAAQvV,WAEXuV,KAAAA,EAAQxV,SAASxE,EAAM0E,cAG9BD,IACH9D,EAAI8D,WAAWA,IAEf9D,EAAI6D,QAAQA;AAAAA,QACb;AAAA,MACD;AAEA7D,QAAAA,EAAI6D,QAAQ5D,EAAI4D,OAChB7D,EAAI8D,WAAW7D,EAAI6D;AAGpB,MACC/C,MAAS,YACTf,EAAIQ,UACJ,OAAOR,EAAIQ,UAAW,aAEtBR,EAAIQ,SAAS;AAAA,QAAEO,MAAMf,EAAIQ;AAAAA,MAAO;AAAA,IACjC;AAGD,IAAIvD,EAAO4F,SAASqM,MAAWjS,EAAO4F,SAASqM,IAC/CjP,EAAIc,CAAI,IAAI9D;AAAAA,EAAAA;AAAAA,EAIbwa,cAAcva,GAAsB;AACnCA,WAAAA,EAAK2K,QAAQ7H,CAAOA,MAAA;AACnB,MAAKA,EAAIG,OAAIH,EAAIG,KAAKhE,EAAI;AAAA,IAAA,CAC1B,GACMe;AAAAA,EAAAA;AAAAA,EAGRqX,kBAAkBrX,GAAcoc,GAAgB/b,GAAsB;AACrEL,WAAAA,EAAK2K,QAAQ7H,CAAOA,MAAA;AACnB,MAAKA,EAAIG,OAAIH,EAAIG,KAAKhE,EAAI,IAE1B6D,EAAI6P,SAASyJ,KAAS,GACtBtZ,EAAI+S,UAAUxV,KAAU,GAEnBoT,KAAAA,UAAU3Q,EAAIG,EAAE,IAAIH,GAErBA,EAAI9C,SACH8C,EAAI9C,KAAK2F,UACRiN,EAAAA,SAAS9P,EAAI9C,KAAK2F,QACtB,KAAK0R,kBAAkBvU,EAAI9C,MAAM8C,EAAI6P,SAAS,GAAG7P,EAAIG,EAAE,MAEvD,OAAOH,EAAI9C,MACX,OAAO8C,EAAI8P,QACX,OAAO9P,EAAIwW;AAAAA,IAEb,CACA,GACMtZ;AAAAA,EAAAA;AAAAA,EAGR8W,SAAS9W,GAAa4W,GAAkD;AACvE5W,IAAAA,EAAKgT,KAAK4D,CAAM,GAChB5W,EAAK2K,QAAQ0F,CAAQA,MAAA;AACpB,MAAIA,EAAKrQ,QACH8W,KAAAA,SAASzG,EAAKrQ,MAAM4W,CAAM;AAAA,IAChC,CACA;AAAA,EAAA;AAAA,EAGFK,WACCjX,GACAsD,GACAqR,GACQ;AACR3U,WAAAA,EAAK2K,QAAQ7H,CAAOA,MAAA;AACnB,MAAIQ,EAAOR,CAAG,KAAakD,EAAAA,KAAKlD,EAAIG,EAAE,GAClCH,EAAI9C,QAAM,KAAKiX,WAAWnU,EAAI9C,MAAMsD,GAAQqR,CAAS;AAAA,IAAA,CACzD,GACMA;AAAAA,EAAAA;AAAAA,EAGRC,YAAY5U,GAAcyF,GAAkBkP,GAA0B;AACrE,UAAMjS,IAAc+C;AACpBzF,WAAAA,EAAK2K,QAAQ7H,CAAOA,MAAA;AACf,OAAA,CAAC6R,KAAaA,EAAUlG,SAAS3L,EAAIG,EAAE,MAAO+C,EAAAA,KAAKlD,CAAG,GACtDA,EAAI9C,MAAM2F,UAAU7C,EAAIwW,SAAS,MACpC,KAAK1E,YAAY9R,EAAI9C,MAAM0C,GAAKiS,CAAS;AAAA,IAC1C,CACA,GACMjS;AAAAA,EAAAA;AAAAA,EAGRsU,aAAa9K,GAA6B;AACnC,UAAA;AAAA,MAAE1G,UAAUnC;AAAAA,IAAAA,IAAY,KAAKwJ,SAAS,GACtCwP,IAAqC,CAAE;AAE7C,eAAWC,KAASpQ,GAAc;AAC3B,YAAA;AAAA,QAAEnM,QAAAA;AAAAA,QAAQ8D,MAAAA;AAAAA,MAASR,IAAAA,EACvB8I,KAAKvG,CAAAA,MAAKA,EAAE3C,MAAMqZ,CAAK,EACvB5Y,OAAOyI,KAAK5K,CAAKA,MAAAA,EAAE+B,MAAM,EAAEA,QACvBuC,IAAQqG,EAAaoQ,CAAK;AAExBtW,MAAAA,EAAAA,KAAK,CAACrG,MACTI,GAAQuC,UACJvC,EAAOuC,QAAQ3C,EAAI2c,CAAK,GAAGzW,CAAK,IAGjCyN,GAAiBzP,CAAI,EAAElE,EAAI2c,CAAK,GAAGzW,CAAK,CAC/C;AAAA,IAAA;AAGF,WAAO,CAAClG,MAAa;AACpB,eAASF,IAAI,GAAGA,IAAI4c,EAAQ1W,QAAQlG;AACnC,YAAI,CAAC4c,EAAQ5c,CAAC,EAAEE,CAAG;AACX,iBAAA;AAGF,aAAA;AAAA,IACR;AAAA,EAAA;AAAA,EAGO6U,eACPnR,GACAlB,GACAkS,GACAC,GACA7L,GACe;AACf,UAAMxB,IAAmB6K,EACxBzO,GACA,UACAgR,GACAlS,EAAM6R,cACNvL,CACD,GACMf,IAAmBoK,EACxBzO,GACA,UACAiR,GACAnS,EAAM8R,cACNxL,CACD,GAGMuL,IAAe/M,EAAiBmE,OAAO,CAAChK,GAAGD,MAAMC,IAAID,GAAG,CAAC,GACzD8S,IAAevM,EAAiB0D,OAAO,CAAChK,GAAGD,MAAMC,IAAID,GAAG,CAAC;AAExD,WAAA;AAAA,MACN,GAAGgB;AAAAA,MACH8E,kBAAAA;AAAAA,MACAS,kBAAAA;AAAAA,MACAsM,cAAAA;AAAAA,MACAC,cAAAA;AAAAA,IACD;AAAA,EAAA;AAEF;AAEA,IAAIsI,MAAO,oBAAIpU,KAAK,GAAEqU,QAAQ;AAC9B,SAASvd,IAAM;AACd,SAAO,YAAYsd;AACpB;ACthDA,SAASE,GAAOC,GAAIC,IAAO,WAAW;AACpC,MAAIC,IAAOF;AAGX,OAFI,CAACE,EAAK,WAAWF,EAAG,WACtBE,IAAOF,EAAG,SACLE,KAAM;AACX,QAAIA,EAAK,gBACKA,EAAK,aAAaD,CAAI;AACzB,aAAOC;AAElB,IAAAA,IAAOA,EAAK;AAAA,EAChB;AACE,SAAO;AACT;AAAA,CA0P2B,oBAAI,KAAM,GAAE,QAAO;AC7PvC,SAASC,GACfD,GACA;AAAA,EAAE9a,MAAAA;AAAAA,EAAMsN,MAAAA;AAAmD,GAC1D;AACD,aAAW/P,KAAOyC,GAAM;AACvB,UAAMgb,IAAQzd,EAAI8T,YAAcpN,EAAAA,QAAQ,MAAM,EAAE;AAChD,IAAI+W,MAAUzd,MACRyd,EAAAA,CAAK,IAAIhb,EAAKzC,CAAG;AAAA,EACvB;AAED,WAAS0d,EAAcpE,GAAY;AAClC,QAAIqE,IAAOrE,EAAMqE,KAAKjX,QAAQ,OAAO,EAAE,EAAEoN,YAAY;AACjD6J,IAAAA,MAAS,QAAYA,IAAA;AACnB3d,UAAAA,IAAM,GAAGsZ,EAAMsE,WAAWtE,EAAMuE,UAAU,UAAU,EAAE,GAC3DvE,EAAMwE,WAAW,WAAW,EAAE,GAC5BxE,EAAMyE,SAAS,SAAS,EAAE,GAAGJ,EAAKjX,QAAQ,QAAQ,EAAE,CAAC,IAClDzD,IAAUR,EAAKzC,CAAG;AAEpB,QAAA,OAAOiD,IAAY,KAAa;AAC7BsW,YAAAA,IACLD,EAAM1K,OAAOoP,YAAY,WACzB1E,EAAM1K,OAAOoP,YAAY,cACzBZ,GAAO9D,EAAM1K,QAAQ,gBAAgB,GAAGiD,UAAUoM,SACjD,WACD,KACA,CAAC,CAAC3E,EAAM1K,OAAOsP,QAAQ,oBAAoB;AACxC,MAAA,OAAOjb,KAAY,aACdA,EAAA;AAAA,QAAEjD,KAAAA;AAAAA,QAAKsZ,OAAAA;AAAAA,QAAOiE,MAAAA;AAAAA,QAAMhE,SAAAA;AAAAA,MAAAA,CAAS,IAC3BtW,KACL8M,EAAA;AAAA,QAAE/P,KAAAA;AAAAA,QAAKsZ,OAAAA;AAAAA,QAAOiE,MAAAA;AAAAA,QAAMhE,SAAAA;AAAAA,MAAAA,CAAS;AAAA,IACnC;AAAA,EACD;AAGIuB,SAAAA,EAAAA,iBAAiB,WAAW4C,CAAa,GACvC;AAAA,IACNS,SAASA,MAAM;AACTC,MAAAA,EAAAA,oBAAoB,WAAWV,CAAa;AAAA,IAAA;AAAA,EAEnD;AACD;AChDgBW,SAAAA,GACfd,GACA7c,GACC;AACD,MAAImC,IAAsB;AACnB0X,EAAAA,EAAAA,OAAO+D,UAAU,CAACre,MAAqB;AACzC,QAAA,CAACA,KAAKA,MAAM4C,EAAM;AACf5C,IAAAA,IAAAA;AAED,UAAA;AAAA,MAAEH,MAAAA;AAAAA,MAAMua,KAAAA;AAAAA,MAAKxS,QAAAA;AAAAA,MAAQP,OAAAA;AAAAA,IAAAA,IAAUrH,GAC/Bse,IAAU7d,EAAO8d,UAAU,GAC3BC,IAAS/d,EAAOge,SAAS,GACzBC,IAASje,EAAOke,gBAAgB;AAEtC,QAAIvE,KAAO,GAAG;AACb,YAAMwE,IAAMtB,EAAKuB;AACjB,MAAIzE,IAAMwE,IACTtB,EAAKuB,YAAYzE,IACPA,IAAMxS,IAASgX,IAAMN,MAC1BO,EAAAA,YAAYzE,IAAMkE,IAAU1W;AAAAA,IAClC;AAED,QAAI/H,KAAQ,GAAG;AACd,YAAM+e,IAAMtB,EAAKwB;AACjB,MAAIjf,IAAO+e,IACVtB,EAAKwB,aAAajf,IACRA,IAAOwH,IAAQuX,IAAMJ,IAASE,MACnCI,EAAAA,aAAajf,IAAO2e,IAASnX,IAAQqX;AAAAA,IAC3C;AAAA,EACD,CACA;AACF;AC1BO,MAAMK,KAA2C,CACvD;AAAA,EAAEpb,IAAI;AAAA,EAAckD,MAAM;AAAA,EAAcmY,MAAM;AAA4B,GAC1E;AAAA,EAAErb,IAAI;AAAA,EAAakD,MAAM;AAAA,EAAamY,MAAM;AAA2B,GACvE;AAAA,EAAErb,IAAI;AAAA,EAAQkD,MAAM;AAAA,EAAQmY,MAAM;AAAmB,GACrD;AAAA,EAAE1a,MAAM;AAAY,GACpB;AAAA,EAAEX,IAAI;AAAA,EAAUkD,MAAM;AAAA,EAAUmY,MAAM;AAAqB,CAAC;","x_google_ignoreList":[0,12]}